<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: PLUMED Masterclass 22.15: FISST module and application of mechanical forces with PLUMED</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('masterclass-22-15.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PLUMED Masterclass 22.15: FISST module and application of mechanical forces with PLUMED </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Authors</dt><dd>Glen M. Hocky </dd></dl>
<dl class="section date"><dt>Date</dt><dd>October 17, 2022</dd></dl>
<h1><a class="anchor" id="masterclass-22-15-aims"></a>
Aims</h1>
<p>This Masterclass explains how mechanical forces can be modeled using PLUMED, and the application of the FISST module for applying multiple forces simultaneously.</p>
<h1><a class="anchor" id="masterclass-22-15-lo"></a>
Objectives</h1>
<p>The objectives of this Masterclass are:</p><ul>
<li>Learn how to apply a constant force in PLUMED</li>
<li>Learn how to perform steered-MD in PLUMED, and approximately get a free energy surface from repeating this calculation</li>
<li>Learn how to apply constant forces with FISST, and reweight to different intermediate forces</li>
</ul>
<h1><a class="anchor" id="masterclass-22-15-prereq"></a>
Prerequisites</h1>
<p>We assume that the person that will follow this tutorial is familiar with the Linux terminal, Gromacs and basic functionality of PLUMED.</p>
<p>Familiarity with python and matplotlib is recommended for FISST reweighting and plotting</p>
<h1><a class="anchor" id="masterclass-22-15-install"></a>
Setting up PLUMED</h1>
<p>We will use GROMACS, LAMMPS, PLUMED, and PLUMED's pesmd function to perform the calculations. Conda packages with the software required for this class have been prepared and you can install them following the instructions in <a href="https://github.com/plumed/masterclass-2022">this link</a>.</p>
<p>If you are compiling PLUMED on your own, you will need to install the FISST module manually by adding '&ndash;enable-modules=fisst' to your './configure' command when building PLUMED.</p>
<p>The data needed to run the exercises of this Masterclass can be found on <a href="https://github.com/hockyg/masterclass-22-15b">GitHub</a>. You can clone this repository locally on your machine using the following command:</p>
<pre class="fragment">git clone https://github.com/hockyg/masterclass-22-15
</pre><h1><a class="anchor" id="masterclass-22-15-background"></a>
Background</h1>
<p>A force along some direction here is defined as the negative gradient of the potential energy along that direction.</p>
<p>A constant force \(F\) on a scalar collective variable \(Q(\vec{X})\) therefore is a simple addition to the system's energy function.</p>
<p class="formulaDsp">
\[ U(\vec{X},F) = U(\vec{X}) - F Q(\vec{X}) \]
</p>
<p>Notice that, because of the negative sign, a postive value of \(F\) results in a lower energy for large values of \(Q\), meaning \(F\gt0\) corresponds to a "pulling" force.</p>
<p>A mechanical force would often in reality would correspond to pulling apart two atoms, and so \(Q\) would often be a simple distance coordinate.</p>
<p>Note however, that other quantities could be used, such as an area which would mean \(F\) corresponds to a pressure.</p>
<p>Dimensional analysis implies that the units of \(F\) must be [Energy]/[Q].</p>
<p>The effect of constant force can be assessed using any enhanced sampling method.</p>
<p>The work done by the bias in this case is very simple</p>
<p class="formulaDsp">
\[ W = \int_a^b F \cdot d Q = F ( Q_b - Q_a ) \]
</p>
<p>Constant forces can be applied in PLUMED with the SLOPE keyword of the RESTRAINT bias.</p>
<h1><a class="anchor" id="masterclass-22-15-smd"></a>
Steered MD</h1>
<p>Steered molecular dynamics (SMD) is one way of pulling on a molecular coordinate, and has a connection to experiments done where a molecule is attached via a "spring" to an object such as an optical tweezer or AFM tip. To represent this in simulation, instead of applying a constant force, we impose a Harmonic restraint on \(Q\) with a center that moves:</p>
<p class="formulaDsp">
\[ U(\vec{X},F) = U(\vec{X}) + \frac{1}{2} k (Q-Q_0(t))^2 \]
</p>
<p>Typically \(Q_0(t)\) would move linearly, with \( Q_0(t) = Q_0(0)-\lambda t \) although that is not a requirement.</p>
<p>At any given time, the force along \(Q\) from the moving bias is given as:</p>
<p class="formulaDsp">
\[ F(t) = -\frac{\partial U}{\partial Q} = -k(Q-Q_0(t)) \]
</p>
<p>This force is positive (pulling) when \(Q_0(t)\) is bigger than \(Q\), and it can get very large if the spring moves quickly to larger values.</p>
<p>SMD is implemented in PLUMED using the MOVINGRESTRAINT bias, and the work is computed automatically.</p>
<p class="formulaDsp">
\[ W = \int_a^B F dQ \approx \sum_{i=1}^{N_{steps}} \bar{F}_i (Q_0(t_i)-Q_0(t_{i-1})) = \lambda dt \sum_{i=1}^{N_{steps}} \bar{F}_i, \]
</p>
<p class="formulaDsp">
\[ \bar{F_i}=\frac{1}{2}( F_{i}+F_{i-1} ) = -\frac{k}{2}( Q(t_i)-Q_0(t_i) -Q(t_{i-1})+Q_0(t_{i-1})) = -\frac{k}{2} (\Delta Q_i - \lambda d t) \]
</p>
<h1><a class="anchor" id="masterclass-22-15-fisst"></a>
FISST</h1>
<p>Infinite Switch Simulated Tempering in Force (FISST) is a method implemented in Ref. <a class="el" href="citelist.html#CITEREF_Hartmann-FISST-2019">[64]</a></p>
<p>This method takes advantage of the limit of changing a force from \(F_{min}\) to \(F_{max}\) and back infinitely quickly.</p>
<p>In this limit, the system feels an average force \(\bar{F}(Q)\) that depends on the current value of the pulling coordinate.</p>
<p class="formulaDsp">
\[ U(\vec{X},F) = U(\vec{X}) - \bar{F}(Q) Q(\vec{X}) \]
</p>
<p>In practice, this \(\bar{F}(Q)\) is computed using weights \(w(F)\) for each force in the force range that are learned on the fly, and separate "observable weights" \(W_F(Q_i)\) are used to compute the average of any quantity \(A\) at a given force.</p>
<p class="formulaDsp">
\[ \langle A \rangle_F = \frac{1}{N} \sum_{i=1}^{N_{steps}} A(X(t_i)) W_F(Q_i) \]
</p>
<p>where the observable weights are computed in a way that</p>
<p class="formulaDsp">
\[ W_F(Q_i)\propto \left(\int_{F_{min}}^{F_{max}} dF&#39; w(F&#39;) e^{\beta (F&#39;-F) Q_i} \right)^{-1} \]
</p>
<p>The module writes out both the force weights and the observable weights to files.</p>
<h1><a class="anchor" id="masterclass-22-15-ex"></a>
Exercises</h1>
<p>The exercises are presented below.</p>
<h2><a class="anchor" id="masterclass-22-15-ex-1d-setup"></a>
Effect of force on a 1-dimensional potential</h2>
<p>Use the RESTRAINT function to add a constant force of different magnitudes (e.g. -5 to 5 in these units) and look at how the force changes the resulting free energy surface.</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">ENERGY<div class="right">the units of energy. <i></i></div></div>=kcal/mol <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1d1" onclick='showPath("eg1","eg1d1")'>d1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <span style="display:none;" id="eg1d1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1ff" onclick='showPath("eg1","eg1ff")'>ff: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_a_t_h_e_v_a_l.html" style="color:green">MATHEVAL</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1d1">d1</b> <div class="tooltip">PERIODIC<div class="right"><b>compulsory keyword </b>
if the output of your function is periodic then you should specify the periodicity
of the function. <i></i></div></div>=NO <div class="tooltip">FUNC<div class="right"><b>compulsory keyword </b>
the function you wish to evaluate <i></i></div></div>=0.2*(((x-10)^2)*((x-20)^2)) <span style="display:none;" id="eg1ff"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1bb" onclick='showPath("eg1","eg1bb")'>bb: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_b_i_a_s_v_a_l_u_e.html" style="color:green">BIASVALUE</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1ff">ff</b> <span style="display:none;" id="eg1bb"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1metad" onclick='showPath("eg1","eg1metad")'>metad: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_e_t_a_d.html" style="color:green">METAD</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1d1">d1</b> <div class="tooltip">PACE<div class="right"><b>compulsory keyword </b>
the frequency for hill addition <i></i></div></div>=500 <div class="tooltip">HEIGHT<div class="right">the heights of the Gaussian hills. <i></i></div></div>=0.1 <div class="tooltip">SIGMA<div class="right"><b>compulsory keyword </b>
the widths of the Gaussian hills <i></i></div></div>=2.5 <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=HILLS )</b>
a file in which the list of added hills is stored <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">BIASFACTOR<div class="right">use well tempered metadynamics and use this bias factor. <i></i></div></div>=10 <div class="tooltip">TEMP<div class="right">the system temperature - this is only needed if you are doing well-tempered metadynamics
<i></i></div></div>=300.0 <div class="tooltip">GRID_WFILE<div class="right">the file on which to write the grid <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">GRID_MIN<div class="right">the lower bounds for the grid <i></i></div></div>=0 <div class="tooltip">GRID_MAX<div class="right">the upper bounds for the grid <i></i></div></div>=30 <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=251 <div class="tooltip">GRID_WSTRIDE<div class="right">write the grid to a file every N steps <i></i></div></div>=10000 <span style="display:none;" id="eg1metad"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_r_e_s_t_r_a_i_n_t.html" style="color:green">RESTRAINT</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=* <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=100 <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Then run the simulation using the command:</p>
<pre class="fragment">plumed pesmd &lt; doublewell_prod.pesmd.input
</pre><p>Plot the free energy surface from the GRID or after using sum_hills to compute the surface, and zero the potential at the left minimum. What do you notice about the other minimum and barrier?</p>
<div class="image">
<img src="masterclass-22-15-doublewell_metad.jpg" alt=""/>
<div class="caption">
Pulling on a double well, sampled by metadynamics</div></div>
<h2><a class="anchor" id="masterclass-22-15-ex-2d-setup"></a>
Effect of force on a 2-dimensional potential</h2>
<p>The following implements a "V-shaped" potential which has 2 minima at small y values and 1 minima at large y value.</p>
<p>Try plotting the potential to see.</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<b name="eg2d1" onclick='showPath("eg2","eg2d1")'>d1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <div class="tooltip">COMPONENTS<div class="right">( default=off ) calculate the x, y and z components of the distance separately and
store them as label.x, <i></i></div></div> <span style="display:none;" id="eg2d1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2ff" onclick='showPath("eg2","eg2ff")'>ff: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_a_t_h_e_v_a_l.html" style="color:green">MATHEVAL</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2d1">d1.x</b>,<b name="eg2d1">d1.y</b> <div class="tooltip">PERIODIC<div class="right"><b>compulsory keyword </b>
if the output of your function is periodic then you should specify the periodicity
of the function. <i></i></div></div>=NO <div class="tooltip">FUNC<div class="right"><b>compulsory keyword </b>
the function you wish to evaluate <i></i></div></div>=-8*log((exp(-(y-exp(-x))^2/2)+exp(-(y+exp(-x))^2/2))*exp(-x^2/2)) <span style="display:none;" id="eg2ff"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2bb" onclick='showPath("eg2","eg2bb")'>bb: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_b_i_a_s_v_a_l_u_e.html" style="color:green">BIASVALUE</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2ff">ff</b> <span style="display:none;" id="eg2bb"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=* <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=100 <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>First run a simulation using the command, and make a 2d histogram of x and y to show that it is trapped on one side.</p>
<pre class="fragment">plumed pesmd &lt; doublewell_prod.pesmd.input
</pre><p>If you have time, use RESTRAINT to add a constant force in the Y direction that favors the higher vertical state.</p>
<p>Now add FISST in order to sample forces all at once:</p>

<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<b name="eg3f" onclick='showPath("eg3","eg3f")'>f: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_f_i_s_s_t.html" style="color:green">FISST</a> <div class="tooltip">MIN_FORCE<div class="right"><b>compulsory keyword </b>
Minimum force (per CV) to use for sampling. <i></i></div></div>=-15 <div class="tooltip">MAX_FORCE<div class="right"><b>compulsory keyword </b>
Maximum force (per CV) to use for sampling. <i></i></div></div>=15.0 <div class="tooltip">PERIOD<div class="right"><b>compulsory keyword </b>
Steps corresponding to the learning rate <i></i></div></div>=200 <div class="tooltip">NINTERPOLATE<div class="right"><b>compulsory keyword </b>
Number of grid points on which to do interpolation. <i></i></div></div>=41 <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=d1.x <div class="tooltip">KBT<div class="right">The system temperature in units of KB*T. <i></i></div></div>=1.0 <div class="tooltip">OUT_RESTART<div class="right">Output file for all information needed to continue FISST simulation.If <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">OUT_OBSERVABLE<div class="right">Output file putting weights needed to compute observables at different force values.If
<i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">OBSERVABLE_FREQ<div class="right">How often to write out observable weights (default=period). <i></i></div></div>=100 <div class="tooltip">CENTER<div class="right"><b>compulsory keyword ( default=0 )</b>
The CV value at which the applied bias energy will be zero <i></i></div></div>=0 <span style="display:none;" id="eg3f"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>We used forces -15 to 15 in the paper, but feel free to experiment with your own force range. Inspect the observable file and restart file to see what is in there.</p>
<p>Now generate a histogram at each force using the following command, which will render it as an animated gif if you have the proper libraries installed.</p>
<pre class="fragment">python reweight_vshape.py observable_file cv_file
</pre><div class="image">
<img src="masterclass-22-15-vshape_animated.gif" alt=""/>
<div class="caption">
Animated gif of potential at different forces, sampled by FISST.</div></div>
<h2><a class="anchor" id="masterclass-22-15-ex-helix"></a>
Model bistable helix</h2>
<p>In this section, we will study a toy model of a a helix using a bead spring model in lammps. This model has lowest energy when it is in a left or right handed helix, but it is not chiral, so they must have the same free energy.</p>
<p>First, run the system without any pulling, if you fisualize the trajectory, you will see that it is stuck in one configuration (epsilon sets the strength of the bonds, it can be studied at lower or higher stabilities by changing eps).</p>
<pre class="fragment">lmp -log helix_sf_example.log \
           -var plumed_file helix_sf_f-4.5_eps7.5_10000000.plumed.dat  \
           -var outprefix helix_sf_pull0 \
           -var steps 10000000  \
           -var eps 7.5 \
           -in run_helix_plumed.lmp
</pre><p>Now, run the system using FISST, suitibly modifying the plumed file to impose a force from -2 to 8 (as studied in the paper) </p><pre class="fragment">lmp -log helix_sf_example.log \
           -var plumed_file helix_fisst_fmin-2.0_fmax8.0_eps7.5_50000000.plumed.dat  \
           -var outprefix helix_fisst_fmin-2.0_fmax8.0_eps7.5_50000000 \
           -var steps 50000000  \
           -var eps 7.5 \
           -in run_helix_plumed.lmp
</pre><p>The included script 'compute_handedness.py' has an ad-hoc handedness calculation which is computed using RMSD to a left and right handed helix. The end-end distance is already computed in the colvars file.</p>
<p>Use the handedness calculation in this script to create a 2d FES from the unbiased simulation, and from the unweighted FISST data.</p>
<div class="image">
<img src="masterclass-22-15-helix-fisst-unweighted.jpg" alt=""/>
<div class="caption">
Helix data from unweighted FISST. Dots on right side are from unbiased simulation.</div></div>
<p>Note that both sides are equally explored in this relatively long simulation. Then compute plots reweighted to small/negative forces and large forces, and notice how the result mirrors that from the V-shaped potential.</p>
<div class="image">
<img src="masterclass-22-15-helix-fisst-weighted.jpg" alt=""/>
<div class="caption">
Helix data reweighted to different forces. </div></div>
<h2><a class="anchor" id="masterclass-22-15-ex-peptide"></a>
Solvated alanine-10</h2>
<p>We will now study the effect of force on a model peptide, alanine 10 in water. You can set this up to run yourself, but the colvar files are also included for a 200ns simulation of alanine 10 run with FISST from forces -10 to 10 pN and from -10 to 100 pN.</p>
<p>Note, now we are using real units, a conversion factor is needed: 69.4786 pN = 1 kcal/mol/Angstrom</p>
<p>To run yourself, modify ala10_fisst.plumed.dat</p>
<pre class="fragment">gmx_mpi -s ala10.tpr -plumed ala10_fisst.plumed.dat -nsteps 100000000 --deffnm OUTPUT_PREFIX
</pre><p>Then analyze your files, or my files ala10_pull_fRange_fmin-10_fmax100.* to compute the end-end distance of Alanine 10 at different forces. Do your results from different FISST ranges agree?</p>
<div class="image">
<img src="masterclass-22-15-ala10-fisst-end-end-reweighted.jpg" alt=""/>
<div class="caption">
End-end distance for alanine-10 reweighted to different forces.</div></div>
<p>Finally, use the observable weights to compute the Ramachandran plot (averaged over residues) at different forces (mine is from analyzing the gromacs structural output, but you may want to put the phi-psi calculation in the plumed file as in previous tutorials!)</p>
<div class="image">
<img src="masterclass-22-15-ala10-fisst-rama.jpg" alt=""/>
<div class="caption">
Ramachandran plots for alanine-10 reweighted to different forces.</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
