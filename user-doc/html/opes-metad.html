<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: OPES_METAD Tutorial: Running and post-processing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('opes-metad.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OPES_METAD Tutorial: Running and post-processing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="opes-metad-aim"></a>
Aim</h1>
<p>The aim of this tutorial is to briefly present an example of an <a class="el" href="_o_p_e_s__m_e_t_a_d.html">OPES_METAD</a> simulation, together with some useful post-processing tools for obtaining an estimate of the free energy surface. This tutorial does not contain theory explanations. The OPES method is presented in detail in Ref. <a class="el" href="citelist.html#CITEREF_Invernizzi2020rethinking">[73]</a> and in its supporting information.</p>
<h1><a class="anchor" id="opes-metad-resources"></a>
Resources</h1>
<p>The <span style="background-color:yellow"><a href="tutorial-resources/opes-metad.tar.gz" style="font-weight:bold" style="color:green" download="opes-metad.tar.gz">TARBALL</a> </span> for this project contains the following:</p><ul>
<li>input files for running a simple double-well model with <a class="el" href="pesmd.html">pesmd</a></li>
<li>plumed files for <a class="el" href="_o_p_e_s__m_e_t_a_d.html">OPES_METAD</a> and <a class="el" href="_m_e_t_a_d.html">METAD</a> simulations</li>
<li><code>FES_from_Reweighting.py</code>: script for estimating free energy surface via reweighting</li>
<li><code>FES_from_State.py</code>: analogous to <a class="el" href="sum_hills.html">sum_hills</a>, but for OPES simulations</li>
<li><code>State_from_Kernels.py</code>: script for obtaining an OPES state file from a kernels file</li>
</ul>
<h1><a class="anchor" id="opes-metad-simrew"></a>
Simulating and reweighting</h1>
<p>We will perform Langevin dynamics on the following two-dimensional model potential:</p>
<p><a class="anchor" id="opes-metad-ModelPotential"></a></p><div class="image">
<img src="opes-metad-ModelPotential.png" alt=""/>
<div class="caption">
Fig. 1: Model potential</div></div>
<p>To run such simulations, we use the <a class="el" href="pesmd.html">pesmd</a> tool and define the potential directly inside the plumed input file.</p>
<p>We choose as collective variable (CV) the \(x\) coordinate only, in order to mimic a realistic situation in which some of the slow modes of the system are unknown and not accelerated by the biasing. The following is a typical plumed input for performing an <a class="el" href="_o_p_e_s__m_e_t_a_d.html">OPES_METAD</a> simulation:</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">NATURAL<div class="right">( default=off ) use natural units <i></i></div></div> <span style="display:none;" id="eg1">The UNITS action with label <b></b></span>
<b name="eg1p" onclick='showPath("eg1","eg1p")'>p: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <div class="tooltip">COMPONENTS<div class="right">( default=off ) calculate the x, y and z components of the distance separately and
store them as label.x, <i></i></div></div> <span style="display:none;" id="eg1p">The DISTANCE action with label <b>p</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">p.x</td><td>the x-component of the vector connecting the two atoms</td></tr>
<tr><td width="5%%">p.y</td><td>the y-component of the vector connecting the two atoms</td></tr>
<tr><td width="5%%">p.z</td><td>the z-component of the vector connecting the two atoms</td></tr>
</table>
</span>
<b name="eg1opes" onclick='showPath("eg1","eg1opes")'>opes: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_p_e_s__m_e_t_a_d.html" style="color:green">OPES_METAD</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1p">p.x</b> <div class="tooltip">TEMP<div class="right"><b>compulsory keyword ( default=-1 )</b>
temperature. <i></i></div></div>=1 <div class="tooltip">PACE<div class="right"><b>compulsory keyword </b>
the frequency for kernel deposition <i></i></div></div>=500 <div class="tooltip">BARRIER<div class="right"><b>compulsory keyword </b>
the free energy barrier to be overcome. <i></i></div></div>=10 <span style="display:none;" id="eg1opes">The OPES_METAD action with label <b>opes</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">opes.bias</td><td>the instantaneous value of the bias potential</td></tr>
<tr><td width="5%%">opes.rct</td><td>estimate of c(t). \f$\frac{1}{\beta}\log \langle e^{\beta V} \rangle\f$, should become flat as the simulation converges. Do NOT use for reweighting</td></tr>
<tr><td width="5%%">opes.zed</td><td>estimate of Z_n. should become flat once no new CV-space region is explored</td></tr>
<tr><td width="5%%">opes.neff</td><td>effective sample size</td></tr>
<tr><td width="5%%">opes.nker</td><td>total number of compressed kernels used to represent the bias</td></tr>
</table>
</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=500 <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1p">p.x</b>,<b name="eg1p">p.y</b>,<b name="eg1opes">opes.bias</b> <span style="display:none;" id="eg1">The PRINT action with label <b></b></span>
</pre>
<p>By default an <a class="el" href="_o_p_e_s__m_e_t_a_d.html">OPES_METAD</a> simulation generates a KERNELS file that, similarly to the HILLS file from <a class="el" href="_m_e_t_a_d.html">METAD</a>, contains all the Gaussians deposited during the run, and can be used for restarting a simulation. We also print a COLVAR file containing the system coordinates and the instantaneous value of the bias. Here is the time evolution of the \(x\) coordinate.</p>
<p><a class="anchor" id="opes-metad-ColvarOPES"></a></p><div class="image">
<img src="opes-metad-ColvarOPES.png" alt=""/>
<div class="caption">
Fig. 2: Time evolution of the OPES simulation</div></div>
<p>From this simulation we can estimate via reweighting the free energy surface (FES) along \(x\). We use a weighted kernel density estimation with bandwidth <code>sigma</code>, and use block average for uncertainty estimation. You should run the following script from the same folder where the COLVAR file is stored.</p>
<pre class="fragment">../FES_from_Reweighting.py --kt 1 --sigma 0.03 --blocks 5
</pre><p>As value for <code>sigma</code> we used the one from the last line of the KERNELS file. Notice that a similar FES estimate could have been obtained using <a class="el" href="_r_e_w_e_i_g_h_t__b_i_a_s.html">REWEIGHT_BIAS</a> instead of the python script. For this simple system we can compare the result with the true FES (black dashed line):</p>
<p><a class="anchor" id="opes-metad-fesOPES"></a></p><div class="image">
<img src="opes-metad-fesOPES.png" alt=""/>
<div class="caption">
Fig. 3: Free energy estimate obtained by reweighting the OPES simulation</div></div>
<dl class="section note"><dt>Note</dt><dd>If the COLVAR file is not available one can use instead the KERNELS file, choosing the <code>logweight</code> column as bias</dd></dl>
<p>We now run a well-tempered metadynamics simulation on the same system, to get an idea of the differences between the two methods. This is the plumed input used:</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">NATURAL<div class="right">( default=off ) use natural units <i></i></div></div> <span style="display:none;" id="eg2">The UNITS action with label <b></b></span>
<b name="eg2p" onclick='showPath("eg2","eg2p")'>p: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <div class="tooltip">COMPONENTS<div class="right">( default=off ) calculate the x, y and z components of the distance separately and
store them as label.x, <i></i></div></div> <span style="display:none;" id="eg2p">The DISTANCE action with label <b>p</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">p.x</td><td>the x-component of the vector connecting the two atoms</td></tr>
<tr><td width="5%%">p.y</td><td>the y-component of the vector connecting the two atoms</td></tr>
<tr><td width="5%%">p.z</td><td>the z-component of the vector connecting the two atoms</td></tr>
</table>
</span>
<b name="eg2metad" onclick='showPath("eg2","eg2metad")'>metad: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_e_t_a_d.html" style="color:green">METAD</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2p">p.x</b> 
   <div class="tooltip">TEMP<div class="right">the system temperature - this is only needed if you are doing well-tempered metadynamics
<i></i></div></div>=1 
   <div class="tooltip">PACE<div class="right"><b>compulsory keyword </b>
the frequency for hill addition <i></i></div></div>=500 
   <div class="tooltip">HEIGHT<div class="right">the heights of the Gaussian hills. <i></i></div></div>=1 
   <div class="tooltip">SIGMA<div class="right"><b>compulsory keyword </b>
the widths of the Gaussian hills <i></i></div></div>=0.185815 
   <div class="tooltip">BIASFACTOR<div class="right">use well tempered metadynamics and use this bias factor. <i></i></div></div>=10 
   <div class="tooltip">GRID_MIN<div class="right">the lower bounds for the grid <i></i></div></div>=-3.5 
   <div class="tooltip">GRID_MAX<div class="right">the upper bounds for the grid <i></i></div></div>=3.5 
   <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=200 
   <div class="tooltip">CALC_RCT<div class="right">( default=off ) calculate the c(t) reweighting factor and use that to obtain the
normalized bias [rbias=bias-rct].This <i></i></div></div> 
...<span style="display:none;" id="eg2metad">The METAD action with label <b>metad</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">metad.bias</td><td>the instantaneous value of the bias potential</td></tr>
<tr><td width="5%%">metad.rbias</td><td>the instantaneous value of the bias normalized using the c(t) reweighting factor [rbias=bias-rct].This component can be used to obtain a reweighted histogram.</td></tr>
<tr><td width="5%%">metad.rct</td><td>the reweighting factor \f$c(t)\f$.</td></tr>
</table>
</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=500 <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2p">p.x</b>,<b name="eg2p">p.y</b>,<b name="eg2metad">metad.rbias</b>,<b name="eg2metad">metad.rct</b> <span style="display:none;" id="eg2">The PRINT action with label <b></b></span>
</pre>
<p>And here is the resulting \(x\) trajectory.</p>
<p><a class="anchor" id="opes-metad-ColvarMETAD"></a></p><div class="image">
<img src="opes-metad-ColvarMETAD.png" alt=""/>
<div class="caption">
Fig. 4: Time evolution of the metadynamics simulation</div></div>
<p>One can see that with metadynamics more transitions are present, especially in the initial part of the simulation. This is because the bias is changing quickly and can efficiently push the system through high free-energy pathways. Unfortunately, these out-of-equilibrium transitions cannot be efficiently reweighted and might lead to a systematic error.</p>
<p><a class="anchor" id="opes-metad-fesMETAD"></a></p><div class="image">
<img src="opes-metad-fesMETAD.png" alt=""/>
<div class="caption">
Fig. 5: Free energy estimate obtained by (naively) reweighting the metadynamics simulation</div></div>
<p>To avoid this systematic error, one must remove the part of the metadynamics simulation where the bias is not quasi-static. You can do so using the option <code>--skiprows</code> in the <code>FES_from_Reweighting.py</code> script. Removing an initial transient might be useful also for OPES simulations, in particular when the chosen <code>BARRIER</code> is much higher than the real one.</p>
<dl class="section note"><dt>Note</dt><dd>Several different reweighting schemes have been proposed for metadynamics. The one we report here is among the most commonly used, but it is not guaranteed to be the most efficient.</dd></dl>
<h1><a class="anchor" id="opes-metad-fesbias"></a>
Free energy estimate from the bias</h1>
<p>A quick way to get a FES estimate along the biased CVs in OPES, is to directly look at the instantaneous bias \(V_t(x)\), since at convergence \(F(x)=-(1-1/\gamma)^{-1}V(x)\). For metadynamics simulations one should use the <code>rbias</code> instead, which is the bias shifted by the \(c(t)\) factor. In Fig. 6 we plot the COLVAR file using on the x-axis the CV \(x\) and on the y-axis this instantaneous FES estimate, \(F_t(x)\). Points are colored according to the simulation time.</p>
<p><a class="anchor" id="opes-metad-biasFES"></a></p><div class="image">
<img src="opes-metad-biasFES.png" alt=""/>
<div class="caption">
Fig. 6: Free energy estimate obtained from the instantaneous bias</div></div>
<p>We can see that the running estimate from metadynamics has much broader oscillations. This can be seen also in Fig. 3 of Ref. <a class="el" href="citelist.html#CITEREF_Invernizzi2020rethinking">[73]</a>, where only the free energy difference between the basins is plotted. It is also clearly visible that the OPES simulation does not explore free energy regions much higher than the given <code>BARRIER</code> parameter.</p>
<p>Another more common way of obtaining this direct FES estimate from the metadynamics bias is via the <a class="el" href="sum_hills.html">sum_hills</a> tool, e.g. with the following command:</p>
<pre class="fragment">plumed sum_hills --hills HILLS --mintozero --stride 1000
</pre><p>An analogous procedure can be done also with OPES, starting from the STATE file printed during the simulation. This file contains the compressed kernels that are used internally to define the bias, together with all the information needed for a smooth restart. The syntax to print it is similar to the one used to print the bias grid in <a class="el" href="_m_e_t_a_d.html">METAD</a> :</p>

<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">NATURAL<div class="right">( default=off ) use natural units <i></i></div></div> <span style="display:none;" id="eg3">The UNITS action with label <b></b></span>
<b name="eg3p" onclick='showPath("eg3","eg3p")'>p: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <div class="tooltip">COMPONENTS<div class="right">( default=off ) calculate the x, y and z components of the distance separately and
store them as label.x, <i></i></div></div> <span style="display:none;" id="eg3p">The DISTANCE action with label <b>p</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">p.x</td><td>the x-component of the vector connecting the two atoms</td></tr>
<tr><td width="5%%">p.y</td><td>the y-component of the vector connecting the two atoms</td></tr>
<tr><td width="5%%">p.z</td><td>the z-component of the vector connecting the two atoms</td></tr>
</table>
</span>
<b name="eg3opes" onclick='showPath("eg3","eg3opes")'>opes: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_p_e_s__m_e_t_a_d.html" style="color:green">OPES_METAD</a> ...
   <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3p">p.x</b> 
   <div class="tooltip">TEMP<div class="right"><b>compulsory keyword ( default=-1 )</b>
temperature. <i></i></div></div>=1 
   <div class="tooltip">PACE<div class="right"><b>compulsory keyword </b>
the frequency for kernel deposition <i></i></div></div>=500 
   <div class="tooltip">BARRIER<div class="right"><b>compulsory keyword </b>
the free energy barrier to be overcome. <i></i></div></div>=10 
   <div class="tooltip">STATE_WFILE<div class="right">write to this file the compressed kernels and all the info needed to RESTART the
simulation <i></i></div></div>=STATE 
   <div class="tooltip">STATE_WSTRIDE<div class="right">number of MD steps between writing the STATE_WFILE. <i></i></div></div>=500*1000 
   <div class="tooltip">STORE_STATES<div class="right">( default=off ) append to STATE_WFILE instead of ovewriting it each time <i></i></div></div> 
...<span style="display:none;" id="eg3opes">The OPES_METAD action with label <b>opes</b> calculates the following quantities:
<table  align="center" frame="void" width="95%%" cellpadding="5%%">
<tr><td width="5%%"><b> Quantity </b>  </td><td><b> Description </b> </td></tr>
<tr><td width="5%%">opes.bias</td><td>the instantaneous value of the bias potential</td></tr>
<tr><td width="5%%">opes.rct</td><td>estimate of c(t). \f$\frac{1}{\beta}\log \langle e^{\beta V} \rangle\f$, should become flat as the simulation converges. Do NOT use for reweighting</td></tr>
<tr><td width="5%%">opes.zed</td><td>estimate of Z_n. should become flat once no new CV-space region is explored</td></tr>
<tr><td width="5%%">opes.neff</td><td>effective sample size</td></tr>
<tr><td width="5%%">opes.nker</td><td>total number of compressed kernels used to represent the bias</td></tr>
</table>
</span>
</pre>
<p>If you did not dump the STATE file while running your simulation, you can recover it with the <a class="el" href="driver.html">driver</a> (see <a class="el" href="_r_e_a_d.html">READ</a>). The script <code>State_from_Kernels.py</code> contains the minimal input to do so, and only requires the KERNELS file.</p>
<p>If the STATE file is available, one can run the provided script with the following command:</p>
<pre class="fragment">../FES_from_State.py --kt 1 --all_stored
</pre><p>For <a class="el" href="_o_p_e_s__m_e_t_a_d.html">OPES_METAD</a> the resulting FES estimate will be very similar to the one obtained from reweighting.</p>
<p>In this tutorial a single simulation is presented for OPES and metadynamics, but you can check Fig. S2 and S3 in the supporting information of Ref. <a class="el" href="citelist.html#CITEREF_Invernizzi2020rethinking">[73]</a> to see the results obtained by averaging 100 independent realizations.</p>
<h1><a class="anchor" id="opes-metad-misc"></a>
Some other considerations</h1>
<p>The <a class="el" href="_o_p_e_s__m_e_t_a_d.html">OPES_METAD</a> has a few quantities one can print to monitor the simulation:</p><ul>
<li><code>rct</code>, contrary to the one of <a class="el" href="_m_e_t_a_d.html">METAD</a>, converges to a constant and can be useful to quickly check the status of the simulation, especially when running with many CVs. It should not be used for reweighting.</li>
<li><code>zed</code> should change only when a new region of CV-space is sampled.</li>
<li><code>neff</code> is an estimate of the effective sample size and should always grow.</li>
<li><code>nker</code> is the number of compressed kernels. If it is equal to the number of deposited kernels, it means that the simulation never comes back to where it has already been (too many CVs? too small <code>SIGMA</code>? too small <code>COMPRESSION_THRESHOLD</code>?).</li>
</ul>
<p>Finally, here are some optional keywords that might be useful:</p><ul>
<li><code>NLIST</code> activates a neighbor list over the kernels. It can considerably speed up the simulation, especially when using two or more CVs.</li>
<li><code>SIGMA_MIN</code> can be useful to reduce the total number of compressed kernels (<code>nker</code>) and thus speed up the simulation. It can help especially with long simulations, and can also be added after a restart (see also <code>FIXED_SIGMA</code>). </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_add_mod.html">Additional Modules</a></li><li class="navelem"><a class="el" href="_o_p_e_s.html">OPES (On-the-fly Probability Enhanced Sampling)</a></li><li class="navelem"><a class="el" href="_o_p_e_s_tutorial.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
