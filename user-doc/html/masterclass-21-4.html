<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: PLUMED Masterclass 21.4: Metadynamics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('masterclass-21-4.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PLUMED Masterclass 21.4: Metadynamics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Authors</dt><dd>Max Bonomi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 1, 2021</dd></dl>
<h1><a class="anchor" id="masterclass-21-4-aims"></a>
Aims</h1>
<p>The aim of this Masterclass is to train users to perform and analyze a metadynamics simulation with PLUMED.</p>
<h1><a class="anchor" id="masterclass-21-4-lo"></a>
Objectives</h1>
<p>Once this Masterclass is completed, users will be able to:</p>
<ul>
<li>Write the PLUMED input file to perform metadynamics simulations.</li>
<li>Calculate the free energy as a function of the metadynamics collective variables.</li>
<li>Unbias metadynamics simulations.</li>
<li>Estimate the error in the reconstructed free energies using block analysis.</li>
<li>Assess the convergence of metadynamics simulations.</li>
<li>Recognize good from bad collective variables.</li>
</ul>
<h1><a class="anchor" id="masterclass-21-4-theory"></a>
Overview of the theory</h1>
<p>PLUMED can be used not only to analyze a pre-existing MD trajectory, but also to add forces on the CVs during a MD simulation, for example, in order to accelerate sampling. To this aim, we have implemented a variety of possible biases acting on CVs. The complete documentation for all the biasing methods available in PLUMED can be found at the <a class="el" href="_bias.html">Bias</a> page. In the following we will learn how to use PLUMED to perform and analyze a metadynamics simulation. The users are invited to familiarize with the theory behind this method by looking at one of the many reviews available, such as <a class="el" href="citelist.html#CITEREF_gerv-laio09review">[79]</a> <a class="el" href="citelist.html#CITEREF_WCMS:WCMS31">[12]</a> <a class="el" href="citelist.html#CITEREF_WCMS:WCMS1103">[128]</a> <a class="el" href="citelist.html#CITEREF_bussi2015free">[31]</a>. Below you can find a brief recap of the basic metadynamics theory.</p>
<p> <details> <summary> <b> To learn more: Summary of theory </b> </summary> <div class="hidden"> </p>
<p>In metadynamics, an external history-dependent bias potential is constructed in the space of a few selected degrees of freedom \( \vec{s}({q})\), generally called collective variables (CVs) <a class="el" href="citelist.html#CITEREF_metad">[80]</a>. This potential is built as a sum of Gaussian kernels deposited along the trajectory in the CVs space:</p>
<p class="formulaDsp">
\[ V(\vec{s},t) = \sum_{ k \tau &lt; t} W(k \tau) \exp\left( -\sum_{i=1}^{d} \frac{(s_i-s_i({q}(k \tau)))^2}{2\sigma_i^2} \right). \]
</p>
<p>where \( \tau \) is the Gaussian deposition stride, \( \sigma_i \) the width of the Gaussian for the \(i\)th CV, and \( W(k \tau) \) the height of the Gaussian. The effect of the metadynamics bias potential is to push the system away from local minima into visiting new regions of the phase space. Furthermore, in the long time limit, the bias potential converges to minus the free energy as a function of the CVs:</p>
<p class="formulaDsp">
\[ V(\vec{s},t\rightarrow \infty) = -F(\vec{s}) + C. \]
</p>
<p>In standard metadynamics, Gaussian kernels of constant height are added for the entire course of a simulation. As a result, the system is eventually pushed to explore high free-energy regions and the estimate of the free energy calculated from the bias potential oscillates around the real value. In well-tempered metadynamics <a class="el" href="citelist.html#CITEREF_Barducci:2008">[11]</a>, the height of the Gaussian is decreased with simulation time according to:</p>
<p class="formulaDsp">
\[ W (k \tau ) = W_0 \exp \left( -\frac{V(\vec{s}({q}(k \tau)),k \tau)}{k_B\Delta T} \right ), \]
</p>
<p>where \( W_0 \) is an initial Gaussian height, \( \Delta T \) an input parameter with the dimension of a temperature, and \( k_B \) the Boltzmann constant. With this rescaling of the Gaussian height, the bias potential smoothly converges in the long time limit, but it does not fully compensate the underlying free energy:</p>
<p class="formulaDsp">
\[ V(\vec{s},t\rightarrow \infty) = -\frac{\Delta T}{T+\Delta T}F(\vec{s}) + C. \]
</p>
<p>where \( T \) is the temperature of the system. In the long time limit, the CVs thus sample an ensemble at a temperature \( T+\Delta T \) which is higher than the system temperature \( T \). The parameter \( \Delta T \) can be chosen to regulate the extent of free-energy exploration: \( \Delta T = 0\) corresponds to standard MD, \( \Delta T \rightarrow\infty\) to standard metadynamics. In well-tempered metadynamics literature and in PLUMED, you will often encounter the term "bias factor" which is the ratio between the temperature of the CVs ( \( T+\Delta T \)) and the system temperature ( \( T \)):</p>
<p class="formulaDsp">
\[ \gamma = \frac{T+\Delta T}{T}. \]
</p>
<p>The bias factor should thus be carefully chosen in order for the relevant free-energy barriers to be crossed efficiently in the time scale of the simulation.</p>
<p>Additional information can be found in the several review papers on metadynamics <a class="el" href="citelist.html#CITEREF_gerv-laio09review">[79]</a> <a class="el" href="citelist.html#CITEREF_WCMS:WCMS31">[12]</a> <a class="el" href="citelist.html#CITEREF_WCMS:WCMS1103">[128]</a> <a class="el" href="citelist.html#CITEREF_bussi2015free">[31]</a>.</p>
<p> </div> </details> </p>
<h1><a class="anchor" id="masterclass-21-4-install"></a>
Setting up the software</h1>
<p>The users can refer to the procedure introduce in <a class="el" href="masterclass-21-1.html">PLUMED Masterclass 21.1: PLUMED syntax and analysis</a> and <a class="el" href="masterclass-21-3.html">PLUMED Masterclass 21.3: Umbrella sampling</a> to install the required software. In this class, we will perform the simulations ourselves, so make sure that the <a href="https://www.gromacs.org">GROMACS</a> code is properly installed.</p>
<h1><a class="anchor" id="masterclass-21-4-resources"></a>
Resources</h1>
<p>The data needed to complete the exercises of this Masterclass can be found on <a href="https://github.com/plumed/masterclass-21-4">GitHub</a>. You can clone this repository locally on your machine using the following command:</p>
<pre class="fragment">git clone https://github.com/plumed/masterclass-21-4.git
</pre><p>This repositoy contains 3 folders:</p><ul>
<li><code>data</code>: GROMACS topology/PDB files for the two systems that we are going to simulate and python script for error analysis;</li>
<li><code>notebooks</code>: Jupyter notebook to be used as template for the analysis of the PLUMED output;</li>
<li><code>slides</code>: a brief presentation of the metadynamics theory. <br  />
</li>
</ul>
<p>To keep things clean, it is recommended to run each exercise in a separate sub-directory (i.e. Exercise-1, Exercise-2, ...), which you can create inside the root directory <code>masterclass-21-4</code>. The students are invited to solve the exercises by themselves after completing the PLUMED input file templates provided below. In case of problems, students can rely on the solution notebook <code>solution.ipynb</code> provided in the <a href="https://github.com/plumed/masterclass-21-4">GitHub</a> repository.</p>
<p>In many exercises, we will play with a toy system, alanine dipeptide simulated in vacuo (see Fig. <a class="el" href="masterclass-21-4.html#master-ISDD-2-ala-fig">master-ISDD-2-ala-fig</a>). This rather simple molecule is useful to understand data analysis and free-energy methods. This system is a nice example because it presents two metastable states separated by a high free-energy barrier. It is conventional use to characterize the two states in terms of Ramachandran dihedral angles, which are denoted with \( \phi \) (phi) and \( \psi \) (psi) in Fig. <a class="el" href="masterclass-21-4.html#master-ISDD-2-transition-fig">master-ISDD-2-transition-fig</a>. In the <code>data/diala</code> directory of the <code>GitHub</code> repository for this Masterclass, you will find two GROMACS <code>.tpr</code> files (<code>topolA.tpr</code> and <code>topolB.tpr</code>), which contain all the necessary information to perform a simulation starting from either one of the two metastable states of alanine dipeptide.</p>
<p><a class="anchor" id="master-ISDD-2-ala-fig"></a></p><div class="image">
<img src="belfast-2-ala.png" alt=""/>
<div class="caption">
The molecule of the day: alanine dipeptide.</div></div>
<p><a class="anchor" id="master-ISDD-2-transition-fig"></a></p><div class="image">
<img src="belfast-2-transition.png" alt=""/>
<div class="caption">
Two metastable states of alanine dipeptide are characterized by their Ramachandran dihedral angles.</div></div>
<dl class="section note"><dt>Note</dt><dd>All the exercises have been tested with PLUMED version 2.7.0 and GROMACS 2019.6.</dd></dl>
<h1><a class="anchor" id="masterclass-21-4-ex"></a>
Exercises</h1>
<h2><a class="anchor" id="masterclass-21-4-ex-1"></a>
Exercise 1: Familiarizing with alanine dipeptide</h2>
<p>In this brief exercise, we will perform two 20 ns long standard MD simulations of alanine dipeptide starting from the two main metastable states of this system. To keep things clean, the users are invited to run these two simulations in two separate sub-folders. To run these simulations with GROMACS, please use the following commands:</p>
<pre class="fragment"># run this command in one directory
gmx mdrun -s topolA.tpr -nsteps 10000000
# and this in another one
gmx mdrun -s topolB.tpr -nsteps 10000000
</pre><p>After the simulations are completed, we can use PLUMED to monitor the behavior of the system. As learnt in <a class="el" href="masterclass-21-1.html">PLUMED Masterclass 21.1: PLUMED syntax and analysis</a>, PLUMED can compute and print collective variables (CVs) on a pre-calculated MD trajectory. Here, we will:</p><ul>
<li>create a PLUMED input file with a text editor;</li>
<li>run the PLUMED <a class="el" href="driver.html">driver</a> utility;</li>
<li>visualize the output with the aid of a Jupyter notebook.</li>
</ul>
<p>Let's now prepare a PLUMED input file to calculate:</p><ul>
<li>the value of the backbone dihedral \( \phi \);</li>
<li>the value of the backbone dihedral \( \psi \).</li>
</ul>
<p>by completing the template below (whenever you see an highlighted <span style="background-color:yellow">FILL</span> string, this is a string that you must replace!):</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Activate MOLINFO functionalities</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Compute the backbone dihedral angle phi, defined by atoms C-N-CA-C</span>
<span style="color:blue"># you should use MOLINFO shortcuts</span>
<b name="eg1phi" onclick='showPath("eg1","eg1phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg1phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Compute the backbone dihedral angle psi, defined by atoms N-CA-C-N</span>
<span style="color:blue"># here also you should to use MOLINFO shortcuts</span>
<b name="eg1psi" onclick='showPath("eg1","eg1psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg1psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print the two collective variables on COLVAR file every step</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Once your <code>plumed.dat</code> file is complete, you can run the PLUMED <a class="el" href="driver.html">driver</a> on the two MD trajectories as follows:</p>
<pre class="fragment">plumed driver --plumed plumed.dat --mf_xtc traj_comp.xtc
</pre><p>The two <code>COLVAR</code> files can be analyzed using the Jupyter notebook <code>plumed-pandas.ipynb</code> provided in the folder <code>notebooks</code>. This notebook allows you to import a <code>COLVAR</code> file produced by PLUMED and to generate the desired figures using the <code>matplotlib</code> library. The users are invited to:</p><ul>
<li>inspect the dynamics of the two backbone dihedrals in the two separate simulations;</li>
<li>calculate the fluctuations (standard deviation) of the two CVs in the different basins visited.</li>
</ul>
<p><b>Are both simulations long enough to visit all the relevant conformations or instead they remain trapped in different regions of the</b> \( \phi \) / \( \psi \) <b>space?</b></p>
<h2><a class="anchor" id="masterclass-21-4-ex-2"></a>
Exercise 2: My first metadynamics simulation</h2>
<p>In this exercise we will setup and perform a well-tempered metadynamics run using the backbone dihedral \( \phi \) as collective variable. During the calculation, we will also monitor the behavior of the other backbone dihedral \( \psi \). Here you can find a sample <code>plumed.dat</code> file that you can use as a template.</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Activate MOLINFO functionalities</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Compute the backbone dihedral angle phi, defined by atoms C-N-CA-C</span>
<span style="color:blue"># you should use MOLINFO shortcuts</span>
<b name="eg2phi" onclick='showPath("eg2","eg2phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Compute the backbone dihedral angle psi, defined by atoms N-CA-C-N</span>
<span style="color:blue"># here also you should to use MOLINFO shortcuts</span>
<b name="eg2psi" onclick='showPath("eg2","eg2psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Activate well-tempered metadynamics in phi</span>
<b name="eg2metad" onclick='showPath("eg2","eg2metad")'>metad: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <div class="tooltip">ARG<div class="right"><b> could not find this keyword </b><i></i></div></div>=<span style="background-color:yellow">__FILL__</span> 
   <span style="color:blue"># Deposit a Gaussian every 500 time steps, with initial height </span>
   <span style="color:blue"># equal to 1.2 kJ/mol and bias factor equal to 8 </span>
   <div class="tooltip">PACE<div class="right"><b> could not find this keyword </b><i></i></div></div>=500 <div class="tooltip">HEIGHT<div class="right"><b> could not find this keyword </b><i></i></div></div>=1.2 <div class="tooltip">BIASFACTOR<div class="right"><b> could not find this keyword </b><i></i></div></div>=8 
   <span style="color:blue"># Gaussian width (sigma) should be chosen based on the CV fluctuations in unbiased run </span>
   <span style="color:blue"># try 1/2 or 1/3 of the estimated fluctuations </span>
   <div class="tooltip">SIGMA<div class="right"><b> could not find this keyword </b><i></i></div></div>=<span style="background-color:yellow">__FILL__</span> 
   <span style="color:blue"># Gaussians will be written to file and also stored on grid </span>
   <div class="tooltip">FILE<div class="right"><b> could not find this keyword </b><i></i></div></div>=HILLS <div class="tooltip">GRID_MIN<div class="right"><b> could not find this keyword </b><i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b> could not find this keyword </b><i></i></div></div>=pi 
...<span style="display:none;" id="eg2metad"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print both collective variables on COLVAR file every 10 steps</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Once your <code>plumed.dat</code> file is complete, you can run a 20 ns long metadynamics simulations starting from either of the two provided conformations, for example <code>topolA.tpr</code>. All you need to do is execute the following command:</p>
<pre class="fragment">gmx mdrun -s topolA.tpr -nsteps 10000000 -plumed plumed.dat 
</pre><p>During the metadynamics simulation, PLUMED will create two files, named <code>COLVAR</code> and <code>HILLS</code>. The <code>COLVAR</code> file contains all the information specified by the <a class="el" href="_p_r_i_n_t.html">PRINT</a> command, in this case the value of the backbone dihedrals \( \phi \) and \( \psi \) every 10 steps of simulation. The <code>HILLS</code> file contains a list of the Gaussian kernels deposited along the simulation.</p>
<p>Let's visualize the time series of the two collective variables. Take your time to inspect the behavior of the two CVs. <b>What are the main differences with respect to the trajectory produced in</b> <a class="el" href="masterclass-21-4.html#masterclass-21-4-ex-1">Exercise 1: Familiarizing with alanine dipeptide</a> <b>?</b></p>
<p>At this point, we can estimate the free energy as a function of the metadynamics CV directly from the metadynamics bias potential. In order to do so, the utility <a class="el" href="sum_hills.html">sum_hills</a> can be used to sum the Gaussian kernels deposited during the simulation and stored in the <code>HILLS</code> file. <br  />
 To calculate the free energy as a function of \( \phi \), it is sufficient to use the following command line:</p>
<pre class="fragment">plumed sum_hills --hills HILLS
</pre><p>The command above generates a file called <code>fes.dat</code> in which the free-energy surface as function of \( \phi \) is calculated on a regular grid. One can modify the default name for the free-energy file, as well as the boundaries and bin size of the grid, by using the following <a class="el" href="sum_hills.html">sum_hills</a> options:</p>
<pre class="fragment">--outfile - specify the outputfile for sumhills
--min - the lower bounds for the grid
--max - the upper bounds for the grid
--bin - the number of bins for the grid
--spacing - grid spacing, alternative to the number of bins
</pre><p>To give a preliminary assessment of the convergence of a metadynamics simulation, one can calculate the estimate of the free energy as a function of simulation time. At convergence, the reconstructed profiles should be similar. The <a class="el" href="sum_hills.html">sum_hills</a> option <code>--stride</code> should be used to give an estimate of the free energy every <code>N</code> Gaussian kernels deposited, and the option <code>--mintozero</code> can be used to align the profiles by setting the global minimum to zero. If we use the following command line:</p>
<pre class="fragment">plumed sum_hills --hills HILLS --stride 200 --mintozero
</pre><p>one free energy is calculated every 200 Gaussian kernels deposited, and the global minimum is set to zero in all profiles. Now, you can visualize the free-energy estimate as a function of simulation time and assess how it changed during the course of the simulation. In the last part of this 20 ns long metadynamics simulation, the free-energy estimate should not change significantly.</p>
<p>Looking at the time-evolution of the entire free-energy profile might not be straightforward. Therefore, what we usually do is focusing on a few metastable states, or local free-energy minima, and calculating their estimated free-energy difference as a function of time. In case of alanine dipeptide, this is rather easy since there are only two major states in the free-energy profile as a function of the CV \(\phi\).</p>
<p>The users should now:</p><ul>
<li>calculate from the estimate of the free energy \(F(\phi)\) at a given simulation time, the difference in free energy between the two basins. In order to do this, you should define a reasonable interval around the two local free-energy minima and recall that the probability of this state is the integral of the probability \( P(\phi)= exp(-F(\phi)/k_BT) \) in the chosen interval;</li>
<li>plot the estimated free-energy difference as a function of simulation time.</li>
</ul>
<p>These two observations:</p><ol type="1">
<li>the system is diffusing rapidly in the entire CV space</li>
<li>the estimated free energy does not significantly change as a function of time</li>
</ol>
<p>are two indications that the simulation <b>might</b> have converged.</p>
<dl class="section warning"><dt>Warning</dt><dd>The two conditions listed above are necessary, but not sufficient to declare convergence. We will learn below how to perform a quantitative analysis of the convergence of a metadynamics simulation.</dd></dl>
<h2><a class="anchor" id="masterclass-21-4-ex-3"></a>
Exercise 3: Reweighting (unbiasing) a metadynamics simulation</h2>
<p>In the previous exercise we biased \(\phi\) and computed the free energy as a function of the same variable directly from the metadynamics bias potential using the <a class="el" href="sum_hills.html">sum_hills</a> utility. However, in many cases you might decide which variable should be analyzed <em>after</em> having performed a metadynamics simulation. For example, you might want to calculate the free energy as a function of CVs other than those biased during the metadynamics simulation, such as the dihedral \( \psi \). At variance with standard MD simulations, you cannot simply calculate histograms of other variables directly from your metadynamics trajectory, because the presence of the metadynamics bias potential has altered the statistical weight of each frame. To remove the effect of this bias and thus be able to calculate properties of the system in the unbiased ensemble, you must reweight (unbias) your simulation.</p>
<p>There are multiple ways to calculate the correct statistical weight of each frame in your metadynamics trajectory and thus to reweight your simulation. For example:</p>
<ol type="1">
<li>weights can be calculated by considering the time-dependence of the metadynamics bias potential <a class="el" href="citelist.html#CITEREF_Tiwary_jp504920s">[130]</a>;</li>
<li>weights can be calculated using the metadynamics bias potential obtained at the end of the simulation and assuming a constant bias during the entire course of the simulation <a class="el" href="citelist.html#CITEREF_Branduardi:2012dl">[29]</a>.</li>
</ol>
<p>In this exercise we will use the second method, which is identical to the umbrella-sampling reweighting approach that you have already used in <a class="el" href="masterclass-21-2.html">PLUMED Masterclass 21.2: Statistical errors in MD</a> and <a class="el" href="masterclass-21-3.html">PLUMED Masterclass 21.3: Umbrella sampling</a>. In order to compute the weights we will use the <a class="el" href="driver.html">driver</a> tool.</p>
<p>First of all, you need to prepare a <code>plumed_reweight.dat</code> file that is identical to the one you used for running your metadynamics simulation except for a few modifications:</p><ul>
<li>you need to add the keyword <code>RESTART=YES</code> to the <a class="el" href="_m_e_t_a_d.html">METAD</a> command. This will make this action behave as if PLUMED was restarting, i.e. PLUMED will read from the <code>HILLS</code> file the Gaussians that have previously been accumulated;</li>
<li>you need to set the Gaussian <code>HEIGHT</code> to zero and the <code>PACE</code> to a large number. This will actually avoid adding new Gaussians (and even if they are added they will have zero height);</li>
<li>you need to modify the <a class="el" href="_p_r_i_n_t.html">PRINT</a> statement so that you write every frame and that, in addition to <code>phi</code> and <code>psi</code>, you also write <code>metad.bias</code>;</li>
<li>you might also want to change the name of the output file to <code>COLVAR_REWEIGHT</code>.</li>
</ul>
<p>Here how the <code>plumed_reweight.dat</code> should look like:</p>

<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Activate MOLINFO functionalities</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <span style="color:blue"># here goes the definitions of the phi and psi CVs </span><span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Activate well-tempered metadynamics in phi</span>
<b name="eg3metad" onclick='showPath("eg3","eg3metad")'>metad: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <div class="tooltip">ARG<div class="right"><b> could not find this keyword </b><i></i></div></div>=<span style="background-color:yellow">__FILL__</span> 
   <span style="color:blue"># Deposit a Gaussian every 10000000 time steps (never!), with initial height equal to 0.0 kJ/mol </span>
   <div class="tooltip">PACE<div class="right"><b> could not find this keyword </b><i></i></div></div>=10000000 <div class="tooltip">HEIGHT<div class="right"><b> could not find this keyword </b><i></i></div></div>=0.0 <span style="color:blue"># &lt;- this is the new stuff! </span>
   <span style="color:blue"># The bias factor and Gaussian width are the same as before </span>
   <div class="tooltip">BIASFACTOR<div class="right"><b> could not find this keyword </b><i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">SIGMA<div class="right"><b> could not find this keyword </b><i></i></div></div>=<span style="background-color:yellow">__FILL__</span> 
   <span style="color:blue"># Gaussians will be read from file and stored on grid </span>
   <span style="color:blue"># Make sure you specify the path the HILLS file produced in Exercise 2! </span>
   <div class="tooltip">FILE<div class="right"><b> could not find this keyword </b><i></i></div></div>=HILLS <div class="tooltip">GRID_MIN<div class="right"><b> could not find this keyword </b><i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b> could not find this keyword </b><i></i></div></div>=pi 
   <span style="color:blue"># Say that METAD should be restarting (= reading an existing HILLS file) </span>
   <div class="tooltip">RESTART<div class="right"><b> could not find this keyword </b><i></i></div></div>=YES <span style="color:blue"># &lt;- this is the new stuff! </span>
...<span style="display:none;" id="eg3metad"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print out the values of phi, psi and the metadynamics bias potential</span>
<span style="color:blue"># Make sure you print out the 3 variables in the specified order at every step</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR_REWEIGHT <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="color:blue"># &lt;- also change this one! </span><span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Now you can run the <a class="el" href="driver.html">driver</a> tool using this command:</p>
<pre class="fragment">plumed driver --mf_xtc traj_comp.xtc --plumed plumed_reweight.dat --kt 2.494339 
</pre><p>where <code>traj_comp.xtc</code> is the metadynamics trajectory produced in <a class="el" href="masterclass-21-4.html#masterclass-21-4-ex-2">Exercise 2: My first metadynamics simulation</a>. Notice that you have to specify the value of \(k_BT\) in energy units. While running your simulation this information was communicated by the MD code.</p>
<p>As a result, PLUMED will produce a new <code>COLVAR_REWEIGHT</code> file with one additional column containing the metadynamics bias potential \( V(s) \) calculated using all the Gaussians deposited along the entire trajectory. You can easily obtain the weight \( w \) of each frame using the expression \(w\propto\exp\left(\frac{V(s)}{k_BT}\right)\) (umbrella-sampling-like reweighting). At this point, you can read the <code>COLVAR_REWEIGHT</code> file using a python notebook and compute a weighted histogram or, alternatively, if you want PLUMED to do the weighted histograms for you, you can add the following lines at the end of the <code>plumed_reweight.dat</code> file and re-run PLUMED driver:</p>

<div style="width: 90%; float:left" id="value_details_eg4"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Use the metadynamics bias as argument</span>
<b name="eg4as" onclick='showPath("eg4","eg4as")'>as: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_r_e_w_e_i_g_h_t__b_i_a_s.html" style="color:green">REWEIGHT_BIAS</a> <div class="tooltip">ARG<div class="right"><b>compulsory keyword ( default=*.bias )</b>
the biases that must be taken into account when reweighting <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg4as"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Calculate histograms of phi and psi dihedrals every 50 steps</span>
<span style="color:blue"># using the weights obtained from the metadynamics bias potentials (umbrella-sampling-like reweighting)</span>
<span style="color:blue"># Look at the manual to understand the parameters of the HISTOGRAM action!</span>
<b name="eg4hhphi" onclick='showPath("eg4","eg4hhphi")'>hhphi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=phi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=50 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.05 <div class="tooltip">LOGWEIGHTS<div class="right">list of actions that calculates log weights that should be used to weight configurations
when calculating averages <i></i></div></div>=<b name="eg4as">as</b> <span style="display:none;" id="eg4hhphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4hhpsi" onclick='showPath("eg4","eg4hhpsi")'>hhpsi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=psi <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=50 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-pi <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=pi <div class="tooltip">GRID_BIN<div class="right">the number of bins for the grid <i></i></div></div>=50 <div class="tooltip">BANDWIDTH<div class="right"><b>compulsory keyword </b>
the bandwidths for kernel density estimation <i></i></div></div>=0.05 <div class="tooltip">LOGWEIGHTS<div class="right">list of actions that calculates log weights that should be used to weight configurations
when calculating averages <i></i></div></div>=<b name="eg4as">as</b> <span style="display:none;" id="eg4hhpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Convert histograms h(s) to free energies F(s) = -kBT * log(h(s))</span>
<b name="eg4ffphi" onclick='showPath("eg4","eg4ffphi")'>ffphi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg4hhphi">hhphi</b> <span style="display:none;" id="eg4ffphi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4ffpsi" onclick='showPath("eg4","eg4ffpsi")'>ffpsi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_n_v_e_r_t__t_o__f_e_s.html" style="color:green">CONVERT_TO_FES</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the input grid you would like to use <i></i></div></div>=<b name="eg4hhpsi">hhpsi</b> <span style="display:none;" id="eg4ffpsi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print out the free energies F(s) to file once the entire trajectory is processed</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg4ffphi">ffphi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=<b name="eg4ffphi">ffphi.dat</b> <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_u_m_p_g_r_i_d.html" style="color:green">DUMPGRID</a> <div class="tooltip">GRID<div class="right"><b>compulsory keyword </b>
the action that creates the grid you would like to output <i></i></div></div>=<b name="eg4ffpsi">ffpsi</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword ( default=density )</b>
the file on which to write the grid. <i></i></div></div>=<b name="eg4ffpsi">ffpsi.dat</b> <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>You can now compare the free energies as a function of \( \phi \) calculated:</p><ol type="1">
<li>directly from the metadynamics bias potential using <a class="el" href="sum_hills.html">sum_hills</a> as done in <a class="el" href="masterclass-21-4.html#masterclass-21-4-ex-2">Exercise 2: My first metadynamics simulation</a>;</li>
<li>using the reweighting procedure introduced in this exercise.</li>
</ol>
<p><b>Are the two free energies identical?</b></p>
<h2><a class="anchor" id="masterclass-21-4-ex-4"></a>
Exercise 4: Estimating the error in free energies using block-analysis</h2>
<p>In the previous exercise, we calculated the <em>final</em> bias \( V(s) \) on the entire metadynamics trajectory and we used this quantity to calculate the correct statistical weight of each frame, which is needed to reweight the biased simulation. In this exercise, the user will learn how this information can be used to calculate the error in the reconstructed free energies and assess whether the simulation is converged or not.</p>
<p>Let's first:</p><ul>
<li>calculate the un-biasing weights \(w\propto\exp\left(\frac{V(s)}{k_BT}\right)\) from the <code>COLVAR_REWEIGHT</code> file obtained at the end of <a class="el" href="masterclass-21-4.html#masterclass-21-4-ex-3">Exercise 3: Reweighting (unbiasing) a metadynamics simulation</a>;</li>
<li>print them in a file (called for example <code>phi.weight</code>) containing the value of the dihedral \( \phi \) and the corresponding (un-normalized) weight \( w \) for each frame of the metadynamics trajectory.</li>
</ul>
<p>At this point we can apply the block-analysis technique (for more info about the theory, have a look at <a class="el" href="masterclass-21-2.html">PLUMED Masterclass 21.2: Statistical errors in MD</a>) to calculate the average free energy across the blocks and the error as a function of block size. For your convenience, the <code>do_block_fes.py</code> python script provided in the <code>data</code> directory of the <code>GitHub</code> repository of this Masterclass can be used to read the <code>phi.weight</code> file and produce the desired output. The users should properly choose the following input parameters:</p>
<pre class="fragment"># Arguments of do_block_fes.py
# - FILE: input file with 2 colums containing the CV value and weight for each frame of the trajectory
# - NCV: number of CVs
# - MIN/MAX: CV range
# - NBIN: # points in output free energy
# - KBT: temperature in energy units (kJoule/mol)
# - N: Block size
# 
python3 do_block_fes.py FILE NCV MIN MAX NBIN KBT N
</pre><p>and run the above script for different block sizes ranging from 1 to 1000. For each choice of block size, the script will produce an output file, which contains 3 colums:</p><ul>
<li>the value of the \( \phi \) variable on a grid;</li>
<li>the free energy averaged across the blocks for each point of the grid;</li>
<li>the associated error for each point of the grid.</li>
</ul>
<p>At this point, the users should:</p><ul>
<li>calculate the average error across the free-energy profile, i.e. the grid points, for each block size chosen;</li>
<li>visualize this average error as a function of the block size.</li>
</ul>
<p>The users should verify that the error increases with the block size (why?) until it reaches a plateau when the dimension of the block exceeds the correlation time between data points. If a plateau is not observed, then the simulation is not converged yet and should be run a bit longer.</p>
<p><b>From this analysis, what can we say about the convergence of the metadynamics simulation performed in</b> <a class="el" href="masterclass-21-4.html#masterclass-21-4-ex-2">Exercise 2: My first metadynamics simulation</a> <b>?</b></p>
<h2><a class="anchor" id="masterclass-21-4-ex-5"></a>
Exercise 5: Recognizing good from bad CVs</h2>
<p>In the previous exercises, we have performed a metadynamics simulation on alanine dipeptide using the backbone dihedral \( \phi \) as CV. We have analyzed the simulation and noticed that:</p><ul>
<li>under the effect of the bias potential, the system rapidly diffuses in the entire CV space;</li>
<li>the error in the reconstructed free energy calculated with block analysis rapidly reaches a plateau.</li>
</ul>
<p>These two observations indicate that our simulation is converged and that the dihedral \( \phi \) can be considered a <em>good</em> CV. A good set of CVs for metadynamics should indeed:</p><ol type="1">
<li>discriminate between the relevant metastable states of the system;</li>
<li>include all the slow modes that characterize transitions between such states;</li>
<li>be as small as possible.</li>
</ol>
<p>Identifying a priori a good set of CVs to describe a specific problem is far from trivial. In this exercise, the users will learn how to detect potential problems in their choice of CV(s). Let's first perform additional 1D metadynamics simulations using one of the following CVs:</p><ul>
<li>the dihedral \( \psi \);</li>
<li>the radius of gyration, defined on all the heavy atoms of the system;</li>
<li>the distance between Oxigen atom 6 and Hydrogen atom 8.</li>
</ul>
<p>The users are invited to prepare, for each of the CV listed above, a PLUMED input file to perform a 1D well-tempered metadynamics simulation, execute the simulation, and analyse the results in terms of:</p><ul>
<li>diffusion of the system in the space of the dihedral \( \phi \)</li>
<li>error analysis in the free energy as a function of \( \phi \)</li>
</ul>
<p>and compare the results with the previous simulation in which \( \phi \) was used as the metadynamics CV. <b>Based on this analysis, can you discriminate between <em>good</em> from <em>bad</em> CVs?</b></p>
<p>To complete this exercise, the users should define and test a new CV that is either:</p><ul>
<li>as good as the dihedral \( \phi \);</li>
<li>the worst possible CV to accelerate sampling and describe the two main conformational states of alanine dipeptide.</li>
</ul>
<p><b>Please post the results of your simulations on Slack!</b></p>
<h2><a class="anchor" id="masterclass-21-4-ex-6"></a>
Exercise 6: A 'real-life' application</h2>
<p>In this last exercise, we will tackle a real-life biological problem: studying the conformational transition of a complex biological system. The system that we are going to study is the C-terminal domain (CTD) of the RfaH virulence factor from <em>Escherichia coli</em>. This part of the system, which we refer to as RfaH-CTD, undergoes a dramatic conformational transformation from β-barrel to α-helical, which is stabilized by the N-terminal domain of the RfaH virulence factor (see Fig. <a class="el" href="masterclass-21-4.html#masterclass-21-4-RfaH-CTD-fig">masterclass-21-4-RfaH-CTD-fig</a>).</p>
<p><a class="anchor" id="masterclass-21-4-RfaH-CTD-fig"></a> </p><div class="image">
<img src="RfaH-CTD.png" alt=""/>
<div class="caption">
Structural transformation of the RfaH-CTD. Domain dissociation is triggered upon binding of the NTD (gray) to its target ops (operon polarity suppressor) element DNA, relieving the autoinhibited state and allowing the transformation of the CTD (colored) from an α-helical hairpin (A) towards a five-stranded β-barrel (B). Note that the NTD and CTD are connected by a linker that does not order within the crystals and therefore is not shown in the figure.</div></div>
<p>In the <code>data/RfaH-CTD</code> folder of the <code>GitHub</code> repository of this Masterclass, you will find:</p><ul>
<li>two PDB files of RfaH-CTD in the α-helical and β-barrel states;</li>
<li>a <code>topol.tpr</code> file, which is needed to perform a MD simulation of this sytem with GROMACS.</li>
</ul>
<p>The objective of this exercises are to:</p><ol type="1">
<li>compute the free-energy difference between the α-helical and β-barrel states of RfaH-CTD (with error estimate);</li>
<li>(optional) determine the structure and population of other metastable states, if present.</li>
</ol>
<p>In order to complete the exercise, the students should:</p><ul>
<li>choose their own CVs (maximum 3) and perform a well-tempered metadynamics simulation. Any CV natively implemented in PLUMED (see <a class="el" href="colvarintro.html">Collective Variables</a>) or defined by the users directly in the input file (see <a class="el" href="_c_u_s_t_o_m.html">CUSTOM</a>) can be used;</li>
<li>monitor the <a class="el" href="_r_m_s_d.html">RMSD</a> of the system from the two reference conformations during the course of the simulation;</li>
<li>analyze the results as done in the previous exercises (assessment of convergence and error analysis);</li>
<li>report the free energies (with error bar) as a function of the two <a class="el" href="_r_m_s_d.html">RMSD</a> CVs calculated with respect to the reference PDBs;</li>
<li>(optional) report structure and population of the most signicant, i.e. populated, states.</li>
</ul>
<p>Please keep in mind that:</p><ul>
<li>we are simulating the system using a simplified, structure-based potential, called <a href="https://smog-server.org">SMOG</a>. SMOG is significantly less computational demanding than all-atoms, explicit solvent force fields. However, the simulation of this system might take a few hours, so allocate enough time to complete this exercise;</li>
<li>some of the CVs or PLUMED functionalities might not work as hydrogen atoms are not present in the system. However, there is always a way around this, so be creative;</li>
<li>due to the nature of the force field, we are simulating at an unphysical temperature of 60K. Be ready to test large values of the <code>BIASFACTOR</code>.</li>
</ul>
<p>Finally, due to the special nature of the force field, please execute GROMACS using the following command:</p>
<pre class="fragment">gmx mdrun -plumed plumed.dat -ntomp 4 -noddcheck
</pre><p>You can adjust the number of CPU cores you want to use (here 4, OpenMP parallelization), based on the available resources. The system is not particularly big, therefore using a large number of cores might be inefficient.</p>
<p><b>Please post the results of your simulations on Slack!</b> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
