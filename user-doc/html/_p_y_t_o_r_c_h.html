<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: PYTORCH (Machine Learning Collective Variables)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_p_y_t_o_r_c_h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PYTORCH (Machine Learning Collective Variables) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>The PYTORCH module is an interface between PyTorch machine learning library and PLUMED. It implements the <a class="el" href="_p_y_t_o_r_c_h__m_o_d_e_l.html">PYTORCH_MODEL</a> class, which is a subclass of <code>Function</code> class. <code>PYTORCH_MODEL</code> provide the ability to load models defined in Pytorch and compiled with <a href="https://pytorch.org/docs/stable/jit.html#">TorchScript</a>.</p>
<p>For instance, this allows one to use the outputs of a neural network as collective variables, as done in <a class="el" href="citelist.html#CITEREF_bonati2020data">[18]</a> and in <a class="el" href="citelist.html#CITEREF_bonati2021deep">[19]</a>. Furthermore, the <a class="el" href="_p_y_t_o_r_c_h__m_o_d_e_l.html">PYTORCH_MODEL</a> outputs can also be used as inputs for other collective variables and for data analysis tools.</p>
<h1><a class="anchor" id="Installation"></a>
Installation</h1>
<p>This module is not installed by default. It requires the PyTorch C++ APIs (LibTorch) to be linked against PLUMED.</p>
<dl class="section warning"><dt>Warning</dt><dd>Note that Libtorch APIs are still in beta phase regarding stability, so there might be breaking changes in newer versions. Currently, versions between 1.8.* and 1.13.* are supported. Please note that if you want to link a different version it might be necessary to manually specify the required libraries within LIBS in configure. Furthermore, it is advised to use the same version of PyTorch and LibTorch to avoid compatibility issues.</dd></dl>
<p><b>Download LibTorch C++ API library</b></p>
<p>You can download the pre-built LibTorch library from their <a href="https://pytorch.org/get-started/locally/">website</a>. For example, the following script downloads the 1.13.1 version (CPU, with C++11 ABI compatibility).</p>
<pre class="fragment">wget https://download.pytorch.org/libtorch/cpu/libtorch-cxx11-abi-shared-with-deps-1.13.1%2Bcpu.zip 
unzip libtorch-cxx11-abi-shared-with-deps-1.13.1+cpu.zip ; 
LIBTORCH=${PWD}/libtorch
</pre><p>The location of the include and library files need to be exported in the environment. For convenience, we can save them in a file <code>sourceme.sh</code> inside the libtorch folder:</p>
<pre class="fragment">&gt; echo "export CPATH=${LIBTORCH}/include/torch/csrc/api/include/:${LIBTORCH}/include/:${LIBTORCH}/include/torch:$CPATH" &gt;&gt; ${LIBTORCH}/sourceme.sh
&gt; echo "export INCLUDE=${LIBTORCH}/include/torch/csrc/api/include/:${LIBTORCH}/include/:${LIBTORCH}/include/torch:$INCLUDE" &gt;&gt; ${LIBTORCH}/sourceme.sh
&gt; echo "export LIBRARY_PATH=${LIBTORCH}/lib:$LIBRARY_PATH" &gt;&gt; ${LIBTORCH}/sourceme.sh
&gt; echo "export LD_LIBRARY_PATH=${LIBTORCH}/lib:$LD_LIBRARY_PATH" &gt;&gt; ${LIBTORCH}/sourceme.sh
&gt; . ${LIBTORCH}/sourceme.sh
</pre><p>Remember to source the <code>sourceme.sh</code> file in your <code>~/.bashrc</code> or <code>~/.bash_profile</code> file.</p>
<p><b>Configure PLUMED</b></p>
<p>In order to install the <code>PYTORCH</code> module when compiling PLUMED we need to (1) specify to look for libtorch (<code>--enable-libtorch</code>) and (2) enable the related module (<code>--enable-modules=pytorch</code> or also <code>--enable-modules=all</code>):</p>
<pre class="fragment">&gt; ./configure --enable-libtorch --enable-modules=pytorch  
</pre><dl class="section attention"><dt>Attention</dt><dd>To verify that the linking of LibTorch is succesful, one should look at the output of the configure command, which should report one of the following lines: <code>checking libtorch without extra libs.. yes</code> or <code>checking libtorch with -ltorch_cpu -lc10... yes</code>. If not, configure will display a warning (and not an error!) that says: <code>configure: WARNING: cannot enable __PLUMED_HAS_LIBTORCH</code>. In this case, it is recommended to examine the output of the above two commands in the config.log file to understand the reason (e.g. it cannot find the required libraries).</dd></dl>
<p><b>Additional notes</b></p><ul>
<li>A compiler with C++14 support is required.</li>
<li>If you want to use the pre-cxx11 ABI LibTorch binaries the following flag should be added to the configure: <code>CXXFLAGS="-D_GLIBCXX_USE_CXX11_ABI=0"</code>.</li>
</ul>
<h1><a class="anchor" id="Usage"></a>
Usage</h1>
<p>Currently, all features of the PYTORCH module are included in a single function: <a class="el" href="_p_y_t_o_r_c_h__m_o_d_e_l.html">PYTORCH_MODEL</a></p>
<h1><a class="anchor" id="Training"></a>
CVs with PyTorch: the mlcvs package</h1>
<p><a href="https://mlcvs.readthedocs.io/"><code>mlcvs</code> </a> is a Python package (under development) that can be used to optimize different kinds of neural-networks based CVs, e.g. that discriminate between states <a class="el" href="citelist.html#CITEREF_bonati2020data">[18]</a> or that approximate the slow dynamical modes of the system <a class="el" href="citelist.html#CITEREF_bonati2021deep">[19]</a>. The CVs are optimized in Python and the resulting model is compiled with TorchScript, in order to allowed the models to be employed without Python dependencies.</p>
<h1><a class="anchor" id="Module"></a>
Contents</h1>
<ul>
<li><a class="el" href="_p_y_t_o_r_c_h_function.html">Functions Documentation</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_add_mod.html">Additional Modules</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
