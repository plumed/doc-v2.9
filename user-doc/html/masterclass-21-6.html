<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: PLUMED Masterclass 21.6: Dimensionality reduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('masterclass-21-6.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PLUMED Masterclass 21.6: Dimensionality reduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Authors</dt><dd>Gareth Tribello </dd></dl>
<dl class="section date"><dt>Date</dt><dd>12th April 2021</dd></dl>
<h1><a class="anchor" id="masterclass-21-6-aims"></a>
Aims</h1>
<p>The primary aim of this Masterclass is to show you how you might use PLUMED in your work. We will see how to call PLUMED from a python notebook and discuss some strategies for selecting collective variables.</p>
<h1><a class="anchor" id="masterclass-21-6-lo"></a>
Objectives</h1>
<p>Once this Masterclass is completed, users will be able to:</p>
<ul>
<li>Calculate CVs and import them into a python notebook.</li>
<li>Generate visualizations of data using chemiscope</li>
<li>Use the projection of a vector as a CV.</li>
<li>Use path collective variables.</li>
<li>Run dimensionality reduction algorithms with PLUMED</li>
<li>Use Gibbs dividing surfaces to determine the extent of a phase.</li>
</ul>
<h1><a class="anchor" id="masterclass-21-6-theory"></a>
Acknowledgements</h1>
<p>Throughout this exercise, we use the atomistic simulation environment:</p>
<p><a href="https://wiki.fysik.dtu.dk/ase/">https://wiki.fysik.dtu.dk/ase/</a></p>
<p>and chemiscope:</p>
<p><a href="https://chemiscope.org/">https://chemiscope.org/</a></p>
<p>Please look at the websites for these codes that are given above for more information.</p>
<h1><a class="anchor" id="masterclass-21-6-install"></a>
Setting up the software</h1>
<p>For this Masterclass, you will need to set up the plumed and gromacs as you did for <a class="el" href="masterclass-21-5.html">PLUMED Masterclass 21.5: Simulations with multiple replicas</a>. You thus install plumed and gromacs using:</p>
<pre class="fragment">conda install --strict-channel-priority -c plumed/label/masterclass-mpi -c conda-forge plumed
conda install --strict-channel-priority -c plumed/label/masterclass-mpi -c conda-forge gromacs
</pre><p>You can install the other software you need using:</p>
<pre class="fragment">conda install -c conda-forge py-plumed Numpy pandas matplotlib notebook mdtraj mdanalysis git ase
</pre><p>Notice that you need a package called ase (the atomic simulation environment) for these exercises and the other packages you have been using. You also need to install chemiscope, which you can do by using the following command:</p>
<pre class="fragment">pip install chemiscope
</pre><h1><a class="anchor" id="masterclass-21-6-resources"></a>
Resources</h1>
<p>The data needed to complete this Masterclass can be found on <a href="https://github.com/plumed/masterclass-21-6">GitHub</a>. You can clone this repository locally on your machine using the following command:</p>
<pre class="fragment">git clone https://github.com/plumed/masterclass-21-6.git
</pre><p>I recommend that you run each exercise in a separate sub-directory (i.e. Exercise-1, Exercise-2, ...), which you can create inside the root directory <code>masterclass-21-6</code>. Organizing your data this way will help you to keep things clean.</p>
<dl class="section note"><dt>Note</dt><dd>All the exercises have been tested with PLUMED version 2.7.0.</dd></dl>
<h1><a class="anchor" id="masterclass-21-6-ex"></a>
Exercises</h1>
<h2><a class="anchor" id="masterclass-21-6-ex-1"></a>
Exercise 1: Running PLUMED from a python notebook</h2>
<p>I like working with Python notebooks. Using notebooks allows me to keep the codes that I am working on close to the explanations of how these codes work. I can also make all my figures within a notebook. By using notebooks, I can thus have a single file that contains:</p>
<ul>
<li>Discussion of the work done.</li>
<li>The analysis code.</li>
<li>The final figures that were generated.</li>
</ul>
<p>In previous masterclasses we have run plumed driver through bash from within a notebook by using commands like the one shown below:</p>
<div class="fragment"><div class="line">!cd ../Exercises/Exercise_1 &amp;&amp; plumed driver --noatoms &gt; /dev/null</div>
<div class="line"><span class="comment"># Read in colvar file produced</span></div>
<div class="line">data = np.loadtxt(<span class="stringliteral">&quot;../Exercises/Exercise_1/colvar&quot;</span>)</div>
</div><!-- fragment --><p>We have then read in the colvar file produced and analyzed it from within the notebook. We can avoid using plumed driver and can call plumed directly from python using the python interface. The code below, for instance, generates the plot underneath the code. The code reads in the trajectory from the file traj.pdb that you obtained from the GitHub repository. The plot then shows how the \(\phi\) angle on the second residue of the protein changes with time. <br  />
</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> plumed</div>
<div class="line"><span class="keyword">import</span> ase </div>
<div class="line"><span class="keyword">import</span> ase.io </div>
<div class="line"> </div>
<div class="line"><span class="comment"># Read in trajectory using ase</span></div>
<div class="line">traj = ase.io.read(<span class="stringliteral">&#39;../data/traj.pdb&#39;</span>,<span class="stringliteral">&#39;:&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Setup plumed object to do calculation</span></div>
<div class="line">p = plumed.Plumed()</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;setMDEngine&quot;</span>,<span class="stringliteral">&quot;python&quot;</span>)</div>
<div class="line"><span class="comment"># Read PDB so need to multiply by 0.1 to convert to nm</span></div>
<div class="line">p.cmd(<span class="stringliteral">&quot;setMDLengthUnits&quot;</span>, 0.1)</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;setTimestep&quot;</span>, 1.)</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;setKbT&quot;</span>, 1.)</div>
<div class="line">natoms = len(traj[0].positions)</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;setNatoms&quot;</span>,natoms)</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;setLogFile&quot;</span>,<span class="stringliteral">&quot;test.log&quot;</span>)</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;init&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Read plumed input </span></div>
<div class="line">p.cmd(<span class="stringliteral">&quot;readInputLine&quot;</span>,<span class="stringliteral">&quot;MOLINFO STRUCTURE=../data/bhp.pdb&quot;</span>)</div>
<div class="line"><span class="comment"># If you are doing many variables I would represent putting these </span></div>
<div class="line"><span class="comment"># next three PLUMED commands into a function</span></div>
<div class="line">p.cmd(<span class="stringliteral">&quot;readInputLine&quot;</span>, <span class="stringliteral">&quot;t1: TORSION ATOMS=@phi-2&quot;</span> )</div>
<div class="line"><span class="comment"># Now setup some memory to hold the variable that is shared </span></div>
<div class="line"><span class="comment"># between plumed and the underlying code</span></div>
<div class="line">shape = np.zeros( 1, dtype=np.int_ )</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;getDataRank t1 &quot;</span>, shape )</div>
<div class="line">t1 = np.zeros((1))</div>
<div class="line">p.cmd(<span class="stringliteral">&quot;setMemoryForData t1&quot;</span>, t1)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Loop over trajectory and get data from plumed</span></div>
<div class="line">nfram, tt, v1, box = 0, [], [], np.array([[100.,0,0],[0,100.,0],[0,0,100]])</div>
<div class="line">charges, forces, virial = np.zeros(natoms,dtype=np.float64), np.zeros([natoms,3]), np.zeros((3,3),dtype=np.float64)</div>
<div class="line"><span class="keywordflow">for</span> ts <span class="keywordflow">in</span> traj : </div>
<div class="line">    <span class="comment"># Set all the input variables to PLUMED</span></div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;setStep&quot;</span>,nfram)</div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;setBox&quot;</span>,box )</div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;setMasses&quot;</span>, ts.get_masses() )</div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;setCharges&quot;</span>, charges )</div>
<div class="line">    pos = np.array(ts.get_positions(), dtype=np.float64 )</div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;setPositions&quot;</span>, pos )</div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;setForces&quot;</span>, forces )</div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;setVirial&quot;</span>, virial )</div>
<div class="line">    <span class="comment"># Run the plumed calculation</span></div>
<div class="line">    p.cmd(<span class="stringliteral">&quot;calc&quot;</span>)</div>
<div class="line">    tt.append(nfram)</div>
<div class="line">    <span class="comment"># We can now extract the value of the torsion by accessing the shared memory we set up earlier</span></div>
<div class="line">    v1.append(t1[0])</div>
<div class="line">    nfram = nfram + 1</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Plot teh graph of the torsional angle as a function of time</span></div>
<div class="line">plt.plot( tt, v1, <span class="stringliteral">&#39;ko&#39;</span>)</div>
<div class="line">plt.xlabel(<span class="stringliteral">&quot;Simulation step&quot;</span>)</div>
<div class="line">plt.ylabel(<span class="stringliteral">&quot;Torsion angle / radians&quot;</span>)</div>
<div class="line">plt.show()</div>
</div><!-- fragment --><p><a class="anchor" id="masterclass-21-6-phi-time"></a> </p><div class="image">
<img src="masterclass-21-6-phi-time.png" alt=""/>
<div class="caption">
The value of the phi angle as a function of time.</div></div>
<p><b>Your task in this first exercise is to modify the code above and to produce a figure similar to the one shown below.</b> This figure shows all the values of the \(\phi\) and \(\psi\) angles in the second residue of the protein during the simulation.</p>
<p><a class="anchor" id="masterclass-21-6-phi-psi"></a></p><div class="image">
<img src="masterclass-21-6-phi-psi.png" alt=""/>
<div class="caption">
A plot showing phi against psi for the second residue of the protein.</div></div>
<h2><a class="anchor" id="masterclass-21-6-ex-2"></a>
Exercise 2: Generating a chemiscope representation</h2>
<p>Plots showing the trajectory in CV space similar to those you generated at the end of the previous exercise are helpful. What would be more useful, however, is some way of understanding the relationship between the positions in CV space and the structures of the various atoms. In other words, what we would like is something like this:</p>
<p><a class="anchor" id="masterclass-21-6-chemiscope"></a></p><div class="image">
<img src="masterclass-21-6-chemiscope.png" alt=""/>
<div class="caption">
A representation of the time against phi plot from the previous exercise that was generated using chemiscope.</div></div>
<p>You can see the frame in the trajectory that each point in the plot corresponds to from the above figure. The snapshots on the right correspond to the structures the system had at the points highlighted in red, yellow, green and blue respectively in the plot on the left. <br  />
</p>
<p>The figure above was generated using chemiscope. <br  />
 This server allows you to generate and interact with plots like the one shown above. <b> Your task in this exercise is to generate your own chemiscope representation of the data in traj.pdb. </b> To create a chemiscope representation of the \(\phi\) angles that we generated using the first python script from the previous exercise, you would add the following python code:</p>
<div class="fragment"><div class="line"><span class="keyword">from</span> ase.data <span class="keyword">import</span> atomic_masses</div>
<div class="line"><span class="keyword">from</span> chemiscope <span class="keyword">import</span> write_input</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This ensures that the atomic masses are used in place of the symbols</span></div>
<div class="line"><span class="comment"># when constructing the atomic configurations&#39; chemiscope representations.</span></div>
<div class="line"><span class="comment"># Using the symbols will not work because ase is written by chemists and not </span></div>
<div class="line"><span class="comment"># biologists.  For a chemist, HG1 is mercury as opposed to the first hydrogen</span></div>
<div class="line"><span class="comment"># on a guanine residue.  </span></div>
<div class="line"><span class="keywordflow">for</span> frame <span class="keywordflow">in</span> traj:</div>
<div class="line">    frame.numbers = np.array(</div>
<div class="line">        [</div>
<div class="line">            np.argmin(np.subtract(atomic_masses, float(am)) ** 2)</div>
<div class="line">            <span class="keywordflow">for</span> am <span class="keywordflow">in</span> frame.arrays[<span class="stringliteral">&quot;occupancy&quot;</span>]</div>
<div class="line">        ]</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This constructs the dictionary of properties for chemiscope</span></div>
<div class="line">properties = {</div>
<div class="line">    <span class="stringliteral">&quot;time&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;structure&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: tt,</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Simulation step number&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;t2&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;structure&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: v1,</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Phi angle of second residue&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This generates our chemiscope output</span></div>
<div class="line">write_input(<span class="stringliteral">&quot;torsion_chemiscope.json.gz&quot;</span>, frames=traj, properties=properties )</div>
</div><!-- fragment --><p>You would then upload the torsion_chemiscope.json.gz file that is generated by this script at <a href="https://chemiscope.org">https://chemiscope.org</a>.</p>
<p><b> See if you can generate your own chemiscope representation of the data in traj.pdb.</b> I would recommend calculating and uploading a chemiscope representation of all the protein's torsional angles. <br  />
 At the very least, you need to do at least two backbone torsional angles. However, if you do more than two torsions, you can generate a plot like the one shown below.</p>
<p><a class="anchor" id="masterclass-21-6-chemiscope2"></a></p><div class="image">
<img src="masterclass-21-6-chemiscope2.png" alt=""/>
<div class="caption">
A representation of the trajectory that was generated using chemiscope. Here psi_2 is plotted on the x-axis, phi_2 is plotted on the y-axis, and phi_3 is plotted on the z-axis. The points are coloured following the value of psi_3, and the points' sizes are proportional to phi_4.</div></div>
<h2><a class="anchor" id="masterclass-21-6-ex-3"></a>
Exercise 3: Dimensionality reduction</h2>
<p>Chemiscope comes into its own when you are working with a machine learning algorithm. These algorithms can (in theory) learn the collective variables you need to use from the trajectory data. To make sense of the coordinates that have been learned, you have to carefully visualize where structures are projected in the low dimensional space. You can use chemiscope to complete this process of visualizing the representation the computer has found for you. In this next set of exercises, we will apply various dimensionality reduction algorithms to the data contained in the file traj.pdb. If you visualize the contents of that file using VMD, you will see that this file contains a short protein trajectory. You are perhaps unsure what CV to analyze this data and thus want to see if you can shed any light on the contents of the trajectory by using machine learning.</p>
<p>Typically, PLUMED analyses one set of atomic coordinates at a time. To run a machine learning algorithm, however, you need to gather information on multiple configurations. Therefore, the first thing you need to learn to use these algorithms is how to store configurations for later analysis with a machine learning algorithm. The following input illustrates how to complete this task using PLUMED.</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># This reads in the template pdb file and thus allows us to use the @nonhydrogens</span>
<span style="color:blue"># special group later in the input</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">MOLTYPE<div class="right"><b>compulsory keyword ( default=protein )</b>
what kind of molecule is contained in the pdb file - usually not needed since protein/RNA/DNA
are compatible <i></i></div></div>=protein <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This stores the positions of all the nonhydrogen atoms for later analysis</span>
<b name="eg1cc" onclick='showPath("eg1","eg1cc")'>cc: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=@nonhydrogens <span style="display:none;" id="eg1cc"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This should output the atomic positions for the frames that were collected to a pdb file called traj.pdb</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__p_d_b.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_PDB</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=traj.pdb <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p><b>Copy the input above into a plumed file and fill in the blanks.</b> You should then be able to run the command using:</p>
<p>Then, once all the blanks are filled in, run the command using:</p>
<pre class="fragment">plumed driver --mf_pdb traj.pdb
</pre><p>You can also store the values of collective variables for later analysis with these algorithms. <b> Modify the input above so that all Thirty backbone dihedral angles in the protein are stored, and output using <a class="el" href="_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__c_o_l_v_a_r.html">OUTPUT_ANALYSIS_DATA_TO_COLVAR</a> and rerun the calculation. </b></p>
<p>For more information on the dimensionality reduction algorithms that we are using in this section see:</p>
<p><a href="https://arxiv.org/abs/1907.04170">https://arxiv.org/abs/1907.04170</a></p>
<h2><a class="anchor" id="masterclass-21-6-ex-4a"></a>
PCA</h2>
<p>Having learned how to store data for later analysis with a dimensionality reduction algorithm, lets now apply principal component analysis (PCA) upon our stored data. In principle component analysis, low dimensional projections for our trajectory are constructed by:</p>
<ul>
<li>Computing a covariance matrix from the trajectory data</li>
<li>Diagonalizing the covariance matrix.</li>
<li>Calculating the projection of each trajectory frame on a subset of the eigenvectors of the covariance matrix.</li>
</ul>
<p>To perform PCA using PLUMED, we are going to use the following input with the blanks filled in:</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># This reads in the template pdb file and thus allows us to use the @nonhydrogens</span>
<span style="color:blue"># special group later in the input</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">MOLTYPE<div class="right"><b>compulsory keyword ( default=protein )</b>
what kind of molecule is contained in the pdb file - usually not needed since protein/RNA/DNA
are compatible <i></i></div></div>=protein <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This stores the positions of all the nonhydrogen atoms for later analysis</span>
<b name="eg2cc" onclick='showPath("eg2","eg2cc")'>cc: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=@nonhydrogens <span style="display:none;" id="eg2cc"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This diagonalizes the covariance matrix</span>
<b name="eg2pca" onclick='showPath("eg2","eg2pca")'>pca: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_c_a.html" style="color:green">PCA</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">METRIC<div class="right"><b>compulsory keyword ( default=EUCLIDEAN )</b>
the method that you are going to use to measure the distances between points <i></i></div></div>=OPTIMAL <div class="tooltip">NLOW_DIM<div class="right"><b>compulsory keyword </b>
number of low-dimensional coordinates required <i></i></div></div>=2 <span style="display:none;" id="eg2pca"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This projects each of the trajectory frames onto the low dimensional space that was</span>
<span style="color:blue"># identified by the PCA command</span>
<b name="eg2dat" onclick='showPath("eg2","eg2dat")'>dat: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_o_j_e_c_t__a_l_l__a_n_a_l_y_s_i_s__d_a_t_a.html" style="color:green">PROJECT_ALL_ANALYSIS_DATA</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">PROJECTION<div class="right"><b>compulsory keyword </b>
the projection that you wish to generate out-of-sample projections with <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2dat"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This should output the PCA projections of all the coordinates</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__c_o_l_v_a_r.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_COLVAR</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2dat">dat.*</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=pca_data <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># These next three commands calculate the secondary structure variables. These</span>
<span style="color:blue"># variables measure how much of the structure resembles an alpha helix, an antiparallel beta-sheet</span>
<span style="color:blue"># and a parallel beta-sheet. Configurations that have different secondary structures should be projected</span>
<span style="color:blue"># in different parts of the low dimensional space.</span>
<b name="eg2alpha" onclick='showPath("eg2","eg2alpha")'>alpha: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_l_p_h_a_r_m_s_d.html" style="color:green">ALPHARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <span style="display:none;" id="eg2alpha"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2abeta" onclick='showPath("eg2","eg2abeta")'>abeta: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_n_t_i_b_e_t_a_r_m_s_d.html" style="color:green">ANTIBETARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <div class="tooltip">STRANDS_CUTOFF<div class="right">If in a segment of protein the two strands are further apart then the calculation
of the actual RMSD is skipped as the structure is very far from being beta-sheet
like. <i></i></div></div>=1.0 <span style="display:none;" id="eg2abeta"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg2pbeta" onclick='showPath("eg2","eg2pbeta")'>pbeta: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_a_r_a_b_e_t_a_r_m_s_d.html" style="color:green">PARABETARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <div class="tooltip">STRANDS_CUTOFF<div class="right">If in a segment of protein the two strands are further apart then the calculation
of the actual RMSD is skipped as the structure is very far from being beta-sheet
like. <i></i></div></div>=1.0 <span style="display:none;" id="eg2pbeta"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># These commands collect and output the secondary structure variables so that we can use this information to</span>
<span style="color:blue"># determine how good our projection of the trajectory data is.</span>
<b name="eg2cc2" onclick='showPath("eg2","eg2cc2")'>cc2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2alpha">alpha</b>,<b name="eg2abeta">abeta</b>,<b name="eg2pbeta">pbeta</b> <span style="display:none;" id="eg2cc2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__c_o_l_v_a_r.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_COLVAR</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<b name="eg2cc2">cc2</b> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg2cc2">cc2.*</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=secondary_structure_data <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>To generate the projection, you run the command:</p>
<pre class="fragment">plumed driver --mf_pdb traj.pdb
</pre><p>You can generate a projection of the data above using chemiscope by using the following script:</p>
<div class="fragment"><div class="line"><span class="comment"># This ase command should read in the traj.pdb file that was analyzed.  Notice that the analysis</span></div>
<div class="line"><span class="comment"># actions below ignore the first frame in this trajectory, so we need to take that into account</span></div>
<div class="line"><span class="comment"># when we generated the chemiscope</span></div>
<div class="line">traj = ase.io.read(<span class="stringliteral">&#39;../data/traj.pdb&#39;</span>,<span class="stringliteral">&#39;:&#39;</span>)</div>
<div class="line"><span class="comment"># This reads in the PCA projection that are output by by the OUTPUT_ANALYSIS_DATA_TO_COLVAR command</span></div>
<div class="line"><span class="comment"># above</span></div>
<div class="line">projection = np.loadtxt(<span class="stringliteral">&quot;pca_data&quot;</span>)</div>
<div class="line"><span class="comment"># We also read in the secondary structure data by colouring points following the secondary</span></div>
<div class="line"><span class="comment"># structure. We can get a sense of how good our projection is.</span></div>
<div class="line">structure = np.loadtxt(<span class="stringliteral">&quot;secondary_structure_data&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This ensures that the atomic masses are used in place of the symbols</span></div>
<div class="line"><span class="comment"># when constructing the atomic configurations&#39; chemiscope representations.</span></div>
<div class="line"><span class="comment"># Using the symbols will not work because ase is written by chemists and not</span></div>
<div class="line"><span class="comment"># biologists.  For a chemist, HG1 is mercury as opposed to the first hydrogen</span></div>
<div class="line"><span class="comment"># on a guanine residue.</span></div>
<div class="line"><span class="keywordflow">for</span> frame <span class="keywordflow">in</span> traj:</div>
<div class="line">    frame.numbers = np.array(</div>
<div class="line">        [</div>
<div class="line">            np.argmin(np.subtract(atomic_masses, float(am)) ** 2)</div>
<div class="line">            <span class="keywordflow">for</span> am <span class="keywordflow">in</span> frame.arrays[<span class="stringliteral">&quot;occupancy&quot;</span>]</div>
<div class="line">        ]</div>
<div class="line">    )</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This constructs the dictionary of properties for chemiscope</span></div>
<div class="line">properties = {</div>
<div class="line">    <span class="stringliteral">&quot;pca1&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;structure&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: projection[:,0],</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;First principle component&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;pca2&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;structure&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: projection[:,1],</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Second principle component&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;alpha&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;structure&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: structure[:,0],</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Alpha helical content&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;antibeta&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;structure&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: structure[:,1],</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Anti parallel beta sheet content&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;parabeta&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;structure&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: structure[:,2],</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Parallel beta sheet content&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This generates our chemiscope output</span></div>
<div class="line">write_input(<span class="stringliteral">&quot;pca_chemiscope.json.gz&quot;</span>, frames=traj[1:], properties=properties )</div>
</div><!-- fragment --><p>When the output from this set of commands is loaded into chemiscope, we can construct figures like the one shown below. On the axes here, we have plotted the PCA coordinates. The points are then coloured according to the alpha-helical content.</p>
<p><a class="anchor" id="masterclass-21-6-chemiscope-pca"></a></p><div class="image">
<img src="masterclass-21-6-chemiscope-pca.png" alt=""/>
<div class="caption">
A representation of the PCA projection that was generated using chemiscope.</div></div>
<p><b>See if you can use PLUMED and chemiscope to generate a figure similar to the one above.</b> Try to experiment with the way the points are coloured. Look at the beta-sheet content as well.</p>
<h2><a class="anchor" id="masterclass-21-6-ex-4b"></a>
MDS</h2>
<p>In the previous section, we performed PCA on the atomic positions directly. In the section before last, however, we also saw how we could store high-dimensional vectors of collective variables and then use them as input to a dimensionality reduction algorithm. Therefore, we might legitimately ask if we can do PCA using these high-dimensional vectors as input rather than atomic positions. The answer to this question is yes as long as the CV is not periodic. If any of our CVs are not periodic, we cannot analyze them using the <a class="el" href="_p_c_a.html">PCA</a> action. We can, however, formulate the PCA algorithm differently. In this alternative formulation, which is known as classical multidimensional scaling (MDS), we do the following:</p>
<ul>
<li>We calculate the matrix of distances between configurations</li>
<li>We perform an operation known as centring the matrix.</li>
<li>We diagonalize the centred matrix The eigenvectors multiplied by the corresponding eigenvalue's square root can then be used as a set of projections for our input points.</li>
</ul>
<p>This method is used less often than PCA as the matrix that we have to diagonalize here in the third step can be considerably larger than the matrix that we have to diagonalize when we perform PCA. <br  />
 To avoid this expensive diagonalization step, we often select a subset of so-called landmark points on which to run the algorithm directly. Projections for the remaining points are then found by using a so-called out-of-sample procedure. This is what has been done in the following input:</p>

<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_h_i_s.html" style="color:green">THIS</a> <div class="tooltip">command<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">reads<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">in<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">the<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">template<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">pdb<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">file<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">and<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">thus<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">allows<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">us<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">to<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">use<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">the<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">@nonhydrogens<div class="right"><b> could not find this keyword </b><i></i></div></div> <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># group later in the input</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=beta-hairpin.pdb <div class="tooltip">MOLTYPE<div class="right"><b>compulsory keyword ( default=protein )</b>
what kind of molecule is contained in the pdb file - usually not needed since protein/RNA/DNA
are compatible <i></i></div></div>=protein <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This stores the positions of all the nonhydrogen atoms for later analysis</span>
<b name="eg3cc" onclick='showPath("eg3","eg3cc")'>cc: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">ATOMS<div class="right">the atoms whose positions we are tracking for the purpose of analyzing the data <i></i></div></div>=@nonhydrogens <span style="display:none;" id="eg3cc"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># The following commands compute all the Ramachandran angles of the protein for you</span>
<b name="eg3r2-phi" onclick='showPath("eg3","eg3r2-phi")'>r2-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg3r2-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r2-psi" onclick='showPath("eg3","eg3r2-psi")'>r2-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-2 <span style="display:none;" id="eg3r2-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r3-phi" onclick='showPath("eg3","eg3r3-phi")'>r3-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-3 <span style="display:none;" id="eg3r3-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r3-psi" onclick='showPath("eg3","eg3r3-psi")'>r3-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-3 <span style="display:none;" id="eg3r3-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r4-phi" onclick='showPath("eg3","eg3r4-phi")'>r4-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r4-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r4-psi" onclick='showPath("eg3","eg3r4-psi")'>r4-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r4-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r5-phi" onclick='showPath("eg3","eg3r5-phi")'>r5-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r5-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r5-psi" onclick='showPath("eg3","eg3r5-psi")'>r5-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r5-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r6-phi" onclick='showPath("eg3","eg3r6-phi")'>r6-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r6-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r6-psi" onclick='showPath("eg3","eg3r6-psi")'>r6-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r6-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r7-phi" onclick='showPath("eg3","eg3r7-phi")'>r7-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r7-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r7-psi" onclick='showPath("eg3","eg3r7-psi")'>r7-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r7-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r8-phi" onclick='showPath("eg3","eg3r8-phi")'>r8-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r8-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r8-psi" onclick='showPath("eg3","eg3r8-psi")'>r8-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r8-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r9-phi" onclick='showPath("eg3","eg3r9-phi")'>r9-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r9-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r9-psi" onclick='showPath("eg3","eg3r9-psi")'>r9-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r9-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r10-phi" onclick='showPath("eg3","eg3r10-phi")'>r10-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r10-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r10-psi" onclick='showPath("eg3","eg3r10-psi")'>r10-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r10-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r11-phi" onclick='showPath("eg3","eg3r11-phi")'>r11-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r11-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r11-psi" onclick='showPath("eg3","eg3r11-psi")'>r11-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r11-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r12-phi" onclick='showPath("eg3","eg3r12-phi")'>r12-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r12-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r12-psi" onclick='showPath("eg3","eg3r12-psi")'>r12-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r12-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r13-phi" onclick='showPath("eg3","eg3r13-phi")'>r13-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r13-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r13-psi" onclick='showPath("eg3","eg3r13-psi")'>r13-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r13-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r14-phi" onclick='showPath("eg3","eg3r14-phi")'>r14-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r14-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r14-psi" onclick='showPath("eg3","eg3r14-psi")'>r14-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r14-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r15-phi" onclick='showPath("eg3","eg3r15-phi")'>r15-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r15-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r15-psi" onclick='showPath("eg3","eg3r15-psi")'>r15-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r15-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r16-phi" onclick='showPath("eg3","eg3r16-phi")'>r16-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r16-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3r16-psi" onclick='showPath("eg3","eg3r16-psi")'>r16-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg3r16-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This command stores all the Ramachandran angles that were computed</span>
<b name="eg3angles" onclick='showPath("eg3","eg3angles")'>angles: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg3r2-phi">r2-phi</b>,<b name="eg3r2-psi">r2-psi</b>,<b name="eg3r3-phi">r3-phi</b>,<b name="eg3r3-psi">r3-psi</b>,<b name="eg3r4-phi">r4-phi</b>,<b name="eg3r4-psi">r4-psi</b>,<b name="eg3r5-phi">r5-phi</b>,<b name="eg3r5-psi">r5-psi</b>,<b name="eg3r6-phi">r6-phi</b>,<b name="eg3r6-psi">r6-psi</b>,<b name="eg3r7-phi">r7-phi</b>,<b name="eg3r7-psi">r7-psi</b>,<b name="eg3r8-phi">r8-phi</b>,<b name="eg3r8-psi">r8-psi</b>,<b name="eg3r9-phi">r9-phi</b>,<b name="eg3r9-psi">r9-psi</b>,<b name="eg3r10-phi">r10-phi</b>,<b name="eg3r10-psi">r10-psi</b>,<b name="eg3r11-phi">r11-phi</b>,<b name="eg3r11-psi">r11-psi</b>,<b name="eg3r12-phi">r12-phi</b>,<b name="eg3r12-psi">r12-psi</b>,<b name="eg3r13-phi">r13-phi</b>,<b name="eg3r13-psi">r13-psi</b>,<b name="eg3r14-phi">r14-phi</b>,<b name="eg3r14-psi">r14-psi</b>,<b name="eg3r15-phi">r15-phi</b>,<b name="eg3r15-psi">r15-psi</b>,<b name="eg3r16-phi">r16-phi</b>,<b name="eg3r16-psi">r16-psi</b> <span style="display:none;" id="eg3angles"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Lets now compute the matrix of distances between the frames in the space of the Ramachandran angles</span>
<b name="eg3distmat" onclick='showPath("eg3","eg3distmat")'>distmat: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_e_u_c_l_i_d_e_a_n__d_i_s_s_i_m_i_l_a_r_i_t_i_e_s.html" style="color:green">EUCLIDEAN_DISSIMILARITIES</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">METRIC<div class="right"><b>compulsory keyword ( default=EUCLIDEAN )</b>
the method that you are going to use to measure the distances between points <i></i></div></div>=EUCLIDEAN <span style="display:none;" id="eg3distmat"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Now select 500 landmark points to analyze</span>
<b name="eg3fps" onclick='showPath("eg3","eg3fps")'>fps: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_l_a_n_d_m_a_r_k__s_e_l_e_c_t__f_p_s.html" style="color:green">LANDMARK_SELECT_FPS</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">NLANDMARKS<div class="right"><b>compulsory keyword </b>
the number of landmarks that you would like to select <i></i></div></div>=500 <span style="display:none;" id="eg3fps"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Run MDS on the landmarks</span>
<b name="eg3mds" onclick='showPath("eg3","eg3mds")'>mds: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_l_a_s_s_i_c_a_l__m_d_s.html" style="color:green">CLASSICAL_MDS</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg3fps">fps</b> <div class="tooltip">NLOW_DIM<div class="right"><b>compulsory keyword </b>
number of low-dimensional coordinates required <i></i></div></div>=2 <span style="display:none;" id="eg3mds"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Project the remaining trajectory data</span>
<b name="eg3osample" onclick='showPath("eg3","eg3osample")'>osample: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_o_j_e_c_t__a_l_l__a_n_a_l_y_s_i_s__d_a_t_a.html" style="color:green">PROJECT_ALL_ANALYSIS_DATA</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">PROJECTION<div class="right"><b>compulsory keyword </b>
the projection that you wish to generate out-of-sample projections with <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg3osample"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This command outputs all the projections of all the points in the low dimensional space</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__c_o_l_v_a_r.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_COLVAR</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3osample">osample.*</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=mds_data <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># These next three commands calculate the secondary structure variables. These</span>
<span style="color:blue"># variables measure how much of the structure resembles an alpha helix, an antiparallel beta-sheet</span>
<span style="color:blue"># and a parallel beta-sheet. Configurations that have different secondary structures should be projected</span>
<span style="color:blue"># in different parts of the low dimensional space.</span>
<b name="eg3alpha" onclick='showPath("eg3","eg3alpha")'>alpha: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_l_p_h_a_r_m_s_d.html" style="color:green">ALPHARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <span style="display:none;" id="eg3alpha"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3abeta" onclick='showPath("eg3","eg3abeta")'>abeta: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_n_t_i_b_e_t_a_r_m_s_d.html" style="color:green">ANTIBETARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <div class="tooltip">STRANDS_CUTOFF<div class="right">If in a segment of protein the two strands are further apart then the calculation
of the actual RMSD is skipped as the structure is very far from being beta-sheet
like. <i></i></div></div>=1.0 <span style="display:none;" id="eg3abeta"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg3pbeta" onclick='showPath("eg3","eg3pbeta")'>pbeta: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_a_r_a_b_e_t_a_r_m_s_d.html" style="color:green">PARABETARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <div class="tooltip">STRANDS_CUTOFF<div class="right">If in a segment of protein the two strands are further apart then the calculation
of the actual RMSD is skipped as the structure is very far from being beta-sheet
like. <i></i></div></div>=1.0 <span style="display:none;" id="eg3pbeta"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># These commands collect and output the secondary structure variables so that we can use this information to</span>
<span style="color:blue"># determine how good our projection of the trajectory data is.</span>
<b name="eg3cc2" onclick='showPath("eg3","eg3cc2")'>cc2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3alpha">alpha</b>,<b name="eg3abeta">abeta</b>,<b name="eg3pbeta">pbeta</b> <span style="display:none;" id="eg3cc2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__c_o_l_v_a_r.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_COLVAR</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<b name="eg3cc2">cc2</b> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg3cc2">cc2.*</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=secondary_structure_data <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>This input collects all the torsional angles for the configurations in the trajectory. Then, at the end of the calculation, the matrix of distances between these points is computed, and a set of landmark points is selected using a method known as farthest point sampling. A matrix that contains only those distances between the landmarks is then constructed and diagonalized by the <a class="el" href="_c_l_a_s_s_i_c_a_l__m_d_s.html">CLASSICAL_MDS</a> action so that projections of the landmarks can be built. The final step is then to project the remainder of the trajectory using the <a class="el" href="_p_r_o_j_e_c_t__a_l_l__a_n_a_l_y_s_i_s__d_a_t_a.html">PROJECT_ALL_ANALYSIS_DATA</a> action. Try to fill in the blanks in the input above and run this calculation now using the command:</p>
<pre class="fragment">plumed driver --mf_pdb traj.pdb
</pre><p>Once the calculation has completed, you can, once again, visualize the data using chemiscope by using a suitably modified version of the script from the previous exercise. The image below shows the MDS coordinates coloured according to the alpha-helical content.</p>
<p><a class="anchor" id="masterclass-21-6-chemiscope-mds"></a></p><div class="image">
<img src="masterclass-21-6-chemiscope-mds.png" alt=""/>
<div class="caption">
A representation of the MDS projection that was generated using chemiscope.</div></div>
<p><b>Try to generate an image that looks like this one yourself by completing the input above and then using what you learned about generating chemiscope representations in the previous exercise.</b></p>
<h2><a class="anchor" id="masterclass-21-6-ex-4c"></a>
Sketch-map</h2>
<p>The two algorithms (PCA and MDS) that we have looked at thus far are linear dimensionality reduction algorithms. In addition to these, there are a whole class of non-linear dimensionality reduction reduction algorithms which work by transforming the matrix of dissimilarities between configurations, calculating geodesic rather than Euclidean distances between configurations or by changing the form of the loss function that is optimized. In this final exercise, we will use an algorithm that uses the last of these three strategies to construct a non-linear projection. The algorithm is known as sketch-map and input for sketch-map is provided below:</p>

<div style="width: 90%; float:left" id="value_details_eg4"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># This reads in the template pdb file and thus allows us to use the @nonhydrogens</span>
<span style="color:blue"># special group later in the input</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">MOLTYPE<div class="right"><b>compulsory keyword ( default=protein )</b>
what kind of molecule is contained in the pdb file - usually not needed since protein/RNA/DNA
are compatible <i></i></div></div>=protein <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This stores the positions of all the nonhydrogen atoms for later analysis</span>
<b name="eg4cc" onclick='showPath("eg4","eg4cc")'>cc: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=@nonhydrogens <span style="display:none;" id="eg4cc"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This should output the atomic positions for the frames that were collected and analyzed using MDS</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__p_d_b.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_PDB</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=traj.pdb <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># The following commands compute all the Ramachandran angles of the protein for you</span>
<b name="eg4r2-phi" onclick='showPath("eg4","eg4r2-phi")'>r2-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-2 <span style="display:none;" id="eg4r2-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r2-psi" onclick='showPath("eg4","eg4r2-psi")'>r2-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-2 <span style="display:none;" id="eg4r2-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r3-phi" onclick='showPath("eg4","eg4r3-phi")'>r3-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@phi-3 <span style="display:none;" id="eg4r3-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r3-psi" onclick='showPath("eg4","eg4r3-psi")'>r3-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=@psi-3 <span style="display:none;" id="eg4r3-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r4-phi" onclick='showPath("eg4","eg4r4-phi")'>r4-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r4-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r4-psi" onclick='showPath("eg4","eg4r4-psi")'>r4-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r4-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r5-phi" onclick='showPath("eg4","eg4r5-phi")'>r5-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r5-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r5-psi" onclick='showPath("eg4","eg4r5-psi")'>r5-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r5-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r6-phi" onclick='showPath("eg4","eg4r6-phi")'>r6-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r6-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r6-psi" onclick='showPath("eg4","eg4r6-psi")'>r6-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r6-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r7-phi" onclick='showPath("eg4","eg4r7-phi")'>r7-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r7-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r7-psi" onclick='showPath("eg4","eg4r7-psi")'>r7-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r7-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r8-phi" onclick='showPath("eg4","eg4r8-phi")'>r8-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r8-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r8-psi" onclick='showPath("eg4","eg4r8-psi")'>r8-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r8-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r9-phi" onclick='showPath("eg4","eg4r9-phi")'>r9-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r9-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r9-psi" onclick='showPath("eg4","eg4r9-psi")'>r9-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r9-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r10-phi" onclick='showPath("eg4","eg4r10-phi")'>r10-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r10-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r10-psi" onclick='showPath("eg4","eg4r10-psi")'>r10-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r10-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r11-phi" onclick='showPath("eg4","eg4r11-phi")'>r11-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r11-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r11-psi" onclick='showPath("eg4","eg4r11-psi")'>r11-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r11-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r12-phi" onclick='showPath("eg4","eg4r12-phi")'>r12-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r12-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r12-psi" onclick='showPath("eg4","eg4r12-psi")'>r12-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r12-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r13-phi" onclick='showPath("eg4","eg4r13-phi")'>r13-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r13-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r13-psi" onclick='showPath("eg4","eg4r13-psi")'>r13-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r13-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r14-phi" onclick='showPath("eg4","eg4r14-phi")'>r14-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r14-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r14-psi" onclick='showPath("eg4","eg4r14-psi")'>r14-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r14-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r15-phi" onclick='showPath("eg4","eg4r15-phi")'>r15-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r15-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r15-psi" onclick='showPath("eg4","eg4r15-psi")'>r15-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r15-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r16-phi" onclick='showPath("eg4","eg4r16-phi")'>r16-phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r16-phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4r16-psi" onclick='showPath("eg4","eg4r16-psi")'>r16-psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg4r16-psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This command stores all the Ramachandran angles that were computed</span>
<b name="eg4angles" onclick='showPath("eg4","eg4angles")'>angles: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg4r2-phi">r2-phi</b>,<b name="eg4r2-psi">r2-psi</b>,<b name="eg4r3-phi">r3-phi</b>,<b name="eg4r3-psi">r3-psi</b>,<b name="eg4r4-phi">r4-phi</b>,<b name="eg4r4-psi">r4-psi</b>,<b name="eg4r5-phi">r5-phi</b>,<b name="eg4r5-psi">r5-psi</b>,<b name="eg4r6-phi">r6-phi</b>,<b name="eg4r6-psi">r6-psi</b>,<b name="eg4r7-phi">r7-phi</b>,<b name="eg4r7-psi">r7-psi</b>,<b name="eg4r8-phi">r8-phi</b>,<b name="eg4r8-psi">r8-psi</b>,<b name="eg4r9-phi">r9-phi</b>,<b name="eg4r9-psi">r9-psi</b>,<b name="eg4r10-phi">r10-phi</b>,<b name="eg4r10-psi">r10-psi</b>,<b name="eg4r11-phi">r11-phi</b>,<b name="eg4r11-psi">r11-psi</b>,<b name="eg4r12-phi">r12-phi</b>,<b name="eg4r12-psi">r12-psi</b>,<b name="eg4r13-phi">r13-phi</b>,<b name="eg4r13-psi">r13-psi</b>,<b name="eg4r14-phi">r14-phi</b>,<b name="eg4r14-psi">r14-psi</b>,<b name="eg4r15-phi">r15-phi</b>,<b name="eg4r15-psi">r15-psi</b>,<b name="eg4r16-phi">r16-phi</b>,<b name="eg4r16-psi">r16-psi</b> <span style="display:none;" id="eg4angles"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Lets now compute the matrix of distances between the frames in the space of the Ramachandran angles</span>
<b name="eg4distmat" onclick='showPath("eg4","eg4distmat")'>distmat: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_e_u_c_l_i_d_e_a_n__d_i_s_s_i_m_i_l_a_r_i_t_i_e_s.html" style="color:green">EUCLIDEAN_DISSIMILARITIES</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">METRIC<div class="right"><b>compulsory keyword ( default=EUCLIDEAN )</b>
the method that you are going to use to measure the distances between points <i></i></div></div>=EUCLIDEAN <span style="display:none;" id="eg4distmat"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Now select 500 landmark points to analyze</span>
<b name="eg4fps" onclick='showPath("eg4","eg4fps")'>fps: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_l_a_n_d_m_a_r_k__s_e_l_e_c_t__f_p_s.html" style="color:green">LANDMARK_SELECT_FPS</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">NLANDMARKS<div class="right"><b>compulsory keyword </b>
the number of landmarks that you would like to select <i></i></div></div>=500 <span style="display:none;" id="eg4fps"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Run sketch-map on the landmarks</span>
<b name="eg4smap" onclick='showPath("eg4","eg4smap")'>smap: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_s_k_e_t_c_h__m_a_p.html" style="color:green">SKETCH_MAP</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg4fps">fps</b> <div class="tooltip">NLOW_DIM<div class="right"><b>compulsory keyword </b>
the dimension of the low dimensional space in which the projections will be constructed
<i></i></div></div>=2 <div class="tooltip">HIGH_DIM_FUNCTION<div class="right"><b>compulsory keyword </b>
the parameters of the switching function in the high dimensional space <i></i></div></div>={SMAP R_0=6 A=8 B=2}  <div class="tooltip">LOW_DIM_FUNCTION<div class="right"><b>compulsory keyword </b>
the parameters of the switching function in the low dimensional space <i></i></div></div>={SMAP R_0=6 A=2 B=2}  <div class="tooltip">CGTOL<div class="right"><b>compulsory keyword ( default=1E-6 )</b>
the tolerance for the conjugate gradient minimization <i></i></div></div>=1E-3 <div class="tooltip">CGRID_SIZE<div class="right"><b>compulsory keyword ( default=10 )</b>
number of points to use in each grid direction <i></i></div></div>=20 <div class="tooltip">FGRID_SIZE<div class="right"><b>compulsory keyword ( default=0 )</b>
interpolate the grid onto this number of points -- only works in 2D <i></i></div></div>=200 <div class="tooltip">ANNEAL_STEPS<div class="right"><b>compulsory keyword ( default=10 )</b>
the number of steps of annealing to do <i></i></div></div>=0 <span style="display:none;" id="eg4smap"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Project the remaining trajectory data</span>
<b name="eg4osample" onclick='showPath("eg4","eg4osample")'>osample: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_o_j_e_c_t__a_l_l__a_n_a_l_y_s_i_s__d_a_t_a.html" style="color:green">PROJECT_ALL_ANALYSIS_DATA</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">PROJECTION<div class="right"><b>compulsory keyword </b>
the projection that you wish to generate out-of-sample projections with <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg4osample"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># This command outputs all the projections of all the points in the low dimensional space</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__c_o_l_v_a_r.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_COLVAR</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4osample">osample.*</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=smap_data <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># These next three commands calculate the secondary structure variables. These</span>
<span style="color:blue"># variables measure how much of the structure resembles an alpha helix, an antiparallel beta-sheet</span>
<span style="color:blue"># and a parallel beta-sheet. Configurations that have different secondary structures should be projected</span>
<span style="color:blue"># in different parts of the low dimensional space.</span>
<b name="eg4alpha" onclick='showPath("eg4","eg4alpha")'>alpha: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_l_p_h_a_r_m_s_d.html" style="color:green">ALPHARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <span style="display:none;" id="eg4alpha"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4abeta" onclick='showPath("eg4","eg4abeta")'>abeta: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_n_t_i_b_e_t_a_r_m_s_d.html" style="color:green">ANTIBETARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <div class="tooltip">STRANDS_CUTOFF<div class="right">If in a segment of protein the two strands are further apart then the calculation
of the actual RMSD is skipped as the structure is very far from being beta-sheet
like. <i></i></div></div>=1.0 <span style="display:none;" id="eg4abeta"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4pbeta" onclick='showPath("eg4","eg4pbeta")'>pbeta: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_a_r_a_b_e_t_a_r_m_s_d.html" style="color:green">PARABETARMSD</a> <div class="tooltip">RESIDUES<div class="right">this command is used to specify the set of residues that could conceivably form part
of the secondary structure. <i></i></div></div>=all <div class="tooltip">STRANDS_CUTOFF<div class="right">If in a segment of protein the two strands are further apart then the calculation
of the actual RMSD is skipped as the structure is very far from being beta-sheet
like. <i></i></div></div>=1.0 <span style="display:none;" id="eg4pbeta"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># These commands collect and output the secondary structure variables so that we can use this information to</span>
<span style="color:blue"># determine how good our projection of the trajectory data is.</span>
<b name="eg4cc2" onclick='showPath("eg4","eg4cc2")'>cc2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_l_l_e_c_t__f_r_a_m_e_s.html" style="color:green">COLLECT_FRAMES</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4alpha">alpha</b>,<b name="eg4abeta">abeta</b>,<b name="eg4pbeta">pbeta</b> <span style="display:none;" id="eg4cc2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_o_u_t_p_u_t__a_n_a_l_y_s_i_s__d_a_t_a__t_o__c_o_l_v_a_r.html" style="color:green">OUTPUT_ANALYSIS_DATA_TO_COLVAR</a> <div class="tooltip">USE_OUTPUT_DATA_FROM<div class="right">use the output of the analysis performed by this object as input to your new analysis
object <i></i></div></div>=<b name="eg4cc2">cc2</b> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg4cc2">cc2.*</b> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
the name of the file to output to <i></i></div></div>=secondary_structure_data <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>This input collects all the torsional angles for the configurations in the trajectory. Then, at the end of the calculation, the matrix of distances between these points is computed, and a set of landmark points is selected using a method known as farthest point sampling. A matrix that contains only those distances between the landmarks is then constructed and diagonalized by the <a class="el" href="_c_l_a_s_s_i_c_a_l__m_d_s.html">CLASSICAL_MDS</a> action, and this set of projections is used as the initial configuration for the various minimization algorithms that are then used to optimize the sketch-map stress function. As in the previous exercise, once the projections of the landmarks are found, the projections for the remainder of the points in the trajectory are found by using the <a class="el" href="_p_r_o_j_e_c_t__a_l_l__a_n_a_l_y_s_i_s__d_a_t_a.html">PROJECT_ALL_ANALYSIS_DATA</a> action. Try to fill in the blanks in the input above and run this calculation now using the command:</p>
<pre class="fragment">plumed driver --mf_pdb traj.pdb
</pre><p>Once the calculation has completed, you can, once again, visualize the data generated using chemiscope by using the scripts from earlier exercises. My projection is shown in the figure below. Points are, once again, coloured following the alpha-helical content of the corresponding structure.</p>
<p><a class="anchor" id="masterclass-21-6-chemiscope-smap"></a></p><div class="image">
<img src="masterclass-21-6-chemiscope-smap.png" alt=""/>
<div class="caption">
A representation of the sketch-map projection that was generated using chemiscope.</div></div>
<p><b> Try to see if you can reproduce an image that looks like the one above</b></p>
<h3><a class="anchor" id="masterclass-21-6-ex4d"></a>
Summary</h3>
<p>This exercise has shown you that running dimensionality reduction algorithms using PLUMED involves the following stages:</p>
<ul>
<li>Data is collected from the trajectory using <a class="el" href="_c_o_l_l_e_c_t__f_r_a_m_e_s.html">COLLECT_FRAMES</a>.</li>
<li>Landmark points are selected using a <a class="el" href="_analysis.html#landmarks">Landmark Selection</a> algorithm</li>
<li>The distances between the trajectory frames are computed using <a class="el" href="_e_u_c_l_i_d_e_a_n__d_i_s_s_i_m_i_l_a_r_i_t_i_e_s.html">EUCLIDEAN_DISSIMILARITIES</a></li>
<li>A loss function is optimized to generate projections of the landmarks.</li>
<li>Projections of the non-landmark points are found using <a class="el" href="_p_r_o_j_e_c_t__a_l_l__a_n_a_l_y_s_i_s__d_a_t_a.html">PROJECT_ALL_ANALYSIS_DATA</a>.</li>
</ul>
<p>There are multiple choices to be made in each of the various stages described above. For example, you can change the particular sort of data this is collected from the trajectory. There are multiple different ways to select landmarks. You can use the distances directly, or you can transform them. You can use various loss functions and optimize the loss function using a variety of different algorithms. When you tackle your own research problems using these methods, you can experiment with the various choices that can be made. <br  />
</p>
<p><b>Generating a low-dimensional representation using these algorithms is not enough to publish a paper. </b> We want to get some physical understanding from our simulation. Gaining this understanding is the hard part.</p>
<h2><a class="anchor" id="masterclass-21-6-ex-4"></a>
Exercise 4: Path collective variables</h2>
<p>In many papers in this area, you will hear people talk about the distinction between collective variables and the reaction coordinate. The distinction these authors are trying emphasize when they use this language is between a descriptor that takes different values for the various important basins in the energy landscape (the collective variable) and the actual pathway the reaction proceeds along (the reaction coordinate). Furthermore, the authors of such papers will often argue that the reaction coordinate is simply some linear/non-linear combination of collective variables. In this exercise, we will study alanine dipeptide with path collective variables to show you one way of thinking about this distinction between collective variables and reaction coordinates. <br  />
 By studying a system that is this simple, you will also hopefully come to understand how we can interpret the coordinates that we extract using the dimensionality reduction algorithms that were discussed in the previous exercise.</p>
<p>To remind you, the free energy surface as a function of the \(\phi\) and \(\psi\) angles for alanine dipeptide is shown below:</p>
<p><a class="anchor" id="masterclass21-6-rama-fig"></a></p><div class="image">
<img src="belfast-2-rama.png" alt=""/>
<div class="caption">
The Free energy landscape of alanine dipeptide in Ramachandran angles in the CHARMM27 force field.</div></div>
<p>In other masterclasses, we have discussed how there are two critical states in the above energy landscape. These states are labelled C7eq and C7ax above. <br  />
 The two Ramachandran angles plotted on the x and y axes of the free energy surface above are examples of what we have called collective variables. Both of these angles can be used to distinguish between C7eq and C7ax configurations. The reaction coordinate is the path that the system actually takes as it moves from the C7ax to the C7eq configuration. Based on the shape of the free energy surface, we might suppose that this reaction coordinate looks something like the black line shown below:</p>
<p><a class="anchor" id="marvel-2-good-bad-path-fig"></a></p><div class="image">
<img src="belfast-2-good-bad-path.png" alt=""/>
<div class="caption">
Paths that connect the C7eq and C7ax configurations.</div></div>
<p>The file called alanine-transformation.pdb that you can find in the data directory of the GitHub repository contains a series of configurations that lie close to the transition path that is illustrated in black in the figure above. Below are plots that show how \(\phi\) and \(\psi\) change as the system moves along this path. <b>Try to see if you can use what you have learned in previous masterclasses to reproduce the figure above before continuing. </b> <br  />
</p>
<p><a class="anchor" id="masterclass21-6-rama-transitions"></a></p><div class="image">
<img src="masterclass-21-6-rama-transition.png" alt=""/>
<div class="caption">
Changes in the Ramachandran angles as the protein transitions from the C7ax to C7eq state.</div></div>
<h3><a class="anchor" id="masterclass-21-6-ex30"></a>
RMSD distances</h3>
<p>We know what structures correspond to the various stable states of our system. We might, therefore, be tempted to ask ourselves if we can not just use the RMSD distance from a structure as the reaction coordinate. This approach will work if there is a single important configuration in the energy landscape. We could use the RMSD distance from this lowest energy structure as a CV to extract this configuration's free energy relative to everything else. How well does this work if we have two distinct states, though, as we have for alanine dipeptide? To investigate this question, fill in the PLUMED input below that calculates the RMSD distances from the C7ax and C7eq configurations:</p>

<div style="width: 90%; float:left" id="value_details_eg5"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<b name="eg5c7ax" onclick='showPath("eg5","eg5c7ax")'>c7ax: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_r_m_s_d.html" style="color:green">RMSD</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=../data/C7ax.pdb <div class="tooltip">TYPE<div class="right"><b>compulsory keyword ( default=SIMPLE )</b>
the manner in which RMSD alignment is performed. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5c7ax"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg5c7eq" onclick='showPath("eg5","eg5c7eq")'>c7eq: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_r_m_s_d.html" style="color:green">RMSD</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=../data/C7eq.pdb <div class="tooltip">TYPE<div class="right"><b>compulsory keyword ( default=SIMPLE )</b>
the manner in which RMSD alignment is performed. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5c7eq"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg5c7ax">c7ax</b>,<b name="eg5c7eq">c7eq</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=100''' <span style="display:none;" id="eg5"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>You can run an MD simulation to monitor these distances using the python script below.</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>generate_gromacs_input( directory, plumed_input, nsteps, temp ) :</div>
<div class="line">    <span class="comment"># Setup the initial configuration by picking a frame at random from the startpoints file</span></div>
<div class="line">    allc = io.read(<span class="stringliteral">&#39;../data/startpoints.pdb&#39;</span>,<span class="stringliteral">&#39;:&#39;</span>)</div>
<div class="line">    nframes = len(allc)</div>
<div class="line">    io.write( directory + <span class="stringliteral">&#39;/conf.pdb&#39;</span>, allc[int(np.random.randint(0,nframes))] )</div>
<div class="line">    <span class="comment"># Copy the topology to the appropriate directory</span></div>
<div class="line">    shutil.copyfile(<span class="stringliteral">&quot;../data/topol.top&quot;</span>, directory + <span class="stringliteral">&quot;/topol.top&quot;</span>)</div>
<div class="line">    <span class="comment"># Setup the mdp file</span></div>
<div class="line">    mdp = open(<span class="stringliteral">&quot;../data/md.mdp&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>)</div>
<div class="line">    contents = mdp.read()</div>
<div class="line">    mdp.close()</div>
<div class="line">    new_content = contents.replace(<span class="stringliteral">&quot;SEED&quot;</span>, str(np.random.randint(0,1000000))).replace(<span class="stringliteral">&quot;NSTEPS&quot;</span>,str(nsteps)).replace(<span class="stringliteral">&quot;TEMP&quot;</span>,str(temp))</div>
<div class="line">    mdpout = open(directory + <span class="stringliteral">&quot;/md.mdp&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>)</div>
<div class="line">    mdpout.write(new_content)</div>
<div class="line">    mdpout.close()</div>
<div class="line">    <span class="comment"># And write the plumed input</span></div>
<div class="line">    pout = open(directory + <span class="stringliteral">&quot;/plumed.dat&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>)</div>
<div class="line">    pout.write( plumed_input )</div>
<div class="line">    pout.close()</div>
<div class="line">    <span class="keywordflow">return</span></div>
<div class="line"> </div>
<div class="line">plm = <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="stringliteral">INSERT PLUMED INNPUT HERE</span></div>
<div class="line"><span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="comment"># Create a directory to run the calculation in</span></div>
<div class="line">!rm -rf ../Unbiased_MD &amp;&amp; mkdir ../Unbiased_MD</div>
<div class="line"><span class="comment"># Generate gromacs input for MD simulation at 1000 K</span></div>
<div class="line">generate_gromacs_input( <span class="stringliteral">&#39;../Unbiased_MD&#39;</span>, plm, 500000, 1000 )</div>
<div class="line"><span class="comment"># Now run gromacs</span></div>
<div class="line">!cd ../Unbiased_MD/ &amp;&amp; gmx_mpi grompp -f md.mdp -c conf.pdb -p topol.top -maxwarn 2 &amp;&gt; /dev/null</div>
<div class="line">!cd ../Unbiased_MD/ &amp;&amp; gmx_mpi mdrun --plumed plumed.dat &amp;&gt; /dev/null</div>
<div class="line"><span class="comment"># And read in the colvar files</span></div>
<div class="line">unbiased_data = np.loadtxt(<span class="stringliteral">&#39;../Unbiased_MD/colvar&#39;</span>)</div>
</div><!-- fragment --><p>I ran simulations at 300K and 1000K using the above script. When the simulations completed, I was able to construct the figures below:</p>
<p><a class="anchor" id="masterclass21-6-rmsd-distances"></a></p><div class="image">
<img src="masterclass-21-6-rmsd-distances.png" alt=""/>
<div class="caption">
The black points are the configurations visited in MD simulations at 300K (left) and 1000K (right). The top panel shows these trajectories in the Ramachandran plane. In the lower panel, I have projected the trajectories on the RMSD distances from the two reference states.</div></div>
<p>The black points above are the RMSD values for the trajectories. I have also shown the RMSD values for the frames in alanine-transformation in red. Notice that all the configurations explored in the MD are very distant from the C7ax and C7eq states. <b>Try now to reproduce the above figure yourself.</b></p>
<p>You can see that at 300K, the simulation we ran did not visit the C7eq state. Furthermore, you can also clearly see this from the projections of the trajectories on the RMSD distances from these two configurations. Notice in these figures, however, that the distances from these two reference configurations were often considerably larger than the distance between these reference configurations and the configurations on the reference path in alanine-transformation.pdb.</p>
<h3><a class="anchor" id="masterclass-21-6-ex3a"></a>
Using dot products to calculate CVs</h3>
<p>Instead of calculating two distances, we might ask ourselves if the linear combination of \(\phi\) and \(\psi\) that is illustrated in the figure below:</p>
<p><a class="anchor" id="masterclass-21-6-pca-figure"></a></p><div class="image">
<img src="marvel-2-pca-coordinates.png" alt=""/>
<div class="caption">
An illustration showing how PCAVARS coordinates work. The vector connecting some reference state to any state the system is in can be in (purple and orange points) can be projected onto the vector connecting the two states of interest (black arrow) by using the dot product of the vectors shown here.</div></div>
<p>gives a better description for the transition. We can define this CV as follows:</p>
<p class="formulaDsp">
\[ s = \frac{(\phi_2 - \phi_1).(\phi_3 - \phi_1) + (\psi_2 - \psi_1).(\psi_3 - \psi_1)}{ \sqrt{(\phi_2 - \phi_1)^2 + (\psi_2 - \psi_1)^2} } \]
</p>
<p>In this expression \((\phi_1,\psi_1)\) are the Ramachandran angles in the \(C_7eq\) configuration and \((\phi_2,\psi_2)\) are the Ramachandran angles in the \(C_7ax\). \((\phi_3,\psi_3)\) is the instantaneous configuration. You should thus be able to see that we have arrived at the above expression by using our knowledge of the dot product between two vectors.</p>
<p><b>See if you can write an input to re-analyse the data in alanine-transformation.pdb and the MD simulations from the previous section using this CV.</b> <br  />
 You should be able to get plots of the value of this CV as a function of step number that looks like the ones shown below:</p>
<p><a class="anchor" id="masterclass21-6-pcavars-transitions"></a></p><div class="image">
<img src="masterclass-21-6-pcavars-transition.png" alt=""/>
<div class="caption">
The black points are the configurations visited in MD simulations at 300K (left) and 1000K (right). The top panel shows these trajectories in the Ramachandran plane. In the lower panel, I have projected the trajectories on vector in the Ramachandran plane shown above.</div></div>
<p>I implemented this CV using a combination of <a class="el" href="_t_o_r_s_i_o_n.html">TORSION</a> and <a class="el" href="_c_o_m_b_i_n_e.html">COMBINE</a>. I also ignored the fact that the torsions are periodic variables when calculating the linear combination. <br  />
 You can't use the sort of linear algebra above with periodic variables, but it is OK for these illustrative purposes. <br  />
</p>
<p>Notice that the first frame in alanine-transformation.pdb has the molecule in the \(C_7ax\) configuration. The last frame has the molecule in the \(C_7eq\) state. <br  />
</p>
<h3><a class="anchor" id="masterclass-21-6-ex3ab"></a>
PCA Collective Variables</h3>
<p>Figure <a class="el" href="masterclass-21-6.html#masterclass-21-6-pca-figure">masterclass-21-6-pca-figure</a> showed how we can construct a new collective variables by taking a linear combination of two other variables. This idea can be extended to higher dimensions, however. As long as we can find the vector that connectes the \(C_7eq\) and \(C_7ax\) states we can project our current coordinates on that particular vector. We can even define this vector in the space of the coordinates of the atoms. In other words, if the 3 \(N\) coordinate of atomic positions is \(\mathbf{x}^{(1)}\) for the \(C_7eq\) configuration and \(\mathbf{x}^{(2)}\) for the \(C_7ax\) configuration and if the instantaneous configuration of the atoms is \(\mathbf{x}^{(3)}\) we can use the following as a CV: </p><p class="formulaDsp">
\[ s = \frac{\sum_{i=1}^{3N} (x^{(2)}_i - x^{(1)}_i ) (x^{(3)}_i - x^{(1)}_i )}{ \sqrt{\sum_{i=1}^{3N} (x^{(2)}_i - x^{(1)}_i )^2} } \]
</p>
<p> as long as rotational and translational movement is removed before calculating the two displacement vectors above.</p>
<p>We can also get some sense of how far the system has moved from this vector by computing:</p>
<p class="formulaDsp">
\[ z = \sqrt{ \sum_{i=1}^{3N} (x^{(3)}_i - x^{(1)}_i)^2 - s^2 } \]
</p>
<p> which follows by applying Pythagoras theorem.</p>
<p>You can calculate this collective variable using PLUMED by using the input below:</p>
<pre class="fragment">p: PCAVARS __FILL__=pca-reference.pdb __FILL__=OPTIMAL
PRINT ARG=p.* FILE=colvar
</pre><p><b>Use this input to re-analyse the data in alanine-transformation.pdb and your MD simulations before continuing.</b> The figure below shows the results that I obtained by analyzing the data using the PCAVARS command above.</p>
<p><a class="anchor" id="masterclass-21-6-pcavars"></a></p><div class="image">
<img src="masterclass-21-6-pcavars.png" alt=""/>
<div class="caption">
The black points are the configurations visited in MD simulations at 300K (left) and 1000K (right). The top panel shows these trajectories in the Ramachandran plane. The projection on the vector connecting the C7ax and C7eq states (left) and the perpendicular distance from this vector (right) and shown in the bottom panels.</div></div>
<p>The figure above shows that this coordinate is good. We move quite far from this initial vector when we move to the C7ax state, however.</p>
<h3><a class="anchor" id="masterclass-21-6-ex90"></a>
Two PCA Collective variables</h3>
<p>Instead of using a single PCA variable and calculating the projection on the vector connecting these two points, we can instead use the projection of the instantaneous coordinates in the plane that contains three reference configurations. You can calculate these collective variables using PLUMED by using the input below:</p>
<pre class="fragment">p: PCAVARS __FILL__=pca2-reference.pdb __FILL__=OPTIMAL
PRINT ARG=p.* FILE=colvar
</pre><p>Notice that there are now three structures within pca2-reference.pdb, and thus two vectors are defined. <b>Use this input to re-analyse the data in alanine-transformation.pdb and your MD simulations before continuing.</b> <br  />
 The figure below shows the results that I obtained by analyzing the data using the PCAVARS command above.</p>
<p><a class="anchor" id="masterclass-21-6-pcavars2"></a></p><div class="image">
<img src="masterclass-21-6-pcavars2.png" alt=""/>
<div class="caption">
The black points are the configurations visited in MD simulations at 300K (left) and 1000K (right). The top panel shows these trajectories in the Ramachandran plane. The projection on the vectors defined using the configurations in pca2-reference.pdb is shown in the bottom panel. The green points in the top panel give the Ramachandran angles for the configurations used to define the reference configurations.</div></div>
<h3><a class="anchor" id="masterclass-21-6-ex3c"></a>
Path collective variables</h3>
<p>Instead of using the projection on more than one vector, we can extend the ideas in the previous section and use curvilinear paths rather than linear paths. This trick is what is done with the <a class="el" href="_p_a_t_h.html">PATH</a> CVs that are illustrated in the figure below:</p>
<p><a class="anchor" id="masterclass-21-sz-fig"></a></p><div class="image">
<img src="belfast-2-ab-sz.png" alt=""/>
<div class="caption">
The S variable can be thought as the length of the red segment, while the Z variable is the length of the green one.</div></div>
<p>  </div> </details> </p>
<p>As you can see, there are two path collective variables, \(S(X)\) measures your position on a path and is calculated using:</p>
<p class="formulaDsp">
\[ S(X)=\frac{\sum_{i=1}^{N} i\ \exp^{-\lambda \vert X-X_i \vert }}{ \sum_{i=1}^{N} \exp^{-\lambda \vert X-X_i \vert } } \]
</p>
<p>\(Z(x)\), meanwhile, measures the distance from the path using:</p>
<p class="formulaDsp">
\[ Z(X) = - \frac{1}{\lambda} \ln\left[ \sum_{i=1}^{N} \exp^{-\lambda \vert X-X_i \vert } \right] \]
</p>
<p>We can calculate these CVs using a filled-in version of the input that is shown below:</p>
<pre class="fragment">path: PATH __FILL__=../data/alanine-path.pdb TYPE=__FILL__ LAMBDA=15100.
PRINT ARG=* FILE=colvar
</pre><p>The figure below shows the \(\phi\) and \(\psi\) angles for the configurations that define the path as red dots. Meanwhile, the black dots are the \(\phi\) and \(\psi\) angles that are visited during a high temperature, unbiased MD trajectory. The green dots are then the configurations in alanine-transformation.pdb You can clearly see that the red dots lie along the transition path that connects the C7eq and C7ax configurations and that the green dots follow this pathway:</p>
<p><a class="anchor" id="masterclass21-6-path-angles"></a></p><div class="image">
<img src="masterclass-21-6-path-angles.png" alt=""/>
<div class="caption">
The path that we have defined for our transition in the Ramachandran plane. Black dots are the configurations visited at 300 K (left) and 1000 K (right)</div></div>
<p>When we calculate the path collective variables for the black and red data points in the above figure, we get the result shown on the right. The panel on the left shows the output from a 300 K simulation during which the C7eq configuration was not visited:</p>
<p><a class="anchor" id="masterclass21-6-path-path"></a></p><div class="image">
<img src="masterclass-21-6-path-path.png" alt=""/>
<div class="caption">
An analysis of the path CV values visited during trajectories at 300 K and 1000 K.</div></div>
<p>You can see that the majority of configurations have very small z values. It would thus seem that we have identified our reaction coordinate. We can use the S-path coordinate to tell us where we are on the transition pathway between the two states. Furthermore, in defining this coordinate, we have used the positions of all the heavy atoms in the protein. <br  />
</p>
<h3><a class="anchor" id="masterclass-21-6-ex3b"></a>
The isocommittor</h3>
<p>Notice that when we talk about the reaction coordinate, we are not talking about a single set of configurations that connect the two states. The previous sections have shown that there are always multiple pathways that connect the two states. The task of identifying a single reaction coordinate thus appears impossible. How, after all, can there be a single reaction path if we know that there are multiple pathways that connect the two states? <br  />
</p>
<p>One way of answering this question is to look at how far the transitions you observe deviate from the reference transition path using the Z-coordinate. An alternative answer can be found by considering so-called isocommittor surfaces. When using this method, you suppose there is a saddle point between the two states of interest (the \(C_7ax\) and \(C_7eq\) configurations in our alanine dipeptide example). <br  />
 Let's suppose that we now start a simulation with the system balanced precariously on this saddle point. The system will, very-rapidly, fall off the maximum and move towards either the left or the right basin. If we are exactly at the saddle, 50% of the trajectories will fall to the right, and 50% will fall to the left.</p>
<p>We can use the idea of the isocommittor to identify whether any collective variable is giving a good description of the transition state ensemble's location. The idea in such simulations is to define regions of space that correspond to the various stable states in the free energy landscape. We then launch lots of simulations from configurations that are not within these basins and identify the basin that these calculations visit first. We can then make graphs like those shown below. These graphs show the fraction of times a particular CV value was visited in a trajectory that visited the c7eq basin before it visited the c7ax basin.</p>
<p><a class="anchor" id="masterclass21-6-rmsd-committor"></a></p><div class="image">
<img src="masterclass-21-6-committor.png" alt=""/>
<div class="caption">
Probabilities of visiting the C7eq basin before the C7ax basin if you are differents points on each of the CV ranges.</div></div>
<p>The PLUMED input that I used when making the figure above is a filled in version of the following:</p>

<div style="width: 90%; float:left" id="value_details_eg6"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<b name="eg6phi" onclick='showPath("eg6","eg6phi")'>phi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=5,7,9,15 <span style="display:none;" id="eg6phi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg6psi" onclick='showPath("eg6","eg6psi")'>psi: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=7,9,15,17 <span style="display:none;" id="eg6psi"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg6pca" onclick='showPath("eg6","eg6pca")'>pca: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_c_a_v_a_r_s.html" style="color:green">PCAVARS</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=../data/pca-reference.pdb <div class="tooltip">TYPE<div class="right"><b>compulsory keyword ( default=OPTIMAL )</b>
The method we are using for alignment to the reference structure <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg6pca"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg6phi">phi</b>,<b name="eg6psi">psi</b>,<b name="eg6pca">pca.eig-1</b>,path.spath <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=1 <span style="display:none;" id="eg6"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <div class="tooltip">ARG<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg6phi">phi</b> <div class="tooltip">STRIDE<div class="right"><b> could not find this keyword </b><i></i></div></div>=1 <div class="tooltip">BASIN_LL1<div class="right"><b> could not find this keyword </b><i></i></div></div>=-3 <div class="tooltip">BASIN_UL1<div class="right"><b> could not find this keyword </b><i></i></div></div>=-1 <div class="tooltip">BASIN_LL2<div class="right"><b> could not find this keyword </b><i></i></div></div>=1 <div class="tooltip">BASIN_UL2<div class="right"><b> could not find this keyword </b><i></i></div></div>=2 <div class="tooltip">FILE<div class="right"><b> could not find this keyword </b><i></i></div></div>=basin <span style="display:none;" id="eg6"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>I deployed the input above within the following python script that launches a large number of gromacs simulations:</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>gen_trajectories( ntraj, plm ) : </div>
<div class="line">    nc7eq, c7eq_colv, all_data = 0, np.zeros([0,5]), np.zeros([0,5])</div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(ntraj) :</div>
<div class="line">        !rm -rf ../Test &amp;&amp; mkdir ../Test</div>
<div class="line">        generate_gromacs_input( <span class="stringliteral">&#39;../Test&#39;</span>, plm, 10000000, 300 )</div>
<div class="line">        !cd ../Test/ &amp;&amp; gmx_mpi grompp -f md.mdp -c conf.pdb -p topol.top -maxwarn 2 &amp;&gt; /dev/null </div>
<div class="line">        !cd ../Test/ &amp;&amp; gmx_mpi mdrun --plumed plumed.dat &amp;&gt; /dev/null</div>
<div class="line">        bfile = open(<span class="stringliteral">&#39;../Test/basin&#39;</span>,<span class="stringliteral">&#39;r&#39;</span>)</div>
<div class="line">        <span class="keyword">with</span> open( <span class="stringliteral">&#39;../Test/basin&#39;</span>, <span class="stringliteral">&quot;r&quot;</span> ) <span class="keyword">as</span> myfile :</div>
<div class="line">            <span class="keywordflow">for</span> line <span class="keywordflow">in</span> myfile :</div>
<div class="line">                <span class="keywordflow">if</span> line.startswith(<span class="stringliteral">&quot;#! SET COMMITTED TO BASIN&quot;</span>) : basin = line.split()[5]</div>
<div class="line">        colv_data = np.loadtxt(<span class="stringliteral">&quot;../Test/colvar&quot;</span>)</div>
<div class="line">        <span class="keywordflow">if</span> len(colv_data.shape)==1 : colv_data = np.reshape( colv_data, (1,5) )</div>
<div class="line">        all_data = np.concatenate( (all_data, colv_data), axis=0 )</div>
<div class="line">        <span class="keywordflow">if</span> basin==<span class="stringliteral">&quot;1&quot;</span> : </div>
<div class="line">            c7eq_colv = np.concatenate( (c7eq_colv, colv_data), axis=0 )</div>
<div class="line">            nc7eq = nc7eq + 1</div>
<div class="line">    print( <span class="stringliteral">&quot;NUMBER c7ax&quot;</span>, ntraj-nc7eq, <span class="stringliteral">&quot;c7eq&quot;</span>, nc7eq )</div>
<div class="line">    <span class="keywordflow">return</span> c7eq_colv, all_data</div>
<div class="line"> </div>
<div class="line">p=<span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="stringliteral">YOUR PLUMED INPUT GOES HERE</span></div>
<div class="line"><span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line">bas_data, all_data = gen_trajectories( ntraj, p )</div>
</div><!-- fragment --><p>Notice how the above script stores the CV values from trajectories that finished in the C7eq basin in the NumPy array called bas_data. We can use the data in this file to construct the (unnormalized) histograms of CV value that finished in C7eq and the total histogram. The script I used to construct these histograms is shown below. This script also shows how we can arrive at the final conditional probability distributions from <a class="el" href="masterclass-21-6.html#masterclass21-6-rmsd-committor">masterclass21-6-rmsd-committor</a> by dividing by the total number of configurations that moves to C7eq first by the total number of configuration that visited a point.</p>
<div class="fragment"><div class="line"><span class="keyword">def </span>histo( data, nbins, xmin, xmax ) :</div>
<div class="line">    delr = ( xmax - xmin ) / nbins </div>
<div class="line">    hist = np.zeros(nbins)</div>
<div class="line">    <span class="keywordflow">for</span> d <span class="keywordflow">in</span> data : </div>
<div class="line">        xbin = int( np.floor( (d-xmin) / delr ) )</div>
<div class="line">        hist[xbin] = hist[xbin] + 1</div>
<div class="line">    <span class="keywordflow">return</span> hist / delr </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>get_isocommitor( bas_data, full_data, nbins, xmin, xmax ) :</div>
<div class="line">    bas_histo = histo( bas_data, nbins, xmin, xmax ) </div>
<div class="line">    full_histo = histo( full_data, nbins, xmin, xmax )</div>
<div class="line">    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(nbins) : </div>
<div class="line">        <span class="keywordflow">if</span> np.abs(full_histo[i])&lt;1E-4 : bas_histo[i] = 0 </div>
<div class="line">        <span class="keywordflow">else</span> : bas_histo[i] = bas_histo[i] / full_histo[i]</div>
<div class="line">    <span class="keywordflow">return</span> bas_histo </div>
<div class="line"> </div>
<div class="line"><span class="comment"># This makes the isocommittor as a function of \f$\phi\f$:</span></div>
<div class="line">commit = get_isocommitor( bas_data[:,1],  all_data[:,1], 30, -np.pi, np.pi )</div>
</div><!-- fragment --><p>Notice that the script above does not compute the error bars I included in <a class="el" href="masterclass-21-6.html#masterclass21-6-rmsd-committor">masterclass21-6-rmsd-committor</a>. <b> Your task in this exercise is to reproduce this figure with the error bars.</b> I generated the error bars in <a class="el" href="masterclass-21-6.html#masterclass21-6-rmsd-committor">masterclass21-6-rmsd-committor</a> by running 10 sets of 500 simulations. I constructed separate histograms from each of these batches of simulations and calculated the mean and variance from these ten sets of samples.</p>
<h3><a class="anchor" id="masterclass-21-6-ex9"></a>
Conclusions</h3>
<p>The exercises in this section aimed to discuss the difference between collective variables and the reaction coordinate. I have argued that collective variables are developed by researchers thinking about coordinates that can distinguish between the important states. Reaction coordinates, meanwhile, are the actual pathways that reactions proceed along. These reaction coordinates are found by probing the data we get from simulations. <br  />
</p>
<p>I am not convinced that the distinction between reaction coordinates and collective variables is very important. Every coordinate we have tried in the previous sections has allowed us to determine whether we are in the C7eq or the C7ax basin. My view is that when we do science, we impose structure on our results by asking questions. Our question has been to determine the relative free energies of the C7ax and C7eq basins in this exercise. To do this, we have to define what configurations are in the C7ax basin and what configurations are in the C7eq basin. The distinction between these two structures is an arbitrary figment of our imagination. If we use different variables, we might be defining these states differently, and we might get slightly different answers. We should not be surprised by the fact that we get different answers if we ask the question differently. The important thing is to develop an interesting question and to tell a good story about whatever you find out.</p>
<h2><a class="anchor" id="masterclass-21-6-ex-X"></a>
Exercise 4: Dealing with indistinguishability</h2>
<p>Many researchers have used these rare event methods to study nucleation and crystal growth. Studying such problems introduces an additional challenge when designing collective variables as all the atoms are indistinguishable. You thus know before even running the simulation that there are multiple paths that connect the reactant (liquid) state and the product (solid) state. The nucleation, after all, can start with any atom in the simulation box. The first step in developing CVs for studying nucleation processes is thus to identify some order parameter that allows us to distinguish atoms that are in the solid state from atoms that are in the liquid state. The following input, once it is filled in will calculate some suitable order parameters for all the atoms in the system:</p>

<div style="width: 90%; float:left" id="value_details_eg7"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">NATURAL<div class="right">( default=off ) use natural units <i></i></div></div> <span style="display:none;" id="eg7"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg7coord" onclick='showPath("eg7","eg7coord")'>coord: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_o_r_d_i_n_a_t_i_o_n_n_u_m_b_e_r.html" style="color:green">COORDINATIONNUMBER</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=1-5184 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>={CUBIC D_0=1.2 D_MAX=1.5}  <span style="display:none;" id="eg7coord"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg7cub" onclick='showPath("eg7","eg7cub")'>cub: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_f_c_c_u_b_i_c.html" style="color:green">FCCUBIC</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=1-5184 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>={CUBIC D_0=1.2 D_MAX=1.5}  <div class="tooltip">ALPHA<div class="right"><b>compulsory keyword ( default=3.0 )</b>
The alpha parameter of the angular function <i></i></div></div>=27 <span style="display:none;" id="eg7cub"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg7fcub" onclick='showPath("eg7","eg7fcub")'>fcub: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_t_r_a_n_s_f_o_r_m__m_o_r_e.html" style="color:green">MTRANSFORM_MORE</a> <div class="tooltip">DATA<div class="right"><b>compulsory keyword </b>
The multicolvar that calculates the set of base quantities that we are interested
in <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>={SMAP R_0=0.45 D_0=0.0 A=8 B=8}  <span style="display:none;" id="eg7fcub"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_u_m_p_m_u_l_t_i_c_o_l_v_a_r.html" style="color:green">DUMPMULTICOLVAR</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg7coord">coord</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the atoms should be output <i></i></div></div>=1000 <div class="tooltip">__FILL_<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg7coord">coord.xyz</b> <span style="display:none;" id="eg7"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_u_m_p_m_u_l_t_i_c_o_l_v_a_r.html" style="color:green">DUMPMULTICOLVAR</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg7cub">cub</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the atoms should be output <i></i></div></div>=1000 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg7cub">cub.xyz</b> <span style="display:none;" id="eg7"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_u_m_p_m_u_l_t_i_c_o_l_v_a_r.html" style="color:green">DUMPMULTICOLVAR</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg7fcub">fcub</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the atoms should be output <i></i></div></div>=1000 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg7fcub">fcub.xyz</b> <span style="display:none;" id="eg7"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>You can run a short MD simulation on Lennard-Jonesium to compute those order parameter by using the following input (in) file for simplemd:</p>
<pre class="fragment">inputfile interface.xyz
outputfile output.xyz
temperature 0.6
tstep 0.005
friction 1
forcecutoff 2.5
listcutoff  3.0
nstep 10000
nconfig 100 trajectory.xyz
nstat   100 energies.dat
</pre><p>You can run this from a python notebook and read in the values of the order parameters by using the following script:</p>
<div class="fragment"><div class="line">p = <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="stringliteral">INSERT YOUR PLUMED INPUT HERE</span></div>
<div class="line"><span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"> </div>
<div class="line">inp = <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><span class="stringliteral">INSERT YOUR SIMPLEMD INPUT HERE</span></div>
<div class="line"><span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Make a directory to run in </span></div>
<div class="line">!rm -rf ../LJ-trajectories/First-run &amp;&amp; mkdir ../LJ-trajectories/First-run</div>
<div class="line"><span class="comment"># Copy the initial configuration</span></div>
<div class="line">!cp ../data/interface.xyz ../LJ-trajectories/First-run</div>
<div class="line"><span class="comment"># Output the plumed file</span></div>
<div class="line">f = open(<span class="stringliteral">&quot;../LJ-trajectories/First-run/plumed.dat&quot;</span>, <span class="stringliteral">&#39;w&#39;</span>)</div>
<div class="line">f.write(p)</div>
<div class="line">f.close()</div>
<div class="line"><span class="comment"># Output the input to simplemd</span></div>
<div class="line">f = open(<span class="stringliteral">&quot;../LJ-trajectories/First-run/in&quot;</span>, <span class="stringliteral">&#39;w&#39;</span>)</div>
<div class="line">f.write(inp)</div>
<div class="line">f.close()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Now run PLUMED</span></div>
<div class="line">!cd ../LJ-trajectories/First-run/ &amp;&amp; plumed simplemd &lt; <span class="keywordflow">in</span> &amp;&gt; /dev/null</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Read in the various order parameters (N.B. you can almost certainly write better python here)</span></div>
<div class="line">!grep X ../LJ-trajectories/First-run/coord.xyz | awk <span class="stringliteral">&#39;{print $5}&#39;</span> &gt; ../LJ-trajectories/First-run/coord.dat</div>
<div class="line">coord = np.loadtxt(<span class="stringliteral">&quot;../LJ-trajectories/First-run/coord.dat&quot;</span>)</div>
<div class="line">!grep X ../LJ-trajectories/First-run/cub.xyz | awk <span class="stringliteral">&#39;{print $5}&#39;</span> &gt; ../LJ-trajectories/First-run/cub.dat</div>
<div class="line">cub = np.loadtxt(<span class="stringliteral">&quot;../LJ-trajectories/First-run/cub.dat&quot;</span>)</div>
<div class="line">!grep X ../LJ-trajectories/First-run/fcub.xyz | awk <span class="stringliteral">&#39;{print $6}&#39;</span> &gt; ../LJ-trajectories/First-run/fcub.dat</div>
<div class="line">fcub = np.loadtxt(<span class="stringliteral">&quot;../LJ-trajectories/First-run/fcub.dat&quot;</span>)</div>
</div><!-- fragment --><p>A visualization of the order parameters for all the atoms can then be produced using chemiscope, which allows you to see the value of all the individual atom order parameters. <br  />
</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> ase</div>
<div class="line"><span class="keyword">import</span> ase.io</div>
<div class="line"><span class="keyword">from</span> chemiscope <span class="keyword">import</span> write_input</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Read in the trajectory</span></div>
<div class="line">traj = ase.io.read(<span class="stringliteral">&#39;../LJ-trajectories/First-run/trajectory.xyz&#39;</span>,<span class="stringliteral">&#39;:&#39;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This constructs the dictionary of properties for chemiscope</span></div>
<div class="line">properties = {</div>
<div class="line">    <span class="stringliteral">&quot;coord&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;atom&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: coord,</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Coordination number of atom&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;cub&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;atom&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: cub,</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;FCCCUBIC order parameter&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;fcub&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;target&quot;</span>: <span class="stringliteral">&quot;atom&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;values&quot;</span>: fcub,</div>
<div class="line">        <span class="stringliteral">&quot;description&quot;</span>: <span class="stringliteral">&quot;Transformed FCCUBIC order parameter&quot;</span>,</div>
<div class="line">    },</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment"># This generates our chemiscope output</span></div>
<div class="line">write_input(<span class="stringliteral">&quot;fccubic_chemiscope.json.gz&quot;</span>, cutoff=1.5, frames=traj, properties=properties )</div>
</div><!-- fragment --><p><b> Put all the above together and see if you can produce a chemiscope representation like the one below </b></p>
<p><a class="anchor" id="masterclass-21-6-lj-chemiscope"></a></p><div class="image">
<img src="masterclass-21-lj-chemiscope.png" alt=""/>
<div class="caption">
A representation of a solid-liquid system that was generated using chemiscope.</div></div>
<p>Chemiscope is invaluable for determining whether our order parameter is good at distinguishing the atoms within the solid from those within the liquid. If you visualize the FCCCUBIC or the transformed values of these parameters in the example above, you see that roughly half of the atoms are solid-like, and nearly half of the atoms are liquid-like. Notice also that we can use the dimensionality reduction that were discussed in <a class="el" href="masterclass-21-6.html#masterclass-21-6-ex-4">Exercise 4: Path collective variables</a> and clustering algorithms to develop these atomic order parameters. Generating the data to analyze using these algorithms is easier because we can get multiple sets of coordinates to analyze from each trajectory frame. The atoms are, after all, indistinguishable.</p>
<p>Once we have identified an order parameter we can analyse the distribution of values that it takes by using an input like the one shown below:</p>

<div style="width: 90%; float:left" id="value_details_eg8"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">NATURAL<div class="right">( default=off ) use natural units <i></i></div></div> <span style="display:none;" id="eg8"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg8coord" onclick='showPath("eg8","eg8coord")'>coord: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_o_r_d_i_n_a_t_i_o_n_n_u_m_b_e_r.html" style="color:green">COORDINATIONNUMBER</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=1-5184 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>={CUBIC D_0=1.2 D_MAX=1.5}  <span style="display:none;" id="eg8coord"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg8cub" onclick='showPath("eg8","eg8cub")'>cub: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_f_c_c_u_b_i_c.html" style="color:green">FCCUBIC</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=1-5184 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>={CUBIC D_0=1.2 D_MAX=1.5}  <div class="tooltip">ALPHA<div class="right"><b>compulsory keyword ( default=3.0 )</b>
The alpha parameter of the angular function <i></i></div></div>=27 <span style="display:none;" id="eg8cub"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg8fcub" onclick='showPath("eg8","eg8fcub")'>fcub: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_t_r_a_n_s_f_o_r_m__m_o_r_e.html" style="color:green">MTRANSFORM_MORE</a> <div class="tooltip">DATA<div class="right"><b>compulsory keyword </b>
The multicolvar that calculates the set of base quantities that we are interested
in <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>={SMAP R_0=0.45 D_0=0.0 A=8 B=8}  <span style="display:none;" id="eg8fcub"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg8coord_histo" onclick='showPath("eg8","eg8coord_histo")'>coord_histo: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8coord">coord</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=10 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=2 <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=15 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=100 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=DISCRETE <span style="display:none;" id="eg8coord_histo"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg8cub_histo" onclick='showPath("eg8","eg8cub_histo")'>cub_histo: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8cub">cub</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=10 <div class="tooltip">GRID_MIN<div class="right"><b>compulsory keyword </b>
the lower bounds for the grid <i></i></div></div>=-1 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=1 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=100 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=DISCRETE <span style="display:none;" id="eg8cub_histo"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg8fcub_histo" onclick='showPath("eg8","eg8fcub_histo")'>fcub_histo: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_h_i_s_t_o_g_r_a_m.html" style="color:green">HISTOGRAM</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8fcub">fcub</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the data should be collected and added to the quantity being
averaged <i></i></div></div>=10 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=0 <div class="tooltip">GRID_MAX<div class="right"><b>compulsory keyword </b>
the upper bounds for the grid <i></i></div></div>=1 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=100 <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=DISCRETE <span style="display:none;" id="eg8fcub_histo"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8coord_histo">coord_histo</b> <div class="tooltip">FILE<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8coord_histo">coord_histo.dat</b> <span style="display:none;" id="eg8"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8cub_histo">cub_histo</b> <div class="tooltip">FILE<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8cub_histo">cub_histo.dat</b> <span style="display:none;" id="eg8"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/___f_i_l_l__.html" style="color:green">__FILL__</a> <div class="tooltip">__FILL__<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8fcub_histo">fcub_histo</b> <div class="tooltip">FILE<div class="right"><b> could not find this keyword </b><i></i></div></div>=<b name="eg8fcub_histo">fcub_histo.dat</b> <span style="display:none;" id="eg8"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>The resulting distributions of order parameter values should look like this:</p>
<p><a class="anchor" id="masterclass-21-6-order-params"></a></p><div class="image">
<img src="masterclass-21-6-order-params.png" alt=""/>
<div class="caption">
The distributions of the various order parameters in a simulation of the solid-liquid system.</div></div>
<p><b> Try to use the information above to reproduce this plot. </b> Notice that the distribution of order parameters for the FCC Cubic order parameters is bimodal. There is a peak corresponding to the value that this quantity takes in the box's liquid part. The second peak then corresponds to the value that the quantity takes in the box's solid part. The same cannot be said for the coordination number by contrast. Notice, last of all, that by transforming the values above we have an order parameter that is one for atoms that are within the solid and zero otherwise.</p>
<p>It is tempting to argue that the number of solid particles is equal to the number of atoms that have an order parameter that is greater than some threshold. A better way to calculate the number of solid particles, however, is to proceed as follows:</p>
<ul>
<li>Run simulations of the solid and liquid under the same thermodynamic conditions.</li>
<li>Calculate the average values per atom value of the order parameter in these simulations of the solid \(\phi_s\) and liquid \(\phi_l\).</li>
<li><p class="startli">Calculate the number of solid \(n_l\) and liquid atoms \(n_l\) by solving the following pair of simultaneous equations \(N=n_s + n_l\) and \(\Phi = n_s \phi_s + n_l \phi_l\), where \(N\) is the total number of atoms. \(\Phi\), meanwhile, is given by:</p>
<p class="formulaDsp">
\[ \Phi = \sum_{i=1}^N \phi_i \]
</p>
</li>
</ul>
<p>The sum runs over all the atoms and where \(\phi_i\) is the order parameter for the \(i\)th atom in the system.</p>
<p>This procedure works because \(\Phi\) is an extensive quantity and is thus additive. If we have a system that contains a aolid liquid interface we can express the value of any extensive quantity, \(\Psi\) using:</p>
<p class="formulaDsp">
\[ \Psi = n_s \psi_s + n_l \psi_l + \psi_i \]
</p>
<p>where \(\psi_s\) and \(\psi_l\) is the average value per atom value of the quantity \(\psi\) in the solid and liquid phases. \(\psi_i\), meanwhile, is the so-called surface excess term which measures the contribution that the presence of the interface makes to the value of \(\Psi\). When we find \(n_s\) by solving the simultaneous equations above, we assume that this excess term is zero.</p>
<p><b> To complete this exercise, you should run simulations of the solid, liquid and interface. You should use the ensemble average of the order parameter for your solid and liquid simulations to make a graph like the one below that shows the number of atoms of solid as a function of time for the system that contains the interface</b>. The number of solid atoms has been determined by solving the simultaneous equations using the theory above. Notice that there are input configurations for the solid, liquid and interface systems in the data directory of the GitHub repository. The solid configuration is in solid.xyz. The liquid is in liquid.xyz, and the interface is in interface.xyz. The final result you get will look something like this:</p>
<p><a class="anchor" id="masterclass-21-6-solid-liquid"></a></p><div class="image">
<img src="masterclass-21-6-solid-liquid.png" alt=""/>
<div class="caption">
The number of solid atoms calculated by assuming a zero excess term for the sum of coordination numbers (black), the sum of fcc order parameters (red) and the sum of transformed fcc order parameters (green)</div></div>
<p>Notice that the green line is the least noisy of these curves. The reason the line is less noisy is connected to the fact that you have the clearest delineation between solid and liquid atoms when you use this order parameter.</p>
<p>NB. We are running at constant volume because we are keeping things simple and using simplemd. If you are studying nucleation using these techniques, you should run at constant pressure.</p>
<h2><a class="anchor" id="masterclass-21-6-ex-7"></a>
Exercise 7: Applying these ideas in your research</h2>
<p>The exercises in this tutorial have introduced you to the following ideas:</p>
<ul>
<li>Using chemiscope to visualize trajectories and collective variables.</li>
<li>Using dimensionality reduction algorithms</li>
<li>Using Path collective variables</li>
<li>Clustering trajectories</li>
<li>Dealing with indistinguishable atoms</li>
</ul>
<p>What I would like to do in the follow-up session is to think about how you can use these ideas as you do your research. The first step in using any of these questions is asking a research question that is amenable to answering using one of these methods. In this final exercise, I would like you to think about using these methods in your research. The first step in doing so is asking yourself the question <b>what am I trying to find out?</b> The clearer you make this question, the easier you will find the subsequent research project. With this in mind, here are some examples of terrible research questions:</p>
<ul>
<li>Understanding protein-ligand interactions using machine learning algorithms.</li>
<li>Understanding the mechanism via which limescale forms in pipes</li>
<li>Understanding protein folding using machine learning.</li>
<li>Studying transport through membrane proteins.</li>
<li>Understanding the catalytic mechanism of iron in ammonia formation.</li>
</ul>
<p>These research questions are terrible because the final result that you will obtain has not been specified. It is unclear when the project will be finished, or what success in this project looks like. With this in mind, consider the following alternative questions, which each have a clear goal. Each of the goals below maps on to one of the terrible research questions above:</p>
<ul>
<li>Calculate the free energy change when ligand A binds to protein B.</li>
<li>Calculate the free energy change when single calcium and carbonate ions bind to copper surfaces.</li>
<li>Calculate the free energy change when protein A transitions to its folded state.</li>
<li>Calculate the free energy change as a sodium ion moves through a sodium channel protein.</li>
<li>Calculate the free energy change when nitrogen, hydrogen and ammonia gas bind to iron surfaces.</li>
</ul>
<p>For each of the questions above, it is clear what success will look like &ndash; you will have a converged estimate of the free energy difference. We have shown you how such estimates can be extracted in previous masterclasses and what it looks like when such calculations go wrong. Answering these research questions is thus simply a matter of applying what you have learned. Notice, also, how for each of the questions above, it is clear what you can do in the first step:</p>
<ul>
<li>Run a parallel tempering metadynamics simulation with the distance between the centres of mass of the protein and the ligand as a CV.</li>
<li>Run a metadynamics simulation of a slab of copper in contact with an aqueous solution containing a single calcium ion. Use the z component of the vector connecting the calcium ion and the centre of mass of the copper slab as the CV. Run a metadynamics simulation using the distance from the protein's folded state as the collective variable.</li>
<li>Run a metadynamics simulation of the sodium in the channel protein. Use the z position of the sodium relative to the centre of the channel protein as a CVs.</li>
<li>Run a metadynamics simulation of a slab of iron in contact with a simulation box that is empty except for one nitrogen molecule. Use the z component of the vector connecting the centre of mass of the nitrogen and the centre of mass of the iron slab as the CV.</li>
</ul>
<p>These simulations may or may not give you the desired free energy difference. You will at least get some trajectory data from them, however. You can then analyze the trajectories using a machine learning algorithm or similar to refine your approach. This refining stage is where the experience of your supervisor should be invaluable.</p>
<p>With all this in mind, think about your research project. Try to develop a research question to work on and an approach that you can use to tackle this question. Your question should not be some grand challenge. <br  />
 It should be something simple that you know how to do. You do not need to run these simulations. I want you to think about the research question to discuss them at the follow-up session. I want you to think about how you can use these methods in your research as if you are not doing so, attending these masterclasses is pointless as you will never really apply these methods. <br  />
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
