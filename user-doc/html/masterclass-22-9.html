<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: PLUMED Masterclass 22.9: Using path collective variables to find reaction mechanisms in complex free energy landscapes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('masterclass-22-9.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PLUMED Masterclass 22.9: Using path collective variables to find reaction mechanisms in complex free energy landscapes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Authors</dt><dd>Bernd Ensing </dd></dl>
<dl class="section date"><dt>Date</dt><dd>June 6, 2022</dd></dl>
<p>Much of this exercise was originally created by Alberto Pérez de Alba Ortíz for the Cecam School "Understanding Molecular Simulation", held annually in Amsterdam.</p>
<h1><a class="anchor" id="masterclass-22-9-aims"></a>
Aims</h1>
<p>The aim of this Masterclass is to demonstrate the advantages of path collective variables for describing and simulating activated molecular processes, and to provide hands-on experience with setting up, running, and analyzing biased path-CV simulations, such as path-metadynamics.</p>
<h1><a class="anchor" id="masterclass-22-9-lo"></a>
Objectives</h1>
<p>Once this Masterclass is completed, users will be able to:</p>
<ul>
<li>Use the Plumed PesMD engine to run test simulations of enhanced sampling methods.</li>
<li>Write Plumed input files to run metadynamics and path-metadynamics simulations.</li>
<li>Tune the adaptive path-CV parameters for optimal efficiency.</li>
<li>Analyze the evolution and convergence of the transition path and the free energy profile.</li>
<li>Use the multiple walker parallelization of metadynamics and path-metadynamics.</li>
<li>Restart a PMD simulation from a previous guess path.</li>
</ul>
<h1><a class="anchor" id="masterclass-22-9-pre"></a>
Prerequisites</h1>
<p>We assume that you are familiar with PLUMED. However, the 2021 PLUMED Masterclass is a great place to start if you are not.</p>
<h1><a class="anchor" id="masterclass-22-9-install"></a>
Setting up the software</h1>
<p>The data needed to complete the exercises of this Masterclass can be found on <a href="https://github.com/Ensing-Laboratory/masterclass-22-09">GitHub</a>. You can clone this repository locally on your machine using the following command:</p>
<pre class="fragment">git clone https://github.com/Ensing-Laboratory/masterclass-22-09
</pre><p>We will use Plumed version 2.3.0 for this exercise together with personal versions of the PathCV and PESMD features. With the above <code>git clone</code> command, you have already downloaded them, and with the following commands we compile this version of plumed:</p>
<pre class="fragment">cd masterclass-22-09/plumed
chmod +x install
./install
</pre><p>This takes about 5-10 minutes on a modern laptop or desktop computer. After that, the plumed executable is installed in the folder <code>masterclass-22-09/plumed/bin</code>.</p>
<p>Information on these versions of the PathCV option and the PESMD option may be slightly different from that in the latest online plumed manual. Instead, open your local version in a browser, which you can find in the following locations on your computer:</p>
<ul>
<li><code>masterclass-22-09/plumed/plumed-2.3.0/user-doc/html/index.html</code></li>
<li><code>masterclass-22-09/plumed/plumed-2.3.0/user-doc/html/pesmd.html</code></li>
<li><code>masterclass-22-09/plumed/plumed-2.3.0/user-doc/html/_p_a_t_h_c_v.html</code></li>
</ul>
<p>The exercises are found in the folder <code>masterclass-22-09/exercises</code>.</p>
<h2><a class="anchor" id="masterclass-22-9-intro"></a>
Introduction</h2>
<p>In this exercise, we will perform metadynamics [1] and path-metadynamics (PMD) [2-4] simulations of a system that can undergo a transition between two free energy minima. These two stable states are separated by a transition state barrier, so that the transition process is a <em>rare event</em> for `&lsquo;normal&rsquo;' (i.e. unbiased) molecular dynamics simulations.</p>
<p>PMD is able to simultaneously and efficiently converge the transition path (which can be either an average transition path or a minimum free energy path (MFEP)) and the free energy profile of the process along this path. This is achieved by performing metadynamics on an adaptive path connecting the two known stable states.</p>
<p>In order to understand the principles and advantages of PMD, we will first perform standard metadynamics and get familiar with its parameters and functionalities. Subsequently, we will add the features corresponding to the adaptive path. To ease computation and visualization, we will employ a simple model system.</p>
<p>This exercise makes use of PLUMED's [5] own internal engine: <em>plumed pesmd</em>, i.e. without being coupled to an MD engine that runs an actual molecular system. The advantages are that the simulations will be very fast, and you do not need to know anything about the MD engine of our choice, which might be different from the one that you are used to.</p>
<p>Still, the enhanced sampling techniques that you will use in this exercise, and the plumed input files that we will write for that, can also be used (with very little changes) with plumed patched to any MD software, which means that you can potentially use it for your own research!</p>
<p>In order to overcome the timescale limitations of MD and be able to observe relevant molecular transitions, the community has developed a plethora of enhanced sampling methods. Among them, we can identify the so-called biasing methods, which work by exerting an external potential (or force) on a few key descriptive degrees of freedom of the transition, commonly called <em>collective variables</em> (CVs).</p>
<p>The choice and design of CVs is a task of great importance. In the following, we will assume that the CVs are known. We will consider a molecular system whose free energy surface (FES) is fully described by a set of \(N\) CVs, \(\{z_i(\mathbf{q}\,)\}\) with \(i=1... N\), which are all functions of the system's particle positions \(\mathbf{q}(t)\). We will also assume that these particle positions \(\mathbf{q}(t)\) evolve in time with a canonical equilibrium distribution at temperature \(T\) under a potential \(V(\mathbf{q})\).</p>
<h2><a class="anchor" id="masterclass-22-9-metadyn"></a>
Metadynamics</h2>
<p>We are interested in exploring the space spanned by the CVs, \(\{z_i\}\), and in quantifying the free energy. In order to do so, in metadynamics we exert a history-dependent repulsive potential by summing Gaussian kernels over time:</p>
<p class="formulaDsp">
\[ V_\text{bias}(\mathbf{z},t) = \sum_{\kappa\tau&lt;t} H(\kappa\tau) \exp \biggr( - \sum^{N}_{i=1} \frac{(z_i - z_i(q(\kappa\tau)))^2}{2 W_i^2} \biggr), \]
</p>
<p>with Gaussian height \(H\), widths along each CV \(W_i\), and depositing frequency \(\tau\). This bias drives the system away from already visited configurations and into new regions of CV-space. More importantly, in the long-time limit, the bias potential converges to the minus free energy as function of the CVs: \(V_\text{bias}(\mathbf{z},t \rightarrow \infty) = - F(\mathbf{z})\).</p>
<p>As a well-established sampling technique, metadynamics also has several extensions to accelerate convergence and improve computational performance, such as the multiple-walker and well-tempered versions [6,7].</p>
<p>Metadynamics can handle a few CVs simultaneously in a trivial manner, which spares us from having to find a single perfect CV. Instead, an appropriate set of CVs allows us to converge an insightful multidimensional free energy landscape, in which (meta)stable states and connecting MFEPs can be identified. In practice however, especially when investigating complex transitions, the number of CVs is limited to \(N\approx3\), because of the exponential growth of computational cost with CV dimensionality.</p>
<h2><a class="anchor" id="masterclass-22-9-label1"></a>
Path-metadynamics</h2>
<p>In order to tackle complex transitions that require many CVs, path-based methods were developed. In these schemes, a path-CV is introduced. That is, a parametrized curve that connects two FES basins &mdash; the known stable states \(A\) and \(B\) &mdash; in the space spanned by the CVs: \(\mathbf{s}(\sigma): \mathbb{R} \rightarrow \mathbb{R}^N\), where the parameter \(\sigma(\mathbf{z}\,) | _{s} : \mathbb{R}^N \rightarrow [0,1]\) yields the progress along the path from \(A\) to \(B\), such that \(\mathbf{s}(0) \in A\) and \(\mathbf{s}(1) \in B\).</p>
<p>This progress parameter emulates the reaction coordinate and can in principle be connected to the committor value. Since the transition path curve is not known a priori, the path-CV must be adaptive. If we assume that, in the vicinity of the path, the iso-commitor planes \(S_\sigma\) are perpendicular to \(\mathbf{s}(\sigma)\), and that the configurational probability is a good indicator of the transition flux density, then we can converge the average transition path by iteratively adapting a guess path to the cumulative average density: \(\mathbf{s}_g(\sigma_g) = \langle\mathbf{z}\,\rangle _{\sigma_g}\) [3].</p>
<p>The key advantage of PMD is that the metadynamics biasing can be performed on the 1D progress parameter along the adaptive path-CV, instead of the \(N\)-dimensional CV-space. PMD is able to converge a path, and the free energy along it, with a sublinear rise in computational cost with respect to the growth in CV dimensionality (instead of the exponential relation when not using a path-CV)[4].</p>
<p>Numerically, the adaptive path-CV is implemented as a set of \(M\) ordered nodes (coordinates in CV-space) \(\mathbf{s}_g (\sigma_g,t) \rightarrow {\mathbf{s}^{\,t_i}_j}\) with \(j=1,...,M\), where \(t_i\) is the discrete time of path updates. The projection of any point \(\mathbf{z}\) onto the path is done considering the closest two nodes, and \(\sigma\) is obtained by interpolation. This approach requires equidistant nodes, which are imposed by a reparametrization step after each path update. The update step for the path nodes is done by:</p>
<p class="formulaDsp">
\[ \mathbf{s}_j^{\,t_{i+1}} = \mathbf{s}_j^{\,t_{i}} + \frac{ \sum_k^{} w_{k} \cdot ( \mathbf{z}_k - \mathbf{s}^{\,t_{i}} ( \sigma (\mathbf{z}_k) ) )} { \sum_k^{} \xi^{t_i - k} w_{j,k} }, \text{ with } \\ w_{k} = \max \biggr[ 0, \biggr( 1 - \frac{|| \mathbf{s}^{\,t_i}_j - \mathbf{s}^{\,t_i} (\sigma ( \mathbf{z}_k)) ||}{|| \mathbf{s}^{\,t_i}_j - \mathbf{s}^{\,t_i}_{j+1} ||} \biggr) \biggr], \]
</p>
<p>where \(k\) is the current MD step and \(w\) is the weight of the adjustment, which is non-zero only for the two nodes closest to the average CV density. We also introduce the fade factor \(\xi =\exp( -\ln(2) / \tau_{1/2})\), with \(\tau_{1/2}\) as a half-life: the number of MD steps after which the distances measured from the path weight only 50% of its original value. A short half-life increases path flexibility by allowing it to rapidly `&lsquo;forget&rsquo;' a bad initial guess, while a long half-life restricts the path fluctuations and leads eventually to optimal convergence. The first and last nodes, located at the stable states \(A\) and \(B\) respectively, remain fixed. Extra trailing nodes can be placed at both ends of the path to better capture the free energy valleys. Wall potentials can be used to keep the sampling near the relevant [0,1] \(\sigma\)-interval.</p>
<p>Additionally, a harmonic restraint set on \(|| \mathbf{z}_k - \mathbf{s}^{\,t_{i}} ( \sigma (\mathbf{z}_k) ) ||\) can help in converging to a specific transition path in scenarios with multiple or ill-defined transition channels. We refer to this restraint as a `&lsquo;tube&rsquo;' potential. In the limit of an infinitesimally narrow tube potential, the path update step follows the local free energy gradient and PMD converges to the MFEP instead of the average transition path. This control over the behavior of the algorithm is an advantageous feature, as switching from a density-driven to a gradient-driven path optimization leads either to the average transition path or the MFEP.</p>
<p>Metadynamics, the method of choice to sample the path-CV, drives the system back and forth along the path, providing sufficient sampling of the CV density to localize the transition path. At the same time, metadynamics continuously self-corrects the free energy by overwriting the previously deposited Gaussians with new ones. This leads to a converged free energy along the localized path: \(V_\text{bias}(\sigma,t \rightarrow \infty) = -F(\sigma)\). Most of the algorithmic extensions developed for metadynamics (well-tempered, transition-tempered, multiple walkers, etc.) can be straightforwardly combined with the adaptive path-CV. Moreover, other biasing techniques (umbrella sampling, constrained MD, steered MD, etc.) can also be used to sample along the path, or even in the direction perpendicular to it.</p>
<h2><a class="anchor" id="masterclass-22-9-model"></a>
Model system</h2>
<p>In this exercise, we will sample the well-known M&uuml;ller-Brown (MB) potential energy surface (PES). You can find more about it in Ref. [8]. We add harmonic walls to limit the sampling within the interesting region of the PES.</p>
<p><a class="anchor" id="fig-mullerbrown"></a></p><div class="image">
<img src="mullerbrown.png" alt=""/>
<div class="caption">
The two-dimension M&uuml;ller-Brown potential showing two minima connected by a curvy reaction channel.</div></div>
<h2><a class="anchor" id="masterclass-22-9-plumed"></a>
Using PLUMED</h2>
<p>To install PLUMED, if you have not already done this above, go to the folder <code>plumed</code> in the folder for this exercise. In the script <code>install</code>, change the prefix to the installation folder of your choice, and then run the script. If you have issues with the installation you can check: <a href="https://plumed.github.io/doc-v2.3/user-doc/html/_installation.html">https://plumed.github.io/doc-v2.3/user-doc/html/_installation.html</a></p>
<p>To visualize the results of this exercise, plotting script examples are provided for the <a href="http://www.gnuplot.info">gnuplot</a> plotting software (see the script files names starting with <code>plot_</code> or <code>anim_</code>). Make sure to change the corresponding variables according to your choices of the metadynamics and path-CV parameters. Of course, feel free to use other plotting tools, for example pythons matplotlib.</p>
<p>To run the PLUMED pesmd on the MB PES, use the command <code>plumed pesmd &lt; path/to/input</code>. The <code>input</code> file is located in the <code>Exercise</code> folder. Review the PLUMED pesmd documentation: <a href="https://plumed.github.io/doc-v2.4/user-doc/html/pesmd.html">https://plumed.github.io/doc-v2.4/user-doc/html/pesmd.html</a>. To perform metadynamics, you can review the keywords on: <a href="https://plumed.github.io/doc-v2.3/user-doc/html/_m_e_t_a_d.html">https://plumed.github.io/doc-v2.3/user-doc/html/_m_e_t_a_d.html</a>. To use the adaptive path-CV, you can review the keywords in the header of the file <code>PathCV.cpp</code> in the folder <code>plumed</code> in the folder for this exercise. To see the html documentation on the path-CV in a browser, open &lt;PMD_exercise/plumed/plumed-2.3.0/user-doc/html/_p_a_t_h_c_v.html&gt; in a browser. To construct a FES from the metadynamics hills, use the <code>plumed sum\_hills</code> functionality. Consult its features on: <a href="https://plumed.github.io/doc-v2.3/user-doc/html/sum_hills.html">https://plumed.github.io/doc-v2.3/user-doc/html/sum_hills.html</a>. We recommend to use <code>--stride</code> 1 and <code>--mintozero</code>.</p>
<h2><a class="anchor" id="masterclass-22-9-exer1"></a>
Exercise 1</h2>
<p>The first exercise is found in the folder: <code>masterclass-22-09/exercises/0_md</code>.</p>
<p>This first exercise is meant to get acquainted with running the <code>plumed pesmd</code> engine, understanding the input files, and plotting the MD trajectory in the MB potential from the colvar file using gnuplot (or other plotting software). To use the <code>./run.me</code> script to start the simulation, first make the script executable using:</p>
<pre class="fragment">chmod +x ./run.me
</pre><p>Use PLUMED pesmd to run regular MD on the MB PES.</p>
<p>What do you observe?</p>
<p>How would you change the behaviour of the system without using an enhanced sampling method (just modifying the MD run parameters)?</p>
<h2><a class="anchor" id="masterclass-22-9-exer2"></a>
Exercise 2</h2>
<p>This exercise is found in the folder: <code>masterclass-22-09/exercises/1_metadynamics</code>.</p>
<p>Before you can run the metadynamics simulation, the <code>plumed.dat</code> should be completed:</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-failed-red.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_n_i_t_s.html" style="color:green">UNITS</a> <div class="tooltip">LENGTH<div class="right">the units of lengths. <i></i></div></div>=nm <div class="tooltip">TIME<div class="right">the units of time. <i></i></div></div>=fs <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1cv" onclick='showPath("eg1","eg1cv")'>cv: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,2 <div class="tooltip">COMPONENTS<div class="right">( default=off ) calculate the x, y and z components of the distance separately and
store them as label.x, <i></i></div></div> <span style="display:none;" id="eg1cv"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1lwall" onclick='showPath("eg1","eg1lwall")'>lwall: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_l_o_w_e_r__w_a_l_l_s.html" style="color:green">LOWER_WALLS</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1cv">cv.x</b>,<b name="eg1cv">cv.y</b> <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the positions of the wall. <i></i></div></div>=-1.5,-0.5 <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword </b>
the force constant for the wall. <i></i></div></div>=1000.0,1000.0 <span style="display:none;" id="eg1lwall"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1uwall" onclick='showPath("eg1","eg1uwall")'>uwall: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_p_p_e_r__w_a_l_l_s.html" style="color:green">UPPER_WALLS</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1cv">cv.x</b>,<b name="eg1cv">cv.y</b> <div class="tooltip">AT<div class="right"><b>compulsory keyword </b>
the positions of the wall. <i></i></div></div>=1.5,2.5 <div class="tooltip">KAPPA<div class="right"><b>compulsory keyword </b>
the force constant for the wall. <i></i></div></div>=1000.0,1000.0 <span style="display:none;" id="eg1uwall"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg1metad" onclick='showPath("eg1","eg1metad")'>metad: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_#_#_#.html" style="color:green">###</a> <div class="tooltip">ADD<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">YOUR<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">METADYNAMICS<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">INSTRUCTIONS<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">HERE<div class="right"><b> could not find this keyword </b><i></i></div></div> <span style="display:none;" id="eg1metad"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1cv">cv.x</b>,<b name="eg1cv">cv.y</b>,<b name="eg1metad">metad.bias</b> <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=100 <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=colvar.out <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_u_s_e.html" style="color:green">USE</a> <div class="tooltip">PLUMED<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">pesmd<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">to<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">run<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">metadynamics<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">on<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">the<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">MB<div class="right"><b> could not find this keyword </b><i></i></div></div> <div class="tooltip">PES.<div class="right"><b> could not find this keyword </b><i></i></div></div> <span style="display:none;" id="eg1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Here are some hints for defining the <code>METAD</code> rule:</p><ul>
<li>the CVs are here the <code>DISTANCE</code> components <code>cv.x</code> and <code>cv.y</code>, which are actually the coordinates of a "2D particle" (with respect to the origin) undergoing a Langevin dynamics on the MB PES. Use these components as the <code>ARG</code> arguments in the <code>METAD</code> rule.</li>
<li>reasonable widths of the Gaussians (<code>SIGMA</code>) are ca. 0.1.</li>
<li>0.1 is also a reasonable Gaussian height</li>
<li>a good interval for depositing Gaussians is probably around 500</li>
<li>don't forget to define an output <code>FILE</code>, that can afterward be read using <code>plumed sum_hills</code> to generate and plot the free energy landscape.</li>
</ul>
<p>Try to obtain a good FES reflecting the two minima.</p>
<p>Vary the width of the Gaussians for each CV in a systematic manner, what effect do you observe?</p>
<p>Vary the height and deposition frequency of the Gaussians, what trends do you observe?</p>
<p>How many crossings and recrossings do you sample in a single run for each choice of parameters?</p>
<h2><a class="anchor" id="masterclass-22-9-exer3"></a>
Exercise 3</h2>
<p>This exercise is found in the folder: <code>masterclass-22-09/exercises/2_fixedpathmetadynamics</code>.</p>
<p>Run metadynamics along a fixed path-CV on the MB PES. We recommend using 20 transition nodes, with 20 trailing nodes at each end (60 nodes in total). Use harmonic walls to keep the sampling within a relevant [-0.2,1.2] \(\sigma\)-range.</p>
<p>Now there's only one dimension for the Gaussian width, how do you interpret it?</p>
<p>Does the diffusion of the system along \(\sigma\) reflect anything particular? What could be the reason?</p>
<p>What happens if you add and strengthen a tube potential?</p>
<p>What is the final path and free energy that you obtain?</p>
<h2><a class="anchor" id="masterclass-22-9-exer4"></a>
Exercise 4</h2>
<p>This exercise is found in the folder: <code>masterclass-22-09/exercises/3_adaptivepathmetadynamics</code>.</p>
<p>First, change the <code>plumed.dat</code> input file to make the path adaptive by changing <code>PACE</code>, <code>STRIDE</code>, and <code>HALFLIFE</code>.</p>
<p>Run metadynamics along an adaptive path-CV on the MB PES. For simplification, start with the same pace for the metadynamics Gaussians and the path update.</p>
<p>For simplification, you can keep only 20 transition nodes, and not use trailing nodes.</p>
<p>Use harmonic walls to keep the sampling within a relevant [-0.2,1.2] \(\sigma\)-range.</p>
<p>What do you expect if you vary the ratio between the metadynamics and the path update frequency?</p>
<p>Vary the tube potential strength and the half-life parameter, what trend do you observe?</p>
<p>A small value for the <code>HALFLIFE</code> (say 1000 MD steps), keeps the path flexible so that the path evolves efficiently away from a poor initial guess path. However, once it has reached the transition channel, it would be better to set it to a very large value, in order to converge to the average transition path. Run first a short PMD simulation using a flexible path and relatively large Gaussians, until the system has filled both basins and has recrossed back to the initial state. Then, restart the simulation, using smaller Gaussians and a large halflife. Use the <code>INFILE</code> directive (instead of <code>GENPATH</code>) to read the last updated path, which can be taken from the tail of the path.out file of the first run.</p>
<h2><a class="anchor" id="masterclass-22-9-exer5"></a>
Exercise 5</h2>
<p>This exercise is found in the folder: <code>masterclass-22-09/exercises/4_multiplewalkers</code>.</p>
<p>In this final exercise, you will run the parallel "multiple walker" version of path-metadynamics.</p>
<p>Note that with more walkers building the metadynamics simulation, the total run time can be shorter, and possibly also the Gaussians can be smaller.</p>
<p>Try several configurations of walkers and try to answer the question if there is an optimal number of walkers.</p>
<h2><a class="anchor" id="masterclass-22-9-bib"></a>
Bibliography</h2>
<p>[1] A. Laio and M. Parrinello, “Escaping free-energy minima,” <em>Proc. Natl. Acad. Sci. USA</em>, vol. 99, no. 20, pp. 12562–12566, 2002.</p>
<p>[2] D. Branduardi, F. Gervasio, and M. Parrinello, “From A to B in free energy space,” <em>J. Chem. Phys</em>, vol. 126, p. 054103, 2007.</p>
<p>[3] G. D&iacute;az Leines and B. Ensing, “Path finding on high-dimensional free energy landscapes,” <em>Phys. Rev. Lett.</em>, vol. 109, no. 2, p. 020601, 2012.</p>
<p>[4] A. P&eacute;rez de Alba Ort&iacute;z, A. Tiwari, R. C. Puthenkalathil, and B.Ensing, “Advances in enhanced sampling along adaptive paths of collective variables,” _ J. Chem. Phys._, vol. 149, no. 7, p. 072320, 2018.</p>
<p>[5] G. A. Tribello, M. Bonomi, D. Branduardi, C. Camilloni, and G. Bussi, “Plumed2:Newfeathers for an old bird,” <em>Comp. Phys. Comm.</em>, vol. 185, no. 2, pp. 604–613, 2014.</p>
<p>[6] P. Raiteri, A. Laio, F. L. Gervasio, C. Micheletti, and M. Parrinello, “Efficient reconstruction of complex free energy landscapes by multiple walkers metadynamics,” <em>J. Phys. Chem. B.</em>, vol. 110, no. 8, pp. 3533–3539, 2006.</p>
<p>[7] A. Barducci, G. Bussi, and M. Parrinello, “Well-tempered metadynamics: a smoothly converging and tunable free-energy method,” <em>Phys. Rev. Lett.</em>, vol. 100, no. 2, p. 020603, 2008.</p>
<p>[8] K. M&uuml;ller and L. D. Brown, “Location of saddle points and minimum energy paths by a constrained simplex optimization procedure,” <em>Theor. Chim. Acta</em>, vol. 53, no. 1, pp. 75–93, 1979. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
