<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>PLUMED: PLUMED Masterclass 21.1: PLUMED syntax and analysis</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script>
   var redpath = "";
   
   function showPath(eg,name) {
     var i; var y = document.getElementsByName(redpath);
     for (i=0; i < y.length; i++ ) { y[i].style.color="black"; }
     var x = document.getElementsByName(name); redpath=name;
     for (i = 0; i < x.length; i++) { x[i].style.color="red"; }
     var valid="value_details_".concat(eg);
     var valueField = document.getElementById(valid);
     var dataField = document.getElementById(name);
     valueField.innerHTML = dataField.innerHTML;
   }
   function swapInput(name) {
     var btn = document.getElementById(name + "_button");
     var mydiv = document.getElementById("input_" + name);
     if( btn.textContent=="expand shortcuts" ) {
         btn.textContent = "contract shortcuts";
         var dataField = document.getElementById(name + "long");
         mydiv.innerHTML = dataField.innerHTML;
     } else if( btn.textContent=="contract shortcuts" ) {
         btn.textContent = "expand shortcuts";
         var dataField = document.getElementById(name + "short");
         mydiv.innerHTML = dataField.innerHTML;
     }
   }
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.9.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('masterclass-21-1.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PLUMED Masterclass 21.1: PLUMED syntax and analysis </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Authors</dt><dd>Max Bonomi </dd></dl>
<dl class="section date"><dt>Date</dt><dd>January 18, 2021</dd></dl>
<h1><a class="anchor" id="masterclass-21-1-aims"></a>
Aims</h1>
<p>The aim of this Masterclass is to introduce users to the PLUMED syntax and to illustrate how PLUMED can be used to analyze pre-existing molecular dynamics trajectories.</p>
<h1><a class="anchor" id="masterclass-21-1-lo"></a>
Objectives</h1>
<p>Once this Masterclass is completed, users will be able to:</p>
<ul>
<li>Write a simple PLUMED input file and use it with the <a class="el" href="driver.html">driver</a> utility to analyze a trajectory.</li>
<li>Use advanced selection tools with <a class="el" href="_m_o_l_i_n_f_o.html">MOLINFO</a>.</li>
<li>Define and use virtual atoms, such as <a class="el" href="_c_e_n_t_e_r.html">CENTER</a>.</li>
<li>Deal with discontinuities in the trajectory due to periodic boundary conditions.</li>
<li>Use <a class="el" href="_r_m_s_d.html">RMSD</a> to measure protein conformational changes.</li>
<li>Align the system to a template with <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a>.</li>
</ul>
<h1><a class="anchor" id="masterclass-21-1-install"></a>
Setting up the software</h1>
<h2><a class="anchor" id="masterclass-21-1-conda"></a>
Installation</h2>
<p>We will use <a href="https://docs.conda.io/en/latest/">conda</a> to install all the software needed in this Masterclass:</p><ul>
<li><a href="https://www.plumed.org">PLUMED</a> version 2.7.0</li>
<li><a href="https://numpy.org">NumPy</a></li>
<li><a href="https://pandas.pydata.org">pandas</a></li>
<li><a href="https://matplotlib.org">matplotlib</a></li>
<li><a href="https://jupyter.org/index.html">jupyter</a></li>
<li><a href="https://mdtraj.org/1.9.4/index.html">MDTraj</a></li>
<li><a href="https://www.mdanalysis.org">MDAnalysis</a></li>
<li><a href="https://git-scm.com">Git</a></li>
</ul>
<p>First, make sure conda is installed by typing:</p>
<pre class="fragment">conda
</pre><p>If the command is not found, please refer to these <a href="https://docs.conda.io/en/latest/miniconda.html">instructions</a> to install conda on your machine. Alternatively, if you use the <a href="https://brew.sh">Homebrew</a> package manager, you can install conda with:</p>
<pre class="fragment">brew install --cask anaconda
# add this line to your .bashrc
export PATH="/usr/local/anaconda3/bin:$PATH"
</pre><p>Now we can create a conda environment for the PLUMED Masterclass:</p>
<pre class="fragment">conda create --name plumed-masterclass 
</pre><p>and activate it with:</p>
<pre class="fragment">conda activate plumed-masterclass
</pre><p>Finally, we can proceed with the installation of the required software:</p>
<pre class="fragment">conda install -c conda-forge plumed py-plumed numpy pandas matplotlib notebook mdtraj mdanalysis git
</pre><dl class="section note"><dt>Note</dt><dd>Do not forget to activate the <code>plumed-masterclass</code> environment every time you open a new terminal/shell.</dd></dl>
<h2><a class="anchor" id="masterclass-21-1-plumed"></a>
PLUMED overview</h2>
<p>PLUMED is a library that can be incorporated into many molecular dynamics (MD) codes by adding a relatively simple and well documented interface. Once it is incorporated you can use PLUMED to perform on-the-fly a variety of different analyses and to bias the sampling in MD simulations. Additionally, PLUMED can be used as a standalone code for analyzing trajectories. If you want to use the code in this way, you can run the PLUMED executable by issuing the command:</p>
<pre class="fragment">plumed &lt;instructions&gt;
</pre><p>Let's start by getting a feel for the range of calculations that PLUMED can do. Issue the following command now:</p>
<pre class="fragment">plumed --help 
</pre><p>The output of this command is the list of <a class="el" href="tools.html">Command Line Tools</a> included in PLUMED. Among these, there are commands that allow you to patch an MD code, postprocess metadynamics simulations, and build the manual. In this class we will use PLUMED to analyze trajectories. In order to do so, we will learn how to use the <a class="el" href="driver.html">driver</a> command line tool. Let's look at the options of PLUMED <a class="el" href="driver.html">driver</a> by issuing the following command: <br  />
</p>
<pre class="fragment">plumed driver --help
</pre><p>As you can see we can do a number of things with <a class="el" href="driver.html">driver</a>. For all of these options, however, we are going to need to write a PLUMED input file.</p>
<h1><a class="anchor" id="masterclass-21-1-resources"></a>
Resources</h1>
<p>The data needed to complete the exercises of this Masterclass can be found on <a href="https://github.com/plumed/masterclass-21-1">GitHub</a>. You can clone this repository locally on your machine using the following command:</p>
<pre class="fragment">git clone https://github.com/plumed/masterclass-21-1.git
</pre><p>The MD trajectory that we will analyze can be found in the folder called <code>data</code>:</p><ul>
<li><code>5-HT1B.pdb</code>: reference conformation of the 5-HT1B receptor with the serotonin ligand.</li>
<li><code>5-HT1B.xtc</code>: trajectory of the 5-HT1B receptor with the serotonin ligand.</li>
</ul>
<p>A Jupyter notebook to be used as template for the analysis of the PLUMED output can be found in the folder called <code>notebooks</code>. In this directory, you will also find the complete solution to all exercises in the notebook <code>solution.ipynb</code>.</p>
<p>Please note that:</p><ul>
<li>This is a simulation of a membrane receptor, but water, lipids, and ions have been stripped out of the trajectory.</li>
<li>This is the raw trajectory generated by <a href="https://www.gromacs.org">GROMACS</a>. Therefore it is discontinuous due to periodic boundaries conditions (PBCs).</li>
<li>The students are invited to solve the exercises by themselves after completing the PLUMED input file templates provided below. In case of problems, students can rely on the solution notebook provided in the <a href="https://github.com/plumed/masterclass-21-1">GitHub</a> repository.</li>
</ul>
<p>To keep things clean, it is recommended to run each exercise in a separate sub-directory (i.e. Exercise-1, Exercise-2, ...), which you can create inside the root directory <code>masterclass-21-1</code>.</p>
<dl class="section note"><dt>Note</dt><dd>All the exercises have been tested with PLUMED version 2.7.0.</dd></dl>
<h1><a class="anchor" id="masterclass-21-1-structure"></a>
A sample PLUMED input file</h1>
<p>The main goal of PLUMED is to compute collective variables (or CVs), which are complex descriptors of the system that can be used to describe the conformational change of a protein or a chemical reaction. This can be done either <em>on-the-fly</em> during a molecular dynamics simulations or <em>a posteriori</em> on a pre-calculated trajectory using PLUMED as a post-processing tool. In both cases, you should create an input file with a specific PLUMED syntax. Have a look at the sample input file below:</p>

<div style="width: 90%; float:left" id="value_details_eg1"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-passing-green.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Compute distance between atoms 1 and 10.</span>
<span style="color:blue"># Atoms are ordered as in the trajectory files and their numbering starts from 1.</span>
<span style="color:blue"># The distance is called "d" for future reference.</span>
<b name="eg1d" onclick='showPath("eg1","eg1d")'>d: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=1,10 <span style="display:none;" id="eg1d">The DISTANCE action with label <b>d</b> calculates a single scalar value</span>
<span style="color:blue"># Compute the torsional angle between atoms 1, 10, 20, and 30.</span>
<span style="color:blue"># The angle is called "phi1" for future reference.</span>
<b name="eg1phi1" onclick='showPath("eg1","eg1phi1")'>phi1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=1,10,20,30 <span style="display:none;" id="eg1phi1">The TORSION action with label <b>phi1</b> calculates a single scalar value</span>
<span style="color:blue"># The same CV defined above can be split into multiple lines</span>
<span style="color:blue"># The angle is called "phi2" for future reference.</span>
<b name="eg1phi2" onclick='showPath("eg1","eg1phi2")'>phi2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> ...
   
   <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=1,10,20,30 
...<span style="display:none;" id="eg1phi2">The TORSION action with label <b>phi2</b> calculates a single scalar value</span>
<span style="color:blue"># Print "d" on a file named "COLVAR1" every 10 steps.</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1d">d</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR1 <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=10 <span style="display:none;" id="eg1">The PRINT action with label <b></b></span>
<span style="color:blue"># Print "phi1" and "phi2" on another file named "COLVAR2" every 100 steps.</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<b name="eg1phi1">phi1</b>,<b name="eg1phi2">phi2</b> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR2 <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=100 <span style="display:none;" id="eg1">The PRINT action with label <b></b></span>
</pre>
<p>In the input file above, each line defines a so-called action. In this simple example, actions are used to compute a distance, a dihedral angle, or print some values on a file. Each action supports a number of keywords, whose value is specified. Action names are highlighted in green and, by clicking on them, you can go to the corresponding page in the manual that contains a detailed description of each keyword. Actions that support the keyword <code>STRIDE</code> are those that determine how frequently things are done. Notice that the default value for <code>STRIDE</code> is always 1. In the example above, omitting <code>STRIDE</code> keywords the corresponding <code>COLVAR</code> files would have been written for every frame of the analyzed trajectory. All the other actions in the example above, i.e. <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a> and <a class="el" href="_t_o_r_s_i_o_n.html">TORSION</a>, do not support the <code>STRIDE</code> keyword and are only calculated when requested. That is, <code>d</code> will be computed every 10 frames, and <code>phi1</code> and <code>phi2</code> every 100 frames.</p>
<p>Variables should be given a name (in the example above, <code>d</code>, <code>phi1</code>, and <code>phi2</code>), which is then used to refer to these variables in subsequent actions, such as the <a class="el" href="_p_r_i_n_t.html">PRINT</a> command. A lists of atoms should be provided as comma separated numbers, with no space.</p>
<p>You can find more information on the PLUMED syntax at <a class="el" href="_syntax.html">Getting Started</a> page of the manual. The complete documentation for all the supported collective variables can be found at the <a class="el" href="colvarintro.html">Collective Variables</a> page.</p>
<h2><a class="anchor" id="masterclass-21-1-units"></a>
The PLUMED internal units</h2>
<p>By default the PLUMED inputs and outputs quantities in the following units:</p>
<ul>
<li>Length: nanometers</li>
<li>Energy: kJ/mol</li>
<li>Time: picoseconds</li>
<li>Mass: amu</li>
<li>Charge: e</li>
</ul>
<p>If you want to change these units, you can do this using the <a class="el" href="_u_n_i_t_s.html">UNITS</a> keyword.</p>
<h1><a class="anchor" id="masterclass-21-1-ex"></a>
Exercises</h1>
<h2><a class="anchor" id="masterclass-21-1-ex-1"></a>
Exercise 1: Computing and printing simple collective variables</h2>
<p>In this exercise, we will learn how to compute and print collective variables on a pre-calculated MD trajectory. To analyze the trajectory provided here, we will:</p><ul>
<li>create a PLUMED input file with a text editor (typically called <code>plumed.dat</code>);</li>
<li>run the PLUMED <a class="el" href="driver.html">driver</a> utility;</li>
<li>visualize the output with the aid of a Jupyter notebook.</li>
</ul>
<p>Notice that you can also visualize trajectories with <a href="https://www.ks.uiuc.edu/Research/vmd/">VMD</a> (always a good idea!). For example, the trajectory <code>5-HT1B.xtc</code> can be visualized with the command:</p>
<pre class="fragment">vmd 5-HT1B.pdb 5-HT1B.xtc 
</pre><p>When you try this, you will notice that this trajectory is discontinuous due to PBCs. We need to keep this in mind in our analysis.</p>
<p>Let's now prepare a PLUMED input file to calculate:</p><ul>
<li>the gyration radius of the CA protein atoms (<a class="el" href="_g_y_r_a_t_i_o_n.html">GYRATION</a>) of the first 40 N-terminal residues;</li>
<li>the distance (<a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a>) between CA atoms of residues 1 and 40.</li>
</ul>
<p>The first 40 residues of the 5-HT1B receptor correspond to an extracellular flexible loop of which we want to characterize the dynamics during our MD simulation. Below you can find a sample <code>plumed.dat</code> file that you can use as a template. Whenever you see an highlighted <span style="background-color:yellow">FILL</span> string, be careful because this is a string that you must replace. To retrieve the atom indexes that you need to include in the input file, you can have a look at <code>5-HT1B.pdb</code>. The atoms indexes are contained in the second column. Keep in mind that numbering scheme in PLUMED starts from 1.</p>

<div style="width: 90%; float:left" id="value_details_eg2"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Compute gyration radius on CA atoms of the first 40 N-terminal residues:</span>
<b name="eg2r" onclick='showPath("eg2","eg2r")'>r: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_g_y_r_a_t_i_o_n.html" style="color:green">GYRATION</a> <div class="tooltip">ATOMS<div class="right">the group of atoms that you are calculating the Gyration Tensor for. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2r"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Compute distance between CA atoms of residues 1 and 40</span>
<b name="eg2d" onclick='showPath("eg2","eg2d")'>d: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2d"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print the two collective variables on COLVAR file every step</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Once your <code>plumed.dat</code> file is complete, you can run the PLUMED <a class="el" href="driver.html">driver</a> as follows:</p>
<pre class="fragment">plumed driver --plumed plumed.dat --mf_xtc 5-HT1B.xtc
</pre><p>Scroll in your terminal to read the PLUMED log. As you can see, PLUMED gives a lot of feedback about the input that it is reading and the actions that it will execute. Please take your time to inspect the log file and check if PLUMED is actually doing what you intend to do.</p>
<p>The command above will create a <code>COLVAR</code> file. The first lines should be identical to these ones:</p>
<pre class="fragment">#! FIELDS time r d
 0.000000 1.271069 2.782998
 1.000000 1.263125 2.388697
 2.000000 1.348965 2.606062
 3.000000 1.291011 2.204363
 4.000000 1.280714 2.411836
 5.000000 1.257692 2.334839
</pre><p>Notice that the first line informs you about the content of each column.</p>
<p><b>In case you obtain different numbers, check your input, you might have made some mistakes!</b></p>
<p>This <code>COLVAR</code> file can be analyzed using the Jupyter notebook <code>plumed-pandas.ipynb</code> provided in the folder <code>notebooks</code>. You can use the following command to open the notebook:</p>
<pre class="fragment">jupyter notebook plumed-pandas.ipynb
</pre><p>This notebook allows you to import the <code>COLVAR</code> file produced by PLUMED and to generate the desired figures using the <code>matplotlib</code> library:</p>
<div class="fragment"><div class="line"><span class="comment"># import python modules</span></div>
<div class="line"><span class="keyword">import</span> plumed</div>
<div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"> </div>
<div class="line"><span class="comment"># import COLVAR file as pandas dataset</span></div>
<div class="line"><span class="comment"># set the right path to the COLVAR file</span></div>
<div class="line">data=plumed.read_as_pandas(<span class="stringliteral">&quot;../Exercise-1/COLVAR&quot;</span>)</div>
<div class="line"><span class="comment"># print pandas dataset</span></div>
<div class="line">data</div>
<div class="line"> </div>
<div class="line"><span class="comment"># plot time serie of gyration radius (r) and distance (d)</span></div>
<div class="line">plt.plot(data.time,data.r, label=<span class="stringliteral">&quot;gyration radius&quot;</span>)</div>
<div class="line">plt.plot(data.time,data.d, label=<span class="stringliteral">&quot;distance&quot;</span>)</div>
<div class="line"><span class="comment"># x-y axis labels</span></div>
<div class="line">plt.xlabel(<span class="stringliteral">&quot;MD frame&quot;</span>)</div>
<div class="line">plt.ylabel(<span class="stringliteral">&quot;r/d [nm]&quot;</span>)</div>
<div class="line">plt.legend()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># plot gyration radius vs distance</span></div>
<div class="line">plt.plot(data.r,data.d, <span class="stringliteral">&#39;o&#39;</span>)</div>
<div class="line"><span class="comment"># x-y axis labels</span></div>
<div class="line">plt.xlabel(<span class="stringliteral">&quot;gyration radius [nm]&quot;</span>)</div>
<div class="line">plt.ylabel(<span class="stringliteral">&quot;distance [nm]&quot;</span>)</div>
</div><!-- fragment --><p>What can you deduce about the dynamics of this region of the 5-HT1B receptors? Are the two CVs both providing useful information or are they quite correlated? To answer to the latter question, you can inspect the plot of one CV against the other.</p>
<h2><a class="anchor" id="masterclass-21-1-ex-2"></a>
Exercise 2: Mastering advanced selection tools</h2>
<p>PLUMED provides some shortcuts to select atoms with specific properties. To use this feature, you should specify the <a class="el" href="_m_o_l_i_n_f_o.html">MOLINFO</a> action along with a reference PDB file. This command is used to provide information on the molecules that are present in your system.</p>
<p>Let's try to use this functionality to calculate the backbone dihedral angle \( \phi \) (phi) of residue 2 of the 5-HT1B receptor. This CV is defined by the action <a class="el" href="_t_o_r_s_i_o_n.html">TORSION</a> and a set of 4 atoms. For residue <code>i</code>, the dihedral \( \phi \) is defined by these atoms: C(i-1),N(i),CA(i),C(i) (see Fig. <a class="el" href="masterclass-21-1.html#masterclass-21-1-dih-fig">masterclass-21-1-dih-fig</a>).</p>
<p><a class="anchor" id="masterclass-21-1-dih-fig"></a> </p><div class="image">
<img src="masterclass-21-1-dih-fig.png" alt=""/>
<div class="caption">
Definition of backbone dihedral angles, with dihedral phi highlighted in red.</div></div>
<p>After consulting the manual and inspecting <code>5-HT1B.pdb</code>, let's define the dihedral angle \( \phi \) of residue 2 in two different ways:</p><ol type="1">
<li>specifying an explicit list of 4 atoms (<code>t1</code>).</li>
<li>using the <a class="el" href="_m_o_l_i_n_f_o.html">MOLINFO</a> shortcut to select quadruplets for dihedral angles (<code>t2</code>);</li>
</ol>

<div style="width: 90%; float:left" id="value_details_eg3"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Activate MOLINFO functionalities</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Define the dihedral phi of residue 2 as an explicit list of 4 atoms</span>
<b name="eg3t1" onclick='showPath("eg3","eg3t1")'>t1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg3t1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Define the same dihedral using MOLINFO shortcuts</span>
<b name="eg3t2" onclick='showPath("eg3","eg3t2")'>t2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> <div class="tooltip">ATOMS<div class="right">the four atoms involved in the torsional angle <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg3t2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print the two collective variables on COLVAR file every step</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg3"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>After completing the PLUMED input file above, let's use it to analyze the trajectory <code>5-HT1B.xtc</code> using the <a class="el" href="driver.html">driver</a> tool:</p>
<pre class="fragment">plumed driver --plumed plumed.dat --mf_xtc 5-HT1B.xtc
</pre><p>You can modify the Jupyter notebook used in <a class="el" href="masterclass-21-1.html#masterclass-21-1-ex-1">Exercise 1: Computing and printing simple collective variables</a> to visualize the trajectory of the two CVs calculated with the PLUMED input file above and written in the <code>COLVAR</code> file. If you executed this exercise correctly, these two trajectories should be identical.</p>
<p>As a second example of <a class="el" href="_m_o_l_i_n_f_o.html">MOLINFO</a> capabilities, we will use the advanced atom selection tools provided by the <a href="https://www.mdanalysis.org">MDAnalysis</a> and <a href="https://mdtraj.org/1.9.4/index.html">MDTraj</a> libraries. Let's redo <a class="el" href="masterclass-21-1.html#masterclass-21-1-ex-1">Exercise 1: Computing and printing simple collective variables</a>, this time using <a class="el" href="_m_o_l_i_n_f_o.html">MOLINFO</a> shortcuts to select CA atoms. You need to complete the following template PLUMED input file using the appropriate selection syntax for the corresponding library used. Please consult the <a href="https://www.mdanalysis.org">MDAnalysis</a> and <a href="https://mdtraj.org/1.9.4/index.html">MDTraj</a> documentations if you are not familiar with these libraries and their syntax.</p>

<div style="width: 90%; float:left" id="value_details_eg4"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Activate MOLINFO functionalities</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># To use MDAnalysis selection tools:</span>
<b name="eg4r1" onclick='showPath("eg4","eg4r1")'>r1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_g_y_r_a_t_i_o_n.html" style="color:green">GYRATION</a> <div class="tooltip">ATOMS<div class="right">the group of atoms that you are calculating the Gyration Tensor for. <i></i></div></div>={@mda:{resid __FILL__ and name __FILL__}}  <span style="display:none;" id="eg4r1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4d1" onclick='showPath("eg4","eg4d1")'>d1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>={@mda:{resid __FILL__ and name __FILL__}}  <span style="display:none;" id="eg4d1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># To use MDTraj selection tools:</span>
<b name="eg4r2" onclick='showPath("eg4","eg4r2")'>r2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_g_y_r_a_t_i_o_n.html" style="color:green">GYRATION</a> <div class="tooltip">ATOMS<div class="right">the group of atoms that you are calculating the Gyration Tensor for. <i></i></div></div>={@mdt:{resid __FILL__ and name __FILL__}}  <span style="display:none;" id="eg4r2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<b name="eg4d2" onclick='showPath("eg4","eg4d2")'>d2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>={@mdt:{resid __FILL__ and name __FILL__}}  <span style="display:none;" id="eg4d2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print all the collective variables on COLVAR file every step</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg4"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Now, you can compare the <code>COLVAR</code> file obtained with the one of <a class="el" href="masterclass-21-1.html#masterclass-21-1-ex-1">Exercise 1: Computing and printing simple collective variables</a>: they should be identical!</p>
<h2><a class="anchor" id="masterclass-21-1-ex-3"></a>
Exercise 3: Using virtual atoms</h2>
<p>Sometimes, when calculating a CV, you may not want to use the positions of a number of atoms directly. Instead you may want to define a virtual atom whose position is generated based on the positions of a collection of other atoms. For example you might want to use the center of mass (<a class="el" href="_c_o_m.html">COM</a>) or the geometric center (<a class="el" href="_c_e_n_t_e_r.html">CENTER</a>) of a group of atoms.</p>
<p>In this exercise, you will learn how to specify virtual atoms and later use them to define a CV. The objective is to calculate the distances between the geometric center of the serotonin ligand (indicated as residue <code>LIG</code> in <code>5-HT1B.pdb</code>) and the geometric centers of the two glycans located at position N24 and N32. Glycans are carbohydrate-based polymers that are sometimes linked to certain protein aminoacids. If you examine <code>5-HT1B.pdb</code>, you will find the two glycans defined after the end of the protein, i.e. after residue SER-390. These two glycans have different length:</p><ul>
<li>the glycan attached at position N24 ranges from residue BGLC-1 to AFUC-9</li>
<li>the glycan attached at position N32 ranges from residue BGLC-1 to AFUC-10</li>
</ul>
<p>Let's complete the PLUMED input file below. You can use the advanced selection tools learned in <a class="el" href="masterclass-21-1.html#masterclass-21-1-ex-2">Exercise 2: Mastering advanced selection tools</a> to specify the atoms belonging to the ligand and to the two glycans:</p>

<div style="width: 90%; float:left" id="value_details_eg5"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Geometric center of the ligand</span>
<b name="eg5lig" onclick='showPath("eg5","eg5lig")'>lig: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_e_n_t_e_r.html" style="color:green">CENTER</a> <div class="tooltip">ATOMS<div class="right">the list of atoms which are involved the virtual atom's definition. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5lig"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Geometric center of the first glycan</span>
<b name="eg5g1" onclick='showPath("eg5","eg5g1")'>g1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_e_n_t_e_r.html" style="color:green">CENTER</a> <div class="tooltip">ATOMS<div class="right">the list of atoms which are involved the virtual atom's definition. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5g1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Geometric center of the second glycan</span>
<b name="eg5g2" onclick='showPath("eg5","eg5g2")'>g2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_e_n_t_e_r.html" style="color:green">CENTER</a> <div class="tooltip">ATOMS<div class="right">the list of atoms which are involved the virtual atom's definition. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5g2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Distance between ligand and first glycan</span>
<b name="eg5d1" onclick='showPath("eg5","eg5d1")'>d1: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5d1"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Distance between ligand and second glycan</span>
<b name="eg5d2" onclick='showPath("eg5","eg5d2")'>d2: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <div class="tooltip">ATOMS<div class="right">the pair of atom that we are calculating the distance between. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5d2"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print the two distances on COLVAR file every step</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <div class="tooltip">ARG<div class="right">the input for this action is the scalar output from one or more other actions. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <div class="tooltip">FILE<div class="right">the name of the file on which to output these quantities <i></i></div></div>=COLVAR <div class="tooltip">STRIDE<div class="right"><b>compulsory keyword ( default=1 )</b>
the frequency with which the quantities of interest should be output <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg5"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Once you have prepared a PLUMED input file containing the above instructions, you can execute it on the trajectory <code>5-HT1B.xtc</code> by making use of the following command:</p>
<pre class="fragment">plumed driver --mf_xtc 5-HT1B.xtc --plumed plumed.dat
</pre><p>Let's now analyze the output of the calculation by plotting the time series of the two CVs. Can you say if the ligand is overall staying closer to the first or second glycan?</p>
<h2><a class="anchor" id="masterclass-21-1-ex-4"></a>
Exercise 4: Fixing PBCs discontinuities</h2>
<p>As mentioned above, <code>5-HT1B.xtc</code> is the raw trajectory generated by the GROMACS MD code. Therefore, it typically presents discontinuities due to PBCs. Many of the CVs used so far, such as <a class="el" href="_c_e_n_t_e_r.html">CENTER</a> or <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a>, take care of these discontinuities automatically. However, other CVs need a special command, called <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a>, to fix PBCs discontinuities before the calculation of the CV. In this exercise, you will learn how to use this action.</p>
<p>We have seen that the first 40 N-terminal residues of the 5-HT1B receptor are quite flexibile. In this exercise, we want to estimate the secondary structure content (alpha-helix and beta-sheet) of this fragment during the course of the MD simulations. In order to do so, we can use the following 3 CVs:</p><ul>
<li><a class="el" href="_a_l_p_h_a_r_m_s_d.html">ALPHARMSD</a> to measure the alpha-helical content of a protein structure.</li>
<li><a class="el" href="_p_a_r_a_b_e_t_a_r_m_s_d.html">PARABETARMSD</a> to measure the parallel beta-sheet content.</li>
<li><a class="el" href="_a_n_t_i_b_e_t_a_r_m_s_d.html">ANTIBETARMSD</a> to measure the antiparallel beta-sheet content.</li>
</ul>
<p>Let's first try to complete the following PLUMED input file:</p>

<div style="width: 90%; float:left" id="value_details_eg6"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Activate MOLINFO functionalities</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg6"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># make the first 40 N-terminal residues whole</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html" style="color:green">WHOLEMOLECULES</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg6"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># alpha-helix content of residues 1-40</span>
<b name="eg6h" onclick='showPath("eg6","eg6h")'>h: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_l_p_h_a_r_m_s_d.html" style="color:green">ALPHARMSD</a> <span style="background-color:yellow">__FILL__</span><div class="tooltip">TYPE<div class="right"><b>compulsory keyword ( default=DRMSD )</b>
the manner in which RMSD alignment is performed. <i></i></div></div>=OPTIMAL <span style="display:none;" id="eg6h"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># parallel beta-sheet content of residues 1-40</span>
<b name="eg6pb" onclick='showPath("eg6","eg6pb")'>pb: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_a_r_a_b_e_t_a_r_m_s_d.html" style="color:green">PARABETARMSD</a> <span style="background-color:yellow">__FILL__</span><div class="tooltip">TYPE<div class="right"><b>compulsory keyword ( default=DRMSD )</b>
the manner in which RMSD alignment is performed. <i></i></div></div>=OPTIMAL <span style="display:none;" id="eg6pb"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># antiparallel beta sheet-content of residues 1-40</span>
<b name="eg6ab" onclick='showPath("eg6","eg6ab")'>ab: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_a_n_t_i_b_e_t_a_r_m_s_d.html" style="color:green">ANTIBETARMSD</a> <span style="background-color:yellow">__FILL__</span><div class="tooltip">TYPE<div class="right"><b>compulsory keyword ( default=DRMSD )</b>
the manner in which RMSD alignment is performed. <i></i></div></div>=OPTIMAL <span style="display:none;" id="eg6ab"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># now we create a new CV that sums parallel and antiparallel beta-sheet contents</span>
<b name="eg6b" onclick='showPath("eg6","eg6b")'>b: </b><a href="https://www.plumed.org/doc-v2.9/user-doc/html/_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> <span style="background-color:yellow">__FILL__</span><div class="tooltip">PERIODIC<div class="right"><b>compulsory keyword </b>
if the output of your function is periodic then you should specify the periodicity
of the function. <i></i></div></div>=NO <span style="display:none;" id="eg6b"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Print the alpha-helical content and the *total* beta-sheet content on COLVAR file every step</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_p_r_i_n_t.html" style="color:green">PRINT</a> <span style="background-color:yellow">__FILL__</span><span style="display:none;" id="eg6"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>and use it to analyze the trajectory <code>5-HT1B.xtc</code>. Can you say if the first 40 N-terminal residues tend to populate more alpha-helical or beta-sheet conformations?</p>
<h2><a class="anchor" id="masterclass-21-1-ex-5"></a>
Exercise 5: Using RMSD to measure conformational changes</h2>
<p>As previously mentioned, the first 40 N-terminal residues of the 5-HT1B receptor are quite flexible, while the rest of the protein remains more stable during the course of the simulation. In this exercise, you will learn how to use <a class="el" href="_r_m_s_d.html">RMSD</a> to measure deviations from a reference structure. To use this CV, you need to keep in mind that you must specify in the PLUMED input a PDB file in which you mark the atoms that you want to use to:</p><ul>
<li>optimally align a conformation to the reference;</li>
<li>calculate the displacement from the reference conformation after optimal alignment.</li>
</ul>
<p>Keep in mind that these two sets of atoms might be different! In fact, the objective of this exercise is to calculate:</p><ul>
<li>the <a class="el" href="_r_m_s_d.html">RMSD</a> of the backbone atoms of the first 40 N-terminal residues after aligning the system on the backbone atoms of residues 41 to 390;</li>
<li>the <a class="el" href="_r_m_s_d.html">RMSD</a> of the backbone atoms of residues 41 to 390 after aligning the system on the same set of atoms.</li>
</ul>
<p>To create the two PDB files needed to define the two <a class="el" href="_r_m_s_d.html">RMSD</a> CVs, you can start from the provided PDB file <code>5-HT1B.pdb</code>. Please consult the manual at the <a class="el" href="_r_m_s_d.html">RMSD</a> page, in order to:</p><ul>
<li>create the PLUMED input file to calculate the two CVs defined above (use <code>TYPE=OPTIMAL</code>);</li>
<li>learn how to mark atoms for alignment and displacement in the PDB files;</li>
<li>check whether PBCs are automatically taken care of or you need to use the <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a> action.</li>
</ul>
<p>After analyzing <code>5-HT1B.xtc</code> with the <a class="el" href="driver.html">driver</a> tool, can you say which part of the receptor is more flexible and deviates more from the starting conformation during the course of the simulation?</p>
<h2><a class="anchor" id="masterclass-21-1-ex-6"></a>
Exercise 6: Aligning conformations to a template</h2>
<p>In this exercise, we will learn how to align a MD trajectory to a reference conformation, after fixing possible discontinuities due to PBCs. The goal is to compute the vertical position of the serotonin ligand with respect to the lipid bilayer. In the simulations of membrane proteins, typically the initial conformation is oriented so that the lipid bilayer is parallel to the xy plane (look for example at <code>5-HT1B.pdb</code>). Therefore, initially one could use for example the coordinate <code>z</code> of the geometric center of the ligand to measure how far it is from the membrane bilayer. However, during the simulation:</p><ul>
<li>the system can translate from its original position;</li>
<li>the system can be broken by PBCs;</li>
</ul>
<p>therefore one could not use an absolute position to keep track of the location of the ligand. To solve this problem, there are several PLUMED actions that can be used to make sure the system is not broken by PBCs, to re-align it to a reference conformation, and thus to use absolute positions safely.</p>
<p>To complete this exercise, the users will need to make heavy use of the PLUMED <a href="https://www.plumed.org/doc-v2.7/user-doc/html/colvarintro.html">manual</a> to prepare the input file on their own. In the following, some suggestions will be given:</p><ul>
<li>first, make sure the entire protein is not broken by PBCs using <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a>;</li>
<li>then, make sure the ligand is not broken by PBCs and in the same cell as the protein, using the <a class="el" href="_w_r_a_p_a_r_o_u_n_d.html">WRAPAROUND</a> action and the <code>GROUPBY</code> option;</li>
<li>to align the <em>stable</em> protein residues (as defined in <a class="el" href="masterclass-21-1.html#masterclass-21-1-ex-5">Exercise 5: Using RMSD to measure conformational changes</a>, i.e. residues 41 to 390) to the template <code>5-HT1B.pdb</code>, you can use <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a>;</li>
<li>at this point, you can safely define the position of the geometric center of the ligand using the <a class="el" href="_p_o_s_i_t_i_o_n.html">POSITION</a> CV with the option <code>NOPBC</code>;</li>
<li>the requested CV is the <code>z</code> component of the <a class="el" href="_p_o_s_i_t_i_o_n.html">POSITION</a> CV.</li>
</ul>
<p>You can check that your PLUMED input file is correct in two ways. First, you can print out the conformations of the system after the transformations done by <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a>, <a class="el" href="_w_r_a_p_a_r_o_u_n_d.html">WRAPAROUND</a>, and <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a> by modifying your input file as follows:</p>

<div style="width: 90%; float:left" id="value_details_eg7"> Click on the labels of the actions for more information on what each action computes </div>
<div style="width: 10%; float:left"><img src="https://img.shields.io/badge/v2.9-incomplete-yellow.svg" alt="tested on v2.9" /></div><pre style="width: 97%;" class="fragment">
<span style="color:blue"># Activate MOLINFO functionalities</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <div class="tooltip">STRUCTURE<div class="right"><b>compulsory keyword </b>
a file in pdb format containing a reference structure. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg7"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
<span style="color:blue"># Here put your PLUMED input file</span>
<span style="color:blue">#</span>
<span style="color:blue">#</span>
<span style="color:blue"># Write coordinates of all the atoms to file after PLUMED transformations</span>
<a href="https://www.plumed.org/doc-v2.9/user-doc/html/_d_u_m_p_a_t_o_m_s.html" style="color:green">DUMPATOMS</a> <div class="tooltip">FILE<div class="right"><b>compulsory keyword </b>
file on which to output coordinates; extension is automatically detected <i></i></div></div>=5-HT1B_aligned.gro <div class="tooltip">ATOMS<div class="right">the atom indices whose positions you would like to print out. <i></i></div></div>=<span style="background-color:yellow">__FILL__</span> <span style="display:none;" id="eg7"> You cannot view the components that are calculated by each action for this input file. Sorry </span>
</pre>
<p>Now, you can visualize the <code>5-HT1B_aligned.gro</code> file using <a href="https://www.ks.uiuc.edu/Research/vmd/">VMD</a>. Second, if you inspect the time series of your CV, this should be a continuous trajectory that spans the range from 9 nm to 18 nm.</p>
<h2><a class="anchor" id="masterclass-21-1-ex-7"></a>
Exercise 7: Estimating binding propensity</h2>
<p>In this last exercise, we want to determine the propensity of the serotonin ligand to bind the first 40 N-terminal flexible residues of the 5-HT1B receptor and if there are hot-spots where binding is more favorite. In order to answer to these questions, the user will:</p><ul>
<li>compute the fraction of bound conformations over the total number of frames in the MD trajectory;</li>
<li>for each individual residue and glycan, compute the fraction of bound conformation per residue/glycan;</li>
<li>dump all bound conformations to a <code>gro</code> file, after fixing PBCs as in <a class="el" href="masterclass-21-1.html#masterclass-21-1-ex-6">Exercise 6: Aligning conformations to a template</a>;</li>
<li>for each individual residue and glycan, dump all bound conformations to a separate <code>gro</code> file, after fixing PBCs.</li>
</ul>
<p>To solve this exercise, no template PLUMED input file nor any indication of the procedure to follow will be given. The users should only keep in mind that:</p><ul>
<li>we arbitrarily define as <em>bound</em> a conformation in which at least one pair of atoms of the ligand and of the protein/residue/glycan is closer than 0.4 nm;</li>
<li>any pre-exisiting CV defined in the PLUMED <a href="https://www.plumed.org/doc-v2.7/user-doc/html/colvarintro.html">manual</a> can be used;</li>
<li>any CV defined directly by the user in the PLUMED input file via the <a class="el" href="_c_u_s_t_o_m.html">CUSTOM</a> action can be used. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
